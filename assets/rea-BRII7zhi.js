var Pn=r=>{throw TypeError(r)};var gs=(r,e,t)=>e.has(r)||Pn("Cannot "+t);var oe=(r,e,t)=>(gs(r,e,"read from private field"),t?t.call(r):e.get(r)),We=(r,e,t)=>e.has(r)?Pn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Ie=(r,e,t,i)=>(gs(r,e,"write to private field"),i?i.call(r,t):e.set(r,t),t),qe=(r,e,t)=>(gs(r,e,"access private method"),t);var Dn=(r,e,t,i)=>({set _(s){Ie(r,e,s,t)},get _(){return oe(r,e,i)}});import{r as b,j as fe,R as $e}from"./rdd-DY9_7IsI.js";import{ac as es,ad as Ys,ae as jo}from"./raa-COal7Kfy.js";import{k as zo,$ as bt,l as _r,a as et,m as Go,n as Tr,o as lt,p as Zs,q as Rr,r as Js,s as Wo,t as qo,u as Xo,g as kr,v as Mn,w as Pr,x as Dr,y as Yo,d as Mr,f as Ms,z as Zo,c as ti,A as Jo,e as Qo}from"./hui-5vR6nkoA.js";/**
 * react-router v7.8.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var In="popstate";function el(r={}){function e(i,s){let{pathname:n,search:a,hash:o}=i.location;return Is("",{pathname:n,search:a,hash:o},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(i,s){return typeof s=="string"?s:gi(s)}return il(e,t,null,r)}function he(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function it(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function tl(){return Math.random().toString(36).substring(2,10)}function Ln(r,e){return{usr:r.state,key:r.key,idx:e}}function Is(r,e,t=null,i){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?Zt(e):e,state:t,key:e&&e.key||i||tl()}}function gi({pathname:r="/",search:e="",hash:t=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(r+=t.charAt(0)==="#"?t:"#"+t),r}function Zt(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substring(t),r=r.substring(0,t));let i=r.indexOf("?");i>=0&&(e.search=r.substring(i),r=r.substring(0,i)),r&&(e.pathname=r)}return e}function il(r,e,t,i={}){let{window:s=document.defaultView,v5Compat:n=!1}=i,a=s.history,o="POP",l=null,u=c();u==null&&(u=0,a.replaceState({...a.state,idx:u},""));function c(){return(a.state||{idx:null}).idx}function h(){o="POP";let m=c(),y=m==null?null:m-u;u=m,l&&l({action:o,location:g.location,delta:y})}function d(m,y){o="PUSH";let v=Is(g.location,m,y);u=c()+1;let A=Ln(v,u),w=g.createHref(v);try{a.pushState(A,"",w)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;s.location.assign(w)}n&&l&&l({action:o,location:g.location,delta:1})}function f(m,y){o="REPLACE";let v=Is(g.location,m,y);u=c();let A=Ln(v,u),w=g.createHref(v);a.replaceState(A,"",w),n&&l&&l({action:o,location:g.location,delta:0})}function p(m){return sl(m)}let g={get action(){return o},get location(){return r(s,a)},listen(m){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(In,h),l=m,()=>{s.removeEventListener(In,h),l=null}},createHref(m){return e(s,m)},createURL:p,encodeLocation(m){let y=p(m);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:d,replace:f,go(m){return a.go(m)}};return g}function sl(r,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),he(t,"No window.location.(origin|href) available to create URL");let i=typeof r=="string"?r:gi(r);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function Ir(r,e,t="/"){return nl(r,e,t,!1)}function nl(r,e,t,i){let s=typeof e=="string"?Zt(e):e,n=ct(s.pathname||"/",t);if(n==null)return null;let a=Lr(r);rl(a);let o=null;for(let l=0;o==null&&l<a.length;++l){let u=ml(n);o=pl(a[l],u,i)}return o}function Lr(r,e=[],t=[],i="",s=!1){let n=(a,o,l=s,u)=>{let c={relativePath:u===void 0?a.path||"":u,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};if(c.relativePath.startsWith("/")){if(!c.relativePath.startsWith(i)&&l)return;he(c.relativePath.startsWith(i),`Absolute route path "${c.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(i.length)}let h=ut([i,c.relativePath]),d=t.concat(c);a.children&&a.children.length>0&&(he(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),Lr(a.children,e,d,h,l)),!(a.path==null&&!a.index)&&e.push({path:h,score:dl(h,a.index),routesMeta:d})};return r.forEach((a,o)=>{if(a.path===""||!a.path?.includes("?"))n(a,o);else for(let l of Fr(a.path))n(a,o,!0,l)}),e}function Fr(r){let e=r.split("/");if(e.length===0)return[];let[t,...i]=e,s=t.endsWith("?"),n=t.replace(/\?$/,"");if(i.length===0)return s?[n,""]:[n];let a=Fr(i.join("/")),o=[];return o.push(...a.map(l=>l===""?n:[n,l].join("/"))),s&&o.push(...a),o.map(l=>r.startsWith("/")&&l===""?"/":l)}function rl(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:fl(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var al=/^:[\w-]+$/,ol=3,ll=2,ul=1,cl=10,hl=-2,Fn=r=>r==="*";function dl(r,e){let t=r.split("/"),i=t.length;return t.some(Fn)&&(i+=hl),e&&(i+=ll),t.filter(s=>!Fn(s)).reduce((s,n)=>s+(al.test(n)?ol:n===""?ul:cl),i)}function fl(r,e){return r.length===e.length&&r.slice(0,-1).every((i,s)=>i===e[s])?r[r.length-1]-e[e.length-1]:0}function pl(r,e,t=!1){let{routesMeta:i}=r,s={},n="/",a=[];for(let o=0;o<i.length;++o){let l=i[o],u=o===i.length-1,c=n==="/"?e:e.slice(n.length)||"/",h=Yi({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},c),d=l.route;if(!h&&u&&t&&!i[i.length-1].route.index&&(h=Yi({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},c)),!h)return null;Object.assign(s,h.params),a.push({params:s,pathname:ut([n,h.pathname]),pathnameBase:wl(ut([n,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(n=ut([n,h.pathnameBase]))}return a}function Yi(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,i]=gl(r.path,r.caseSensitive,r.end),s=e.match(t);if(!s)return null;let n=s[0],a=n.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:i.reduce((u,{paramName:c,isOptional:h},d)=>{if(c==="*"){let p=o[d]||"";a=n.slice(0,n.length-p.length).replace(/(.)\/+$/,"$1")}const f=o[d];return h&&!f?u[c]=void 0:u[c]=(f||"").replace(/%2F/g,"/"),u},{}),pathname:n,pathnameBase:a,pattern:r}}function gl(r,e=!1,t=!0){it(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let i=[],s="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,l)=>(i.push({paramName:o,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return r.endsWith("*")?(i.push({paramName:"*"}),s+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?s+="\\/*$":r!==""&&r!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),i]}function ml(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return it(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function ct(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=r.charAt(t);return i&&i!=="/"?null:r.slice(t)||"/"}function yl(r,e="/"){let{pathname:t,search:i="",hash:s=""}=typeof r=="string"?Zt(r):r;return{pathname:t?t.startsWith("/")?t:bl(t,e):e,search:Al(i),hash:Sl(s)}}function bl(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function ms(r,e,t,i){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function vl(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function $r(r){let e=vl(r);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function Or(r,e,t,i=!1){let s;typeof r=="string"?s=Zt(r):(s={...r},he(!s.pathname||!s.pathname.includes("?"),ms("?","pathname","search",s)),he(!s.pathname||!s.pathname.includes("#"),ms("#","pathname","hash",s)),he(!s.search||!s.search.includes("#"),ms("#","search","hash",s)));let n=r===""||s.pathname==="",a=n?"/":s.pathname,o;if(a==null)o=t;else{let h=e.length-1;if(!i&&a.startsWith("..")){let d=a.split("/");for(;d[0]==="..";)d.shift(),h-=1;s.pathname=d.join("/")}o=h>=0?e[h]:"/"}let l=yl(s,o),u=a&&a!=="/"&&a.endsWith("/"),c=(n||a===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(u||c)&&(l.pathname+="/"),l}var ut=r=>r.join("/").replace(/\/\/+/g,"/"),wl=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),Al=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,Sl=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function El(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var Nr=["POST","PUT","PATCH","DELETE"];new Set(Nr);var xl=["GET",...Nr];new Set(xl);var Jt=b.createContext(null);Jt.displayName="DataRouter";var ts=b.createContext(null);ts.displayName="DataRouterState";b.createContext(!1);var Br=b.createContext({isTransitioning:!1});Br.displayName="ViewTransition";var Cl=b.createContext(new Map);Cl.displayName="Fetchers";var _l=b.createContext(null);_l.displayName="Await";var st=b.createContext(null);st.displayName="Navigation";var Ei=b.createContext(null);Ei.displayName="Location";var ft=b.createContext({outlet:null,matches:[],isDataRoute:!1});ft.displayName="Route";var Qs=b.createContext(null);Qs.displayName="RouteError";function Tl(r,{relative:e}={}){he(xi(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=b.useContext(st),{hash:s,pathname:n,search:a}=Ci(r,{relative:e}),o=n;return t!=="/"&&(o=n==="/"?t:ut([t,n])),i.createHref({pathname:o,search:a,hash:s})}function xi(){return b.useContext(Ei)!=null}function Lt(){return he(xi(),"useLocation() may be used only in the context of a <Router> component."),b.useContext(Ei).location}var Vr="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Hr(r){b.useContext(st).static||b.useLayoutEffect(r)}function Rl(){let{isDataRoute:r}=b.useContext(ft);return r?Hl():kl()}function kl(){he(xi(),"useNavigate() may be used only in the context of a <Router> component.");let r=b.useContext(Jt),{basename:e,navigator:t}=b.useContext(st),{matches:i}=b.useContext(ft),{pathname:s}=Lt(),n=JSON.stringify($r(i)),a=b.useRef(!1);return Hr(()=>{a.current=!0}),b.useCallback((l,u={})=>{if(it(a.current,Vr),!a.current)return;if(typeof l=="number"){t.go(l);return}let c=Or(l,JSON.parse(n),s,u.relative==="path");r==null&&e!=="/"&&(c.pathname=c.pathname==="/"?e:ut([e,c.pathname])),(u.replace?t.replace:t.push)(c,u.state,u)},[e,t,n,s,r])}b.createContext(null);function Ci(r,{relative:e}={}){let{matches:t}=b.useContext(ft),{pathname:i}=Lt(),s=JSON.stringify($r(t));return b.useMemo(()=>Or(r,JSON.parse(s),i,e==="path"),[r,s,i,e])}function Pl(r,e){return Kr(r,e)}function Kr(r,e,t,i,s){he(xi(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:n}=b.useContext(st),{matches:a}=b.useContext(ft),o=a[a.length-1],l=o?o.params:{},u=o?o.pathname:"/",c=o?o.pathnameBase:"/",h=o&&o.route;{let v=h&&h.path||"";Ur(u,!h||v.endsWith("*")||v.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${v}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${v}"> to <Route path="${v==="/"?"*":`${v}/*`}">.`)}let d=Lt(),f;if(e){let v=typeof e=="string"?Zt(e):e;he(c==="/"||v.pathname?.startsWith(c),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${c}" but pathname "${v.pathname}" was given in the \`location\` prop.`),f=v}else f=d;let p=f.pathname||"/",g=p;if(c!=="/"){let v=c.replace(/^\//,"").split("/");g="/"+p.replace(/^\//,"").split("/").slice(v.length).join("/")}let m=Ir(r,{pathname:g});it(h||m!=null,`No routes matched location "${f.pathname}${f.search}${f.hash}" `),it(m==null||m[m.length-1].route.element!==void 0||m[m.length-1].route.Component!==void 0||m[m.length-1].route.lazy!==void 0,`Matched leaf route at location "${f.pathname}${f.search}${f.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=Fl(m&&m.map(v=>Object.assign({},v,{params:Object.assign({},l,v.params),pathname:ut([c,n.encodeLocation?n.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?c:ut([c,n.encodeLocation?n.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),a,t,i,s);return e&&y?b.createElement(Ei.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...f},navigationType:"POP"}},y):y}function Dl(){let r=Vl(),e=El(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,i="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:i},n={padding:"2px 4px",backgroundColor:i},a=null;return console.error("Error handled by React Router default ErrorBoundary:",r),a=b.createElement(b.Fragment,null,b.createElement("p",null,"💿 Hey developer 👋"),b.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",b.createElement("code",{style:n},"ErrorBoundary")," or"," ",b.createElement("code",{style:n},"errorElement")," prop on your route.")),b.createElement(b.Fragment,null,b.createElement("h2",null,"Unexpected Application Error!"),b.createElement("h3",{style:{fontStyle:"italic"}},e),t?b.createElement("pre",{style:s},t):null,a)}var Ml=b.createElement(Dl,null),Il=class extends b.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){this.props.unstable_onError?this.props.unstable_onError(r,e):console.error("React Router caught the following error during render",r)}render(){return this.state.error!==void 0?b.createElement(ft.Provider,{value:this.props.routeContext},b.createElement(Qs.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Ll({routeContext:r,match:e,children:t}){let i=b.useContext(Jt);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),b.createElement(ft.Provider,{value:r},t)}function Fl(r,e=[],t=null,i=null,s=null){if(r==null){if(!t)return null;if(t.errors)r=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let n=r,a=t?.errors;if(a!=null){let u=n.findIndex(c=>c.route.id&&a?.[c.route.id]!==void 0);he(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),n=n.slice(0,Math.min(n.length,u+1))}let o=!1,l=-1;if(t)for(let u=0;u<n.length;u++){let c=n[u];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(l=u),c.route.id){let{loaderData:h,errors:d}=t,f=c.route.loader&&!h.hasOwnProperty(c.route.id)&&(!d||d[c.route.id]===void 0);if(c.route.lazy||f){o=!0,l>=0?n=n.slice(0,l+1):n=[n[0]];break}}}return n.reduceRight((u,c,h)=>{let d,f=!1,p=null,g=null;t&&(d=a&&c.route.id?a[c.route.id]:void 0,p=c.route.errorElement||Ml,o&&(l<0&&h===0?(Ur("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),f=!0,g=null):l===h&&(f=!0,g=c.route.hydrateFallbackElement||null)));let m=e.concat(n.slice(0,h+1)),y=()=>{let v;return d?v=p:f?v=g:c.route.Component?v=b.createElement(c.route.Component,null):c.route.element?v=c.route.element:v=u,b.createElement(Ll,{match:c,routeContext:{outlet:u,matches:m,isDataRoute:t!=null},children:v})};return t&&(c.route.ErrorBoundary||c.route.errorElement||h===0)?b.createElement(Il,{location:t.location,revalidation:t.revalidation,component:p,error:d,children:y(),routeContext:{outlet:null,matches:m,isDataRoute:!0},unstable_onError:i}):y()},null)}function en(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $l(r){let e=b.useContext(Jt);return he(e,en(r)),e}function Ol(r){let e=b.useContext(ts);return he(e,en(r)),e}function Nl(r){let e=b.useContext(ft);return he(e,en(r)),e}function tn(r){let e=Nl(r),t=e.matches[e.matches.length-1];return he(t.route.id,`${r} can only be used on routes that contain a unique "id"`),t.route.id}function Bl(){return tn("useRouteId")}function Vl(){let r=b.useContext(Qs),e=Ol("useRouteError"),t=tn("useRouteError");return r!==void 0?r:e.errors?.[t]}function Hl(){let{router:r}=$l("useNavigate"),e=tn("useNavigate"),t=b.useRef(!1);return Hr(()=>{t.current=!0}),b.useCallback(async(s,n={})=>{it(t.current,Vr),t.current&&(typeof s=="number"?r.navigate(s):await r.navigate(s,{fromRouteId:e,...n}))},[r,e])}var $n={};function Ur(r,e,t){!e&&!$n[r]&&($n[r]=!0,it(!1,t))}b.memo(Kl);function Kl({routes:r,future:e,state:t,unstable_onError:i}){return Kr(r,void 0,t,i,e)}function Ul(r){he(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function jl({basename:r="/",children:e=null,location:t,navigationType:i="POP",navigator:s,static:n=!1}){he(!xi(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=r.replace(/^\/*/,"/"),o=b.useMemo(()=>({basename:a,navigator:s,static:n,future:{}}),[a,s,n]);typeof t=="string"&&(t=Zt(t));let{pathname:l="/",search:u="",hash:c="",state:h=null,key:d="default"}=t,f=b.useMemo(()=>{let p=ct(l,a);return p==null?null:{location:{pathname:p,search:u,hash:c,state:h,key:d},navigationType:i}},[a,l,u,c,h,d,i]);return it(f!=null,`<Router basename="${a}"> is not able to match the URL "${l}${u}${c}" because it does not start with the basename, so the <Router> won't render anything.`),f==null?null:b.createElement(st.Provider,{value:o},b.createElement(Ei.Provider,{children:e,value:f}))}function Md({children:r,location:e}){return Pl(Ls(r),e)}function Ls(r,e=[]){let t=[];return b.Children.forEach(r,(i,s)=>{if(!b.isValidElement(i))return;let n=[...e,s];if(i.type===b.Fragment){t.push.apply(t,Ls(i.props.children,n));return}he(i.type===Ul,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),he(!i.props.index||!i.props.children,"An index route cannot have child routes.");let a={id:i.props.id||n.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=Ls(i.props.children,n)),t.push(a)}),t}var zi="get",Gi="application/x-www-form-urlencoded";function is(r){return r!=null&&typeof r.tagName=="string"}function zl(r){return is(r)&&r.tagName.toLowerCase()==="button"}function Gl(r){return is(r)&&r.tagName.toLowerCase()==="form"}function Wl(r){return is(r)&&r.tagName.toLowerCase()==="input"}function ql(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function Xl(r,e){return r.button===0&&(!e||e==="_self")&&!ql(r)}var $i=null;function Yl(){if($i===null)try{new FormData(document.createElement("form"),0),$i=!1}catch{$i=!0}return $i}var Zl=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ys(r){return r!=null&&!Zl.has(r)?(it(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Gi}"`),null):r}function Jl(r,e){let t,i,s,n,a;if(Gl(r)){let o=r.getAttribute("action");i=o?ct(o,e):null,t=r.getAttribute("method")||zi,s=ys(r.getAttribute("enctype"))||Gi,n=new FormData(r)}else if(zl(r)||Wl(r)&&(r.type==="submit"||r.type==="image")){let o=r.form;if(o==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=r.getAttribute("formaction")||o.getAttribute("action");if(i=l?ct(l,e):null,t=r.getAttribute("formmethod")||o.getAttribute("method")||zi,s=ys(r.getAttribute("formenctype"))||ys(o.getAttribute("enctype"))||Gi,n=new FormData(o,r),!Yl()){let{name:u,type:c,value:h}=r;if(c==="image"){let d=u?`${u}.`:"";n.append(`${d}x`,"0"),n.append(`${d}y`,"0")}else u&&n.append(u,h)}}else{if(is(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=zi,i=null,s=Gi,a=r}return n&&s==="text/plain"&&(a=n,n=void 0),{action:i,method:t.toLowerCase(),encType:s,formData:n,body:a}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function sn(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Ql(r,e,t){let i=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return i.pathname==="/"?i.pathname=`_root.${t}`:e&&ct(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${t}`,i}async function eu(r,e){if(r.id in e)return e[r.id];try{let t=await import(r.module);return e[r.id]=t,t}catch(t){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function tu(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function iu(r,e,t){let i=await Promise.all(r.map(async s=>{let n=e.routes[s.route.id];if(n){let a=await eu(n,t);return a.links?a.links():[]}return[]}));return au(i.flat(1).filter(tu).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function On(r,e,t,i,s,n){let a=(l,u)=>t[u]?l.route.id!==t[u].route.id:!0,o=(l,u)=>t[u].pathname!==l.pathname||t[u].route.path?.endsWith("*")&&t[u].params["*"]!==l.params["*"];return n==="assets"?e.filter((l,u)=>a(l,u)||o(l,u)):n==="data"?e.filter((l,u)=>{let c=i.routes[l.route.id];if(!c||!c.hasLoader)return!1;if(a(l,u)||o(l,u))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(r,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function su(r,e,{includeHydrateFallback:t}={}){return nu(r.map(i=>{let s=e.routes[i.route.id];if(!s)return[];let n=[s.module];return s.clientActionModule&&(n=n.concat(s.clientActionModule)),s.clientLoaderModule&&(n=n.concat(s.clientLoaderModule)),t&&s.hydrateFallbackModule&&(n=n.concat(s.hydrateFallbackModule)),s.imports&&(n=n.concat(s.imports)),n}).flat(1))}function nu(r){return[...new Set(r)]}function ru(r){let e={},t=Object.keys(r).sort();for(let i of t)e[i]=r[i];return e}function au(r,e){let t=new Set;return new Set(e),r.reduce((i,s)=>{let n=JSON.stringify(ru(s));return t.has(n)||(t.add(n),i.push({key:n,link:s})),i},[])}function jr(){let r=b.useContext(Jt);return sn(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function ou(){let r=b.useContext(ts);return sn(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var nn=b.createContext(void 0);nn.displayName="FrameworkContext";function zr(){let r=b.useContext(nn);return sn(r,"You must render this element inside a <HydratedRouter> element"),r}function lu(r,e){let t=b.useContext(nn),[i,s]=b.useState(!1),[n,a]=b.useState(!1),{onFocus:o,onBlur:l,onMouseEnter:u,onMouseLeave:c,onTouchStart:h}=e,d=b.useRef(null);b.useEffect(()=>{if(r==="render"&&a(!0),r==="viewport"){let g=y=>{y.forEach(v=>{a(v.isIntersecting)})},m=new IntersectionObserver(g,{threshold:.5});return d.current&&m.observe(d.current),()=>{m.disconnect()}}},[r]),b.useEffect(()=>{if(i){let g=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(g)}}},[i]);let f=()=>{s(!0)},p=()=>{s(!1),a(!1)};return t?r!=="intent"?[n,d,{}]:[n,d,{onFocus:ii(o,f),onBlur:ii(l,p),onMouseEnter:ii(u,f),onMouseLeave:ii(c,p),onTouchStart:ii(h,f)}]:[!1,d,{}]}function ii(r,e){return t=>{r&&r(t),t.defaultPrevented||e(t)}}function uu({page:r,...e}){let{router:t}=jr(),i=b.useMemo(()=>Ir(t.routes,r,t.basename),[t.routes,r,t.basename]);return i?b.createElement(hu,{page:r,matches:i,...e}):null}function cu(r){let{manifest:e,routeModules:t}=zr(),[i,s]=b.useState([]);return b.useEffect(()=>{let n=!1;return iu(r,e,t).then(a=>{n||s(a)}),()=>{n=!0}},[r,e,t]),i}function hu({page:r,matches:e,...t}){let i=Lt(),{manifest:s,routeModules:n}=zr(),{basename:a}=jr(),{loaderData:o,matches:l}=ou(),u=b.useMemo(()=>On(r,e,l,s,i,"data"),[r,e,l,s,i]),c=b.useMemo(()=>On(r,e,l,s,i,"assets"),[r,e,l,s,i]),h=b.useMemo(()=>{if(r===i.pathname+i.search+i.hash)return[];let p=new Set,g=!1;if(e.forEach(y=>{let v=s.routes[y.route.id];!v||!v.hasLoader||(!u.some(A=>A.route.id===y.route.id)&&y.route.id in o&&n[y.route.id]?.shouldRevalidate||v.hasClientLoader?g=!0:p.add(y.route.id))}),p.size===0)return[];let m=Ql(r,a,"data");return g&&p.size>0&&m.searchParams.set("_routes",e.filter(y=>p.has(y.route.id)).map(y=>y.route.id).join(",")),[m.pathname+m.search]},[a,o,i,s,u,e,r,n]),d=b.useMemo(()=>su(c,s),[c,s]),f=cu(c);return b.createElement(b.Fragment,null,h.map(p=>b.createElement("link",{key:p,rel:"prefetch",as:"fetch",href:p,...t})),d.map(p=>b.createElement("link",{key:p,rel:"modulepreload",href:p,...t})),f.map(({key:p,link:g})=>b.createElement("link",{key:p,nonce:t.nonce,...g})))}function du(...r){return e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Gr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Gr&&(window.__reactRouterVersion="7.8.2")}catch{}function Id({basename:r,children:e,window:t}){let i=b.useRef();i.current==null&&(i.current=el({window:t,v5Compat:!0}));let s=i.current,[n,a]=b.useState({action:s.action,location:s.location}),o=b.useCallback(l=>{b.startTransition(()=>a(l))},[a]);return b.useLayoutEffect(()=>s.listen(o),[s,o]),b.createElement(jl,{basename:r,children:e,location:n.location,navigationType:n.action,navigator:s})}var Wr=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qr=b.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:s,reloadDocument:n,replace:a,state:o,target:l,to:u,preventScrollReset:c,viewTransition:h,...d},f){let{basename:p}=b.useContext(st),g=typeof u=="string"&&Wr.test(u),m,y=!1;if(typeof u=="string"&&g&&(m=u,Gr))try{let C=new URL(window.location.href),T=u.startsWith("//")?new URL(C.protocol+u):new URL(u),D=ct(T.pathname,p);T.origin===C.origin&&D!=null?u=D+T.search+T.hash:y=!0}catch{it(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let v=Tl(u,{relative:s}),[A,w,S]=lu(i,d),E=mu(u,{replace:a,state:o,target:l,preventScrollReset:c,relative:s,viewTransition:h});function x(C){e&&e(C),C.defaultPrevented||E(C)}let _=b.createElement("a",{...d,...S,href:m||v,onClick:y||n?e:x,ref:du(f,w),target:l,"data-discover":!g&&t==="render"?"true":void 0});return A&&!g?b.createElement(b.Fragment,null,_,b.createElement(uu,{page:v})):_});qr.displayName="Link";var fu=b.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:s=!1,style:n,to:a,viewTransition:o,children:l,...u},c){let h=Ci(a,{relative:u.relative}),d=Lt(),f=b.useContext(ts),{navigator:p,basename:g}=b.useContext(st),m=f!=null&&Au(h)&&o===!0,y=p.encodeLocation?p.encodeLocation(h).pathname:h.pathname,v=d.pathname,A=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;t||(v=v.toLowerCase(),A=A?A.toLowerCase():null,y=y.toLowerCase()),A&&g&&(A=ct(A,g)||A);const w=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let S=v===y||!s&&v.startsWith(y)&&v.charAt(w)==="/",E=A!=null&&(A===y||!s&&A.startsWith(y)&&A.charAt(y.length)==="/"),x={isActive:S,isPending:E,isTransitioning:m},_=S?e:void 0,C;typeof i=="function"?C=i(x):C=[i,S?"active":null,E?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let T=typeof n=="function"?n(x):n;return b.createElement(qr,{...u,"aria-current":_,className:C,ref:c,style:T,to:a,viewTransition:o},typeof l=="function"?l(x):l)});fu.displayName="NavLink";var pu=b.forwardRef(({discover:r="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:s,state:n,method:a=zi,action:o,onSubmit:l,relative:u,preventScrollReset:c,viewTransition:h,...d},f)=>{let p=vu(),g=wu(o,{relative:u}),m=a.toLowerCase()==="get"?"get":"post",y=typeof o=="string"&&Wr.test(o),v=A=>{if(l&&l(A),A.defaultPrevented)return;A.preventDefault();let w=A.nativeEvent.submitter,S=w?.getAttribute("formmethod")||a;p(w||A.currentTarget,{fetcherKey:e,method:S,navigate:t,replace:s,state:n,relative:u,preventScrollReset:c,viewTransition:h})};return b.createElement("form",{ref:f,method:m,action:g,onSubmit:i?l:v,...d,"data-discover":!y&&r==="render"?"true":void 0})});pu.displayName="Form";function gu(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Xr(r){let e=b.useContext(Jt);return he(e,gu(r)),e}function mu(r,{target:e,replace:t,state:i,preventScrollReset:s,relative:n,viewTransition:a}={}){let o=Rl(),l=Lt(),u=Ci(r,{relative:n});return b.useCallback(c=>{if(Xl(c,e)){c.preventDefault();let h=t!==void 0?t:gi(l)===gi(u);o(r,{replace:h,state:i,preventScrollReset:s,relative:n,viewTransition:a})}},[l,o,u,t,i,e,r,s,n,a])}var yu=0,bu=()=>`__${String(++yu)}__`;function vu(){let{router:r}=Xr("useSubmit"),{basename:e}=b.useContext(st),t=Bl();return b.useCallback(async(i,s={})=>{let{action:n,method:a,encType:o,formData:l,body:u}=Jl(i,e);if(s.navigate===!1){let c=s.fetcherKey||bu();await r.fetch(c,t,s.action||n,{preventScrollReset:s.preventScrollReset,formData:l,body:u,formMethod:s.method||a,formEncType:s.encType||o,flushSync:s.flushSync})}else await r.navigate(s.action||n,{preventScrollReset:s.preventScrollReset,formData:l,body:u,formMethod:s.method||a,formEncType:s.encType||o,replace:s.replace,state:s.state,fromRouteId:t,flushSync:s.flushSync,viewTransition:s.viewTransition})},[r,e,t])}function wu(r,{relative:e}={}){let{basename:t}=b.useContext(st),i=b.useContext(ft);he(i,"useFormAction must be used inside a RouteContext");let[s]=i.matches.slice(-1),n={...Ci(r||".",{relative:e})},a=Lt();if(r==null){n.search=a.search;let o=new URLSearchParams(n.search),l=o.getAll("index");if(l.some(c=>c==="")){o.delete("index"),l.filter(h=>h).forEach(h=>o.append("index",h));let c=o.toString();n.search=c?`?${c}`:""}}return(!r||r===".")&&s.route.index&&(n.search=n.search?n.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(n.pathname=n.pathname==="/"?t:ut([t,n.pathname])),gi(n)}function Au(r,{relative:e}={}){let t=b.useContext(Br);he(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=Xr("useViewTransitionState"),s=Ci(r,{relative:e});if(!t.isTransitioning)return!1;let n=ct(t.currentLocation.pathname,i)||t.currentLocation.pathname,a=ct(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Yi(s.pathname,a)!=null||Yi(s.pathname,n)!=null}const De=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Fs=[.001,0,0,.001,0,0],bs=1.35,Oe={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},tt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Yr="pdfjs_internal_editor_",U={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101},X={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},Zr={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Re={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},fi={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ge={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Vt={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},_i={ERRORS:0,WARNINGS:1,INFOS:5},mi={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Oi={moveTo:0,lineTo:1,curveTo:2,closePath:3},Jr={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let ss=_i.WARNINGS;function Su(r){Number.isInteger(r)&&(ss=r)}function Eu(){return ss}function ns(r){ss>=_i.INFOS&&console.log(`Info: ${r}`)}function z(r){ss>=_i.WARNINGS&&console.log(`Warning: ${r}`)}function se(r){throw new Error(r)}function Ae(r,e){r||se(e)}function xu(r){switch(r?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function rn(r,e=null,t=null){if(!r)return null;if(t&&typeof r=="string"&&(t.addDefaultProtocol&&r.startsWith("www.")&&r.match(/\./g)?.length>=2&&(r=`http://${r}`),t.tryConvertEncoding))try{r=ku(r)}catch{}const i=e?URL.parse(r,e):URL.parse(r);return xu(i)?i:null}function an(r,e,t=!1){const i=URL.parse(r);return i?(i.hash=e,i.href):t&&rn(r,"http://example.com")?r.split("#",1)[0]+`${e?`#${e}`:""}`:""}function q(r,e,t,i=!1){return Object.defineProperty(r,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}const Ft=(function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e})();class Nn extends Ft{constructor(e,t){super(e,"PasswordException"),this.code=t}}class vs extends Ft{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Zi extends Ft{constructor(e){super(e,"InvalidPDFException")}}class yi extends Ft{constructor(e,t,i){super(e,"ResponseException"),this.status=t,this.missing=i}}class Cu extends Ft{constructor(e){super(e,"FormatError")}}class ht extends Ft{constructor(e){super(e,"AbortException")}}function Qr(r){(typeof r!="object"||r?.length===void 0)&&se("Invalid argument for bytesToString");const e=r.length,t=8192;if(e<t)return String.fromCharCode.apply(null,r);const i=[];for(let s=0;s<e;s+=t){const n=Math.min(s+t,e),a=r.subarray(s,n);i.push(String.fromCharCode.apply(null,a))}return i.join("")}function Ti(r){typeof r!="string"&&se("Invalid argument for stringToBytes");const e=r.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=r.charCodeAt(i)&255;return t}function _u(r){return String.fromCharCode(r>>24&255,r>>16&255,r>>8&255,r&255)}function Tu(){const r=new Uint8Array(4);return r[0]=1,new Uint32Array(r.buffer,0,1)[0]===1}function Ru(){try{return new Function(""),!0}catch{return!1}}class Ce{static get isLittleEndian(){return q(this,"isLittleEndian",Tu())}static get isEvalSupported(){return q(this,"isEvalSupported",Ru())}static get isOffscreenCanvasSupported(){return q(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return q(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return q(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return q(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const ws=Array.from(Array(256).keys(),r=>r.toString(16).padStart(2,"0"));class N{static makeHexColor(e,t,i){return`#${ws[e]}${ws[t]}${ws[i]}`}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t,i=0){const s=e[i],n=e[i+1];e[i]=s*t[0]+n*t[2]+t[4],e[i+1]=s*t[1]+n*t[3]+t[5]}static applyTransformToBezier(e,t,i=0){const s=t[0],n=t[1],a=t[2],o=t[3],l=t[4],u=t[5];for(let c=0;c<6;c+=2){const h=e[i+c],d=e[i+c+1];e[i+c]=h*s+d*a+l,e[i+c+1]=h*n+d*o+u}}static applyInverseTransform(e,t){const i=e[0],s=e[1],n=t[0]*t[3]-t[1]*t[2];e[0]=(i*t[3]-s*t[2]+t[2]*t[5]-t[4]*t[3])/n,e[1]=(-i*t[1]+s*t[0]+t[4]*t[1]-t[5]*t[0])/n}static axialAlignedBoundingBox(e,t,i){const s=t[0],n=t[1],a=t[2],o=t[3],l=t[4],u=t[5],c=e[0],h=e[1],d=e[2],f=e[3];let p=s*c+l,g=p,m=s*d+l,y=m,v=o*h+u,A=v,w=o*f+u,S=w;if(n!==0||a!==0){const E=n*c,x=n*d,_=a*h,C=a*f;p+=_,y+=_,m+=C,g+=C,v+=E,S+=E,w+=x,A+=x}i[0]=Math.min(i[0],p,m,g,y),i[1]=Math.min(i[1],v,w,A,S),i[2]=Math.max(i[2],p,m,g,y),i[3]=Math.max(i[3],v,w,A,S)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const i=e[0],s=e[1],n=e[2],a=e[3],o=i**2+s**2,l=i*n+s*a,u=n**2+a**2,c=(o+u)/2,h=Math.sqrt(c**2-(o*u-l**2));t[0]=Math.sqrt(c+h||1),t[1]=Math.sqrt(c-h||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>s)return null;const n=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),a=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return n>a?null:[i,n,s,a]}static pointBoundingBox(e,t,i){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}static rectBoundingBox(e,t,i,s,n){n[0]=Math.min(n[0],e,i),n[1]=Math.min(n[1],t,s),n[2]=Math.max(n[2],e,i),n[3]=Math.max(n[3],t,s)}static#e(e,t,i,s,n,a,o,l,u,c){if(u<=0||u>=1)return;const h=1-u,d=u*u,f=d*u,p=h*(h*(h*e+3*u*t)+3*d*i)+f*s,g=h*(h*(h*n+3*u*a)+3*d*o)+f*l;c[0]=Math.min(c[0],p),c[1]=Math.min(c[1],g),c[2]=Math.max(c[2],p),c[3]=Math.max(c[3],g)}static#t(e,t,i,s,n,a,o,l,u,c,h,d){if(Math.abs(u)<1e-12){Math.abs(c)>=1e-12&&this.#e(e,t,i,s,n,a,o,l,-h/c,d);return}const f=c**2-4*h*u;if(f<0)return;const p=Math.sqrt(f),g=2*u;this.#e(e,t,i,s,n,a,o,l,(-c+p)/g,d),this.#e(e,t,i,s,n,a,o,l,(-c-p)/g,d)}static bezierBoundingBox(e,t,i,s,n,a,o,l,u){u[0]=Math.min(u[0],e,o),u[1]=Math.min(u[1],t,l),u[2]=Math.max(u[2],e,o),u[3]=Math.max(u[3],t,l),this.#t(e,i,n,o,t,s,a,l,3*(-e+3*(i-n)+o),6*(e-2*i+n),3*(i-e),u),this.#t(e,i,n,o,t,s,a,l,3*(-t+3*(s-a)+l),6*(t-2*s+a),3*(s-t),u)}}function ku(r){return decodeURIComponent(escape(r))}let As=null,Bn=null;function ea(r){return As||(As=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Bn=new Map([["ﬅ","ſt"]])),r.replaceAll(As,(e,t,i)=>t?t.normalize("NFKC"):Bn.get(i))}function on(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const r=new Uint8Array(32);return crypto.getRandomValues(r),Qr(r)}const ln="pdfjs_internal_id_";function Pu(r,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[i,s,...n]=t;if(!r(i)&&!Number.isInteger(i)||!e(s))return!1;const a=n.length;let o=!0;switch(s.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function ke(r,e,t){return Math.min(Math.max(r,e),t)}function ta(r){return Uint8Array.prototype.toBase64?r.toBase64():btoa(Qr(r))}function Du(r){return Uint8Array.fromBase64?Uint8Array.fromBase64(r):Ti(atob(r))}typeof Promise.try!="function"&&(Promise.try=function(r,...e){return new Promise(t=>{t(r(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(r){return r.reduce((e,t)=>e+t,0)});const at="http://www.w3.org/2000/svg";class Dt{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Qt(r,e="text"){if(ci(r,document.baseURI)){const t=await fetch(r);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{const s=new XMLHttpRequest;s.open("GET",r,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}i(new Error(s.statusText))}},s.send(null)})}class Ri{constructor({viewBox:e,userUnit:t,scale:i,rotation:s,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=e,this.userUnit=t,this.scale=i,this.rotation=s,this.offsetX=n,this.offsetY=a,i*=t;const l=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let c,h,d,f;switch(s%=360,s<0&&(s+=360),s){case 180:c=-1,h=0,d=0,f=1;break;case 90:c=0,h=1,d=1,f=0;break;case 270:c=0,h=-1,d=-1,f=0;break;case 0:c=1,h=0,d=0,f=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(d=-d,f=-f);let p,g,m,y;c===0?(p=Math.abs(u-e[1])*i+n,g=Math.abs(l-e[0])*i+a,m=(e[3]-e[1])*i,y=(e[2]-e[0])*i):(p=Math.abs(l-e[0])*i+n,g=Math.abs(u-e[1])*i+a,m=(e[2]-e[0])*i,y=(e[3]-e[1])*i),this.transform=[c*i,h*i,d*i,f*i,p-c*i*l-d*i*u,g-h*i*l-f*i*u],this.width=m,this.height=y}get rawDims(){const e=this.viewBox;return q(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:s=this.offsetY,dontFlip:n=!1}={}){return new Ri({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:n})}convertToViewportPoint(e,t){const i=[e,t];return N.applyTransform(i,this.transform),i}convertToViewportRectangle(e){const t=[e[0],e[1]];N.applyTransform(t,this.transform);const i=[e[2],e[3]];return N.applyTransform(i,this.transform),[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){const i=[e,t];return N.applyInverseTransform(i,this.transform),i}}class rs extends Ft{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function ki(r){const e=r.length;let t=0;for(;t<e&&r[t].trim()==="";)t++;return r.substring(t,t+5).toLowerCase()==="data:"}function as(r){return typeof r=="string"&&/\.pdf$/i.test(r)}function ia(r){return[r]=r.split(/[#?]/,1),r.substring(r.lastIndexOf("/")+1)}function sa(r,e="document.pdf"){if(typeof r!="string")return e;if(ki(r))return z('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const i=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(r);if(!i)return e;const s=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},n=/\.pdf$/i,a=i.pathname.split("/").at(-1);if(n.test(a))return s(a);if(i.searchParams.size>0){const o=Array.from(i.searchParams.values()).reverse();for(const u of o)if(n.test(u))return s(u);const l=Array.from(i.searchParams.keys()).reverse();for(const u of l)if(n.test(u))return s(u)}if(i.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(i.hash);if(l)return s(l[0])}return e}class Vn{started=Object.create(null);times=[];time(e){e in this.started&&z(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||z(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:s,end:n}of this.times)e.push(`${i.padEnd(t)} ${n-s}ms
`);return e.join("")}}function ci(r,e){const t=e?URL.parse(r,e):URL.parse(r);return t?.protocol==="http:"||t?.protocol==="https:"}function Ke(r){r.preventDefault()}function ye(r){r.preventDefault(),r.stopPropagation()}function Mu(r){console.log("Deprecated API usage: "+r)}class un{static#e;static toDateObject(e){if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const i=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let n=parseInt(t[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(t[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(t[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const u=t[7]||"Z";let c=parseInt(t[8],10);c=c>=0&&c<=23?c:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,u==="-"?(a+=c,o+=h):u==="+"&&(a-=c,o-=h),new Date(Date.UTC(i,s,n,a,o,l))}}function na(r,{scale:e=1,rotation:t=0}){const{width:i,height:s}=r.attributes.style,n=[0,0,parseInt(i),parseInt(s)];return new Ri({viewBox:n,userUnit:1,scale:e,rotation:t})}function cn(r){if(r.startsWith("#")){const e=parseInt(r.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return r.startsWith("rgb(")?r.slice(4,-1).split(",").map(e=>parseInt(e)):r.startsWith("rgba(")?r.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(z(`Not a valid color format: "${r}"`),[0,0,0])}function Iu(r){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of r.keys()){e.style.color=t;const i=window.getComputedStyle(e).color;r.set(t,cn(i))}e.remove()}function ce(r){const{a:e,b:t,c:i,d:s,e:n,f:a}=r.getTransform();return[e,t,i,s,n,a]}function Xe(r){const{a:e,b:t,c:i,d:s,e:n,f:a}=r.getTransform().invertSelf();return[e,t,i,s,n,a]}function vt(r,e,t=!1,i=!0){if(e instanceof Ri){const{pageWidth:s,pageHeight:n}=e.rawDims,{style:a}=r,o=Ce.isCSSRoundSupported,l=`var(--total-scale-factor) * ${s}px`,u=`var(--total-scale-factor) * ${n}px`,c=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,h=o?`round(down, ${u}, var(--scale-round-y))`:`calc(${u})`;!t||e.rotation%180===0?(a.width=c,a.height=h):(a.width=h,a.height=c)}i&&r.setAttribute("data-main-rotation",e.rotation)}class ze{constructor(){const{pixelRatio:e}=ze;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,i,s,n=-1){let a=1/0,o=1/0,l=1/0;i=ze.capPixels(i,n),i>0&&(a=Math.sqrt(i/(e*t))),s!==-1&&(o=s/e,l=s/t);const u=Math.min(a,o,l);return this.sx>u||this.sy>u?(this.sx=u,this.sy=u,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const i=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,i):i}return e}}const Ji=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class pi{#e=null;#t=null;#i;#s=null;#r=null;#n=null;static#o=null;constructor(e){this.#i=e,pi.#o||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#i._uiManager._signal;e.addEventListener("contextmenu",Ke,{signal:t}),e.addEventListener("pointerdown",pi.#a,{signal:t});const i=this.#s=document.createElement("div");i.className="buttons",e.append(i);const s=this.#i.toolbarPosition;if(s){const{style:n}=e,a=this.#i._uiManager.direction==="ltr"?1-s[0]:s[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#a(e){e.stopPropagation()}#h(e){this.#i._focusEventsAllowed=!1,ye(e)}#l(e){this.#i._focusEventsAllowed=!0,ye(e)}#d(e){const t=this.#i._uiManager._signal;e.addEventListener("focusin",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#l.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Ke,{signal:t})}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#r?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#i,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",pi.#o[e]),this.#d(i),i.addEventListener("click",s=>{t.delete()},{signal:t._signal}),this.#s.append(i)}get#c(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#d(t),this.#s.append(t,this.#c),this.#r=e}addColorPicker(e){this.#t=e;const t=e.renderButton();this.#d(t),this.#s.append(t,this.#c)}async addEditSignatureButton(e){const t=this.#n=await e.renderEditButton(this.#i);this.#d(t),this.#s.append(t,this.#c)}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break}}updateEditSignatureButton(e){this.#n&&(this.#n.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class Lu{#e=null;#t=null;#i;constructor(e){this.#i=e}#s(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",Ke,{signal:this.#i._signal});const t=this.#e=document.createElement("div");return t.className="buttons",e.append(t),this.#n(),e}#r(e,t){let i=0,s=0;for(const n of e){const a=n.y+n.height;if(a<i)continue;const o=n.x+(t?n.width:0);if(a>i){s=o,i=a;continue}t?o>s&&(s=o):o<s&&(s=o)}return[t?1-s:s,i]}show(e,t,i){const[s,n]=this.#r(t,i),{style:a}=this.#t||=this.#s();e.append(this.#t),a.insetInlineEnd=`${100*s}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#n(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const i=this.#i._signal;e.addEventListener("contextmenu",Ke,{signal:i}),e.addEventListener("click",()=>{this.#i.highlightSelection("floating_button")},{signal:i}),this.#e.append(e)}}function ra(r,e,t){for(const i of t)e.addEventListener(i,r[i].bind(r))}class Fu{#e=0;get id(){return`${Yr}${this.#e++}`}}class hn{#e=on();#t=0;#i=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;const n=s.decode().then(()=>(i.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return q(this,"_isSVGFittingCanvas",n)}async#s(e,t){this.#i||=new Map;let i=this.#i.get(e);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let s;if(typeof t=="string"?(i.url=t,s=await Qt(t,"blob")):t instanceof File?s=i.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){const n=hn._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((u,c)=>{o.onload=()=>{i.bitmap=o,i.isSvg=!0,u()},a.onload=async()=>{const h=i.svgUrl=a.result;o.src=await n?`${h}#svgView(preserveAspectRatio(none))`:h},o.onerror=a.onerror=c});a.readAsDataURL(s),await l}else i.bitmap=await createImageBitmap(s);i.refCounter=1}catch(s){z(s),i=null}return this.#i.set(e,i),i&&this.#i.set(i.id,i),i}async getFromFile(e){const{lastModified:t,name:i,size:s,type:n}=e;return this.#s(`${t}_${i}_${s}_${n}`,e)}async getFromUrl(e){return this.#s(e,e)}async getFromBlob(e,t){const i=await t;return this.#s(e,i)}async getFromId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#i||=new Map;let i=this.#i.get(e);if(i?.bitmap)return i.refCounter+=1,i;const s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),i={bitmap:s.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#i.set(e,i),this.#i.set(i.id,i),i}getSvgUrl(e){const t=this.#i.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:i}=t;if(!t.url&&!t.file){const s=new OffscreenCanvas(i.width,i.height);s.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=s.convertToBlob()}i.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class $u{#e=[];#t=!1;#i;#s=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:t,post:i,mustExec:s,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(s&&e(),this.#t)return;const l={cmd:e,undo:t,post:i,type:n};if(this.#s===-1){this.#e.length>0&&(this.#e.length=0),this.#s=0,this.#e.push(l);return}if(a&&this.#e[this.#s].type===n){o&&(l.undo=this.#e[this.#s].undo),this.#e[this.#s]=l;return}const u=this.#s+1;u===this.#i?this.#e.splice(0,1):(this.#s=u,u<this.#e.length&&this.#e.splice(u)),this.#e.push(l)}undo(){if(this.#s===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#s];e(),t?.(),this.#t=!1,this.#s-=1}redo(){if(this.#s<this.#e.length-1){this.#s+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#s];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#e.length-1}cleanType(e){if(this.#s!==-1){for(let t=this.#s;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#s-t),this.#s=t;return}this.#e.length=0,this.#s=-1}}destroy(){this.#e=null}}class Pi{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Ce.platform;for(const[i,s,n={}]of e)for(const a of i){const o=a.startsWith("mac+");t&&o?(this.callbacks.set(a.slice(4),{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1))):!t&&!o&&(this.callbacks.set(a,{callback:s,options:n}),this.allKeys.add(a.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(this.#e(t));if(!i)return;const{callback:s,options:{bubbles:n=!1,args:a=[],checker:o=null}}=i;o&&!o(e,t)||(s.bind(e,...a,t)(),n||ye(t))}}class dn{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return Iu(e),q(this,"_colors",e)}convert(e){const t=cn(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,s]of this._colors)if(s.every((n,a)=>n===t[a]))return dn._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?N.makeHexColor(...t):e}}class dt{#e=new AbortController;#t=null;#i=new Map;#s=new Map;#r=null;#n=null;#o=null;#a=new $u;#h=null;#l=null;#d=0;#c=new Set;#f=null;#p=null;#g=new Set;_editorUndoBar=null;#u=!1;#m=!1;#y=!1;#b=null;#w=null;#A=null;#S=null;#C=!1;#T=null;#k=new Fu;#E=!1;#R=!1;#_=null;#D=null;#M=null;#I=null;#V=null;#x=U.NONE;#v=new Set;#O=null;#N=null;#U=null;#j=null;#z={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#H=[0,0];#L=null;#F=null;#K=null;#X=null;#$=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=dt.prototype,t=a=>a.#F.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),i=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},s=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return q(this,"_keyboardManager",new Pi([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&a.#F.contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&a.#F.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:t}]]))}constructor(e,t,i,s,n,a,o,l,u,c,h,d,f,p,g){const m=this._signal=this.#e.signal;this.#F=e,this.#K=t,this.#X=i,this.#r=s,this.#N=n,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:m}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),a._on("setpreference",this.onSetPreference.bind(this),{signal:m}),a._on("switchannotationeditorparams",y=>this.updateParams(y.type,y.value),{signal:m}),this.#ne(),this.#le(),this.#Z(),this.#n=o.annotationStorage,this.#b=o.filterFactory,this.#U=l,this.#S=u||null,this.#u=c,this.#m=h,this.#y=d,this.#V=f||null,this.viewParameters={realScale:Dt.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=p||null,this._supportsPinchToZoom=g!==!1}destroy(){this.#$?.resolve(),this.#$=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#s.values())e.destroy();this.#s.clear(),this.#i.clear(),this.#g.clear(),this.#I?.clear(),this.#t=null,this.#v.clear(),this.#a.destroy(),this.#r?.destroy(),this.#N?.destroy(),this.#T?.hide(),this.#T=null,this.#M?.destroy(),this.#M=null,this.#w&&(clearTimeout(this.#w),this.#w=null),this.#L&&(clearTimeout(this.#L),this.#L=null),this._editorUndoBar?.destroy()}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#V}get useNewAltTextFlow(){return this.#m}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return q(this,"hcmFilter",this.#U?this.#b.addHCMFilter(this.#U.foreground,this.#U.background):"none")}get direction(){return q(this,"direction",getComputedStyle(this.#F).direction)}get highlightColors(){return q(this,"highlightColors",this.#S?new Map(this.#S.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColorNames(){return q(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#l=e}setMainHighlightColorPicker(e){this.#M=e}editAltText(e,t=!1){this.#r?.editAltText(this,e,t)}getSignature(e){this.#N?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#N}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":this.#y=t;break}}onPageChanging({pageNumber:e}){this.#d=e-1}focusMainContainer(){this.#F.focus()}findParent(e,t){for(const i of this.#s.values()){const{x:s,y:n,width:a,height:o}=i.div.getBoundingClientRect();if(e>=s&&e<=s+a&&t>=n&&t<=n+o)return i}return null}disableUserSelect(e=!1){this.#K.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#g.add(e)}removeShouldRescale(e){this.#g.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Dt.PDF_TO_CSS_UNITS;for(const t of this.#g)t.onScaleChanging();this.#l?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#W({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#Y(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const i of this.#s.values())if(i.hasTextLayer(e))return i;return null}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:a}=t,o=t.toString(),u=this.#W(t).closest(".textLayer"),c=this.getSelectionBoxes(u);if(!c)return;t.empty();const h=this.#Y(u),d=this.#x===U.NONE,f=()=>{h?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:c,anchorNode:i,anchorOffset:s,focusNode:n,focusOffset:a,text:o}),d&&this.showAllEditors("highlight",!0,!0)};if(d){this.switchToMode(U.HIGHLIGHT,f);return}f()}#ie(){const e=document.getSelection();if(!e||e.isCollapsed)return;const i=this.#W(e).closest(".textLayer"),s=this.getSelectionBoxes(i);s&&(this.#T||=new Lu(this),this.#T.show(i,s,this.direction==="ltr"))}addToAnnotationStorage(e){!e.isEmpty()&&this.#n&&!this.#n.has(e.id)&&this.#n.setValue(e.id,e)}a11yAlert(e,t=null){const i=this.#X;i&&(i.setAttribute("data-l10n-id",e),t?i.setAttribute("data-l10n-args",JSON.stringify(t)):i.removeAttribute("data-l10n-args"))}#se(){const e=document.getSelection();if(!e||e.isCollapsed){this.#O&&(this.#T?.hide(),this.#O=null,this.#P({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#O)return;const s=this.#W(e).closest(".textLayer");if(!s){this.#O&&(this.#T?.hide(),this.#O=null,this.#P({hasSelectedText:!1}));return}if(this.#T?.hide(),this.#O=t,this.#P({hasSelectedText:!0}),!(this.#x!==U.HIGHLIGHT&&this.#x!==U.NONE)&&(this.#x===U.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#C=this.isShiftKeyDown,!this.isShiftKeyDown)){const n=this.#x===U.HIGHLIGHT?this.#Y(s):null;n?.toggleDrawing();const a=new AbortController,o=this.combinedSignal(a),l=u=>{u.type==="pointerup"&&u.button!==0||(a.abort(),n?.toggleDrawing(!0),u.type==="pointerup"&&this.#q("main_toolbar"))};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})}}#q(e=""){this.#x===U.HIGHLIGHT?this.highlightSelection(e):this.#u&&this.#ie()}#ne(){document.addEventListener("selectionchange",this.#se.bind(this),{signal:this._signal})}#re(){if(this.#A)return;this.#A=new AbortController;const e=this.combinedSignal(this.#A);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#ae(){this.#A?.abort(),this.#A=null}blur(){if(this.isShiftKeyDown=!1,this.#C&&(this.#C=!1,this.#q("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#v)if(t.div.contains(e)){this.#D=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#D)return;const[e,t]=this.#D;this.#D=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#Z(){if(this.#_)return;this.#_=new AbortController;const e=this.combinedSignal(this.#_);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#oe(){this.#_?.abort(),this.#_=null}#J(){if(this.#h)return;this.#h=new AbortController;const e=this.combinedSignal(this.#h);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#Q(){this.#h?.abort(),this.#h=null}#le(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#Z(),this.#J()}removeEditListeners(){this.#oe(),this.#Q()}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const i of this.#p)if(i.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const i of this.#p)if(i.isHandlingMimeForPasting(t.type)){i.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of this.#v){const s=i.serialize(!0);s&&t.push(s)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const n of t.items)for(const a of this.#p)if(a.isHandlingMimeForPasting(n.type)){a.paste(n,this.currentLayer);return}let i=t.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(n){z(`paste: "${n.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const s=this.currentLayer;try{const n=[];for(const l of i){const u=await s.deserialize(l);if(!u)return;n.push(u)}const a=()=>{for(const l of n)this.#ee(l);this.#te(n)},o=()=>{for(const l of n)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(n){z(`paste: "${n.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#x!==U.NONE&&!this.isEditorHandlingKeyboard&&dt._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#C&&(this.#C=!1,this.#q("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}#P(e){Object.entries(e).some(([i,s])=>this.#z[i]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#z,e)}),this.#x===U.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#B([[X.HIGHLIGHT_FREE,!0]]))}#B(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#re(),this.#J(),this.#P({isEditing:this.#x!==U.NONE,isEmpty:this.#G(),hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:this.#a.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#ae(),this.#Q(),this.#P({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#p){this.#p=e;for(const t of this.#p)this.#B(t.defaultPropertiesToUpdate)}}getId(){return this.#k.id}get currentLayer(){return this.#s.get(this.#d)}getLayer(e){return this.#s.get(e)}get currentPageIndex(){return this.#d}addLayer(e){this.#s.set(e.pageIndex,e),this.#E?e.enable():e.disable()}removeLayer(e){this.#s.delete(e.pageIndex)}async updateMode(e,t=null,i=!1,s=!1){if(this.#x!==e&&!(this.#$&&(await this.#$.promise,!this.#$))){if(this.#$=Promise.withResolvers(),this.#l?.commitOrRemove(),this.#x=e,e===U.NONE){this.setEditingState(!1),this.#ce(),this._editorUndoBar?.hide(),this.#$.resolve();return}e===U.SIGNATURE&&await this.#N?.loadSignatures(),this.setEditingState(!0),await this.#ue(),this.unselectAll();for(const n of this.#s.values())n.updateMode(e);if(!t){i&&this.addNewEditorFromKeyboard(),this.#$.resolve();return}for(const n of this.#i.values())n.annotationElementId===t||n.id===t?(this.setSelected(n),s&&n.enterInEditMode()):n.unselect();this.#$.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#x&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#p){switch(e){case X.CREATE:this.currentLayer.addNewEditor(t);return;case X.HIGHLIGHT_DEFAULT_COLOR:this.#M?.updateColor(t);break;case X.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#j||=new Map).set(e,t),this.showAllEditors("highlight",t);break}for(const i of this.#v)i.updateParams(e,t);for(const i of this.#p)i.updateDefaultParams(e,t)}}showAllEditors(e,t,i=!1){for(const n of this.#i.values())n.editorType===e&&n.show(t);(this.#j?.get(X.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#B([[X.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#R!==e){this.#R=e;for(const t of this.#s.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#ue(){if(!this.#E){this.#E=!0;const e=[];for(const t of this.#s.values())e.push(t.enable());await Promise.all(e);for(const t of this.#i.values())t.enable()}}#ce(){if(this.unselectAll(),this.#E){this.#E=!1;for(const e of this.#s.values())e.disable();for(const e of this.#i.values())e.disable()}}getEditors(e){const t=[];for(const i of this.#i.values())i.pageIndex===e&&t.push(i);return t}getEditor(e){return this.#i.get(e)}addEditor(e){this.#i.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#w&&clearTimeout(this.#w),this.#w=setTimeout(()=>{this.focusMainContainer(),this.#w=null},0)),this.#i.delete(e.id),e.annotationElementId&&this.#I?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#c.has(e.annotationElementId))&&this.#n?.remove(e.id)}addDeletedAnnotationElement(e){this.#c.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#c.has(e)}removeDeletedAnnotationElement(e){this.#c.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#ee(e){const t=this.#s.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#B(e.propertiesToUpdate))}get#he(){let e=null;for(e of this.#v);return e}updateUI(e){this.#he===e&&this.#B(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#B(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#v.has(e)){this.#v.delete(e),e.unselect(),this.#P({hasSelectedEditor:this.hasSelection});return}this.#v.add(e),e.select(),this.#B(e.propertiesToUpdate),this.#P({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.id}),this.#l?.commitOrRemove();for(const t of this.#v)t!==e&&t.unselect();this.#v.clear(),this.#v.add(e),e.select(),this.#B(e.propertiesToUpdate),this.#P({hasSelectedEditor:!0})}isSelected(e){return this.#v.has(e)}get firstSelectedEditor(){return this.#v.values().next().value}unselect(e){e.unselect(),this.#v.delete(e),this.#P({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#v.size!==0}get isEnterHandled(){return this.#v.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#a.undo(),this.#P({hasSomethingToUndo:this.#a.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#G()}),this._editorUndoBar?.hide()}redo(){this.#a.redo(),this.#P({hasSomethingToUndo:!0,hasSomethingToRedo:this.#a.hasSomethingToRedo(),isEmpty:this.#G()})}addCommands(e){this.#a.add(e),this.#P({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#G()})}cleanUndoStack(e){this.#a.cleanType(e)}#G(){if(this.#i.size===0)return!0;if(this.#i.size===1)for(const e of this.#i.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#v],i=()=>{this._editorUndoBar?.show(s,t.length===1?t[0].editorType:t.length);for(const n of t)n.remove()},s=()=>{for(const n of t)this.#ee(n)};this.addCommands({cmd:i,undo:s,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#te(e){for(const t of this.#v)t.unselect();this.#v.clear();for(const t of e)t.isEmpty()||(this.#v.add(t),t.select());this.#P({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#v)e.commit();this.#te(this.#i.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#x!==U.NONE))&&!this.#l?.commitOrRemove()&&this.hasSelection){for(const e of this.#v)e.unselect();this.#v.clear(),this.#P({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#H[0]+=e,this.#H[1]+=t;const[s,n]=this.#H,a=[...this.#v],o=1e3;this.#L&&clearTimeout(this.#L),this.#L=setTimeout(()=>{this.#L=null,this.#H[0]=this.#H[1]=0,this.addCommands({cmd:()=>{for(const l of a)this.#i.has(l.id)&&(l.translateInPage(s,n),l.translationDone())},undo:()=>{for(const l of a)this.#i.has(l.id)&&(l.translateInPage(-s,-n),l.translationDone())},mustExec:!1})},o);for(const l of a)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#f=new Map;for(const e of this.#v)this.#f.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#f)return!1;this.disableUserSelect(!1);const e=this.#f;this.#f=null;let t=!1;for(const[{x:s,y:n,pageIndex:a},o]of e)o.newX=s,o.newY=n,o.newPageIndex=a,t||=s!==o.savedX||n!==o.savedY||a!==o.savedPageIndex;if(!t)return!1;const i=(s,n,a,o)=>{if(this.#i.has(s.id)){const l=this.#s.get(o);l?s._setParentAndPosition(l,n,a):(s.pageIndex=o,s.x=n,s.y=a)}};return this.addCommands({cmd:()=>{for(const[s,{newX:n,newY:a,newPageIndex:o}]of e)i(s,n,a,o)},undo:()=>{for(const[s,{savedX:n,savedY:a,savedPageIndex:o}]of e)i(s,n,a,o)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#f)for(const i of this.#f.keys())i.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#v.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#x}get imageManager(){return q(this,"imageManager",new hn)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,c=t.rangeCount;u<c;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:i,y:s,width:n,height:a}=e.getBoundingClientRect();let o;switch(e.getAttribute("data-main-rotation")){case"90":o=(u,c,h,d)=>({x:(c-s)/a,y:1-(u+h-i)/n,width:d/a,height:h/n});break;case"180":o=(u,c,h,d)=>({x:1-(u+h-i)/n,y:1-(c+d-s)/a,width:h/n,height:d/a});break;case"270":o=(u,c,h,d)=>({x:1-(c+d-s)/a,y:(u-i)/n,width:d/a,height:h/n});break;default:o=(u,c,h,d)=>({x:(u-i)/n,y:(c-s)/a,width:h/n,height:d/a});break}const l=[];for(let u=0,c=t.rangeCount;u<c;u++){const h=t.getRangeAt(u);if(!h.collapsed)for(const{x:d,y:f,width:p,height:g}of h.getClientRects())p===0||g===0||l.push(o(d,f,p,g))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#o||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#o?.delete(e)}renderAnnotationElement(e){const t=this.#o?.get(e.data.id);if(!t)return;const i=this.#n.getRawValue(t);i&&(this.#x===U.NONE&&!i.hasBeenModified||i.renderAnnotationElement(e))}setMissingCanvas(e,t,i){const s=this.#I?.get(e);s&&(s.setCanvas(t,i),this.#I.delete(e))}addMissingCanvas(e,t){(this.#I||=new Map).set(e,t)}}class Je{#e=null;#t=!1;#i=null;#s=null;#r=null;#n=null;#o=!1;#a=null;#h=null;#l=null;#d=null;#c=!1;static#f=null;static _l10n=null;constructor(e){this.#h=e,this.#c=e._uiManager.useNewAltTextFlow,Je.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){Je._l10n??=e}async render(){const e=this.#i=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#s=document.createElement("span");e.append(t),this.#c?(e.classList.add("new"),e.setAttribute("data-l10n-id",Je.#f.missing),t.setAttribute("data-l10n-id",Je.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=this.#h._uiManager._signal;e.addEventListener("contextmenu",Ke,{signal:i}),e.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:i});const s=n=>{n.preventDefault(),this.#h._uiManager.editAltText(this.#h),this.#c&&this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#p}})};return e.addEventListener("click",s,{capture:!0,signal:i}),e.addEventListener("keydown",n=>{n.target===e&&n.key==="Enter"&&(this.#o=!0,s(n))},{signal:i}),await this.#g(),e}get#p(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#o}),this.#o=!1)}isEmpty(){return this.#c?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#c?this.#e!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(e){this.#e===null&&(this.#l=e,this.#d=await Je._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#g())}toggleAltTextBadge(e=!1){if(!this.#c||this.#e){this.#a?.remove(),this.#a=null;return}if(!this.#a){const t=this.#a=document.createElement("div");t.className="noAltTextBadge",this.#h.div.append(t)}this.#a.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#l===t&&(t=this.#d),{altText:t,decorative:this.#t,guessedText:this.#l,textWithDisclaimer:this.#d}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:i,textWithDisclaimer:s,cancel:n=!1}){i&&(this.#l=i,this.#d=s),!(this.#e===e&&this.#t===t)&&(n||(this.#e=e,this.#t=t),this.#g())}toggle(e=!1){this.#i&&(!e&&this.#n&&(clearTimeout(this.#n),this.#n=null),this.#i.disabled=!e)}shown(){this.#h._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#p}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#r=null,this.#a?.remove(),this.#a=null}async#g(){const e=this.#i;if(!e)return;if(this.#c){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",Je.#f[this.#p]),this.#s?.setAttribute("data-l10n-id",Je.#f[`${this.#p}-label`]),!this.#e){this.#r?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#r?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#r;if(!t){this.#r=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#h.id}`;const s=100,n=this.#h._uiManager._signal;n.addEventListener("abort",()=>{clearTimeout(this.#n),this.#n=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#n=setTimeout(()=>{this.#n=null,this.#r.classList.add("show"),this.#h._reportTelemetry({action:"alt_text_tooltip"})},s)},{signal:n}),e.addEventListener("mouseleave",()=>{this.#n&&(clearTimeout(this.#n),this.#n=null),this.#r?.classList.remove("show")},{signal:n})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#h.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}class Di{#e;#t=!1;#i=null;#s;#r;#n;#o;#a=null;#h;#l=null;#d;#c=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:i=null,onPinchStart:s=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){this.#e=e,this.#i=i,this.#s=t,this.#r=s,this.#n=n,this.#o=a,this.#d=new AbortController,this.#h=AbortSignal.any([o,this.#d.signal]),e.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#h})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ze.pixelRatio}#f(e){if(this.#s?.())return;if(e.touches.length===1){if(this.#a)return;const s=this.#a=new AbortController,n=AbortSignal.any([this.#h,s.signal]),a=this.#e,o={capture:!0,signal:n,passive:!1},l=u=>{u.pointerType==="touch"&&(this.#a?.abort(),this.#a=null)};a.addEventListener("pointerdown",u=>{u.pointerType==="touch"&&(ye(u),l(u))},o),a.addEventListener("pointerup",l,o),a.addEventListener("pointercancel",l,o);return}if(!this.#c){this.#c=new AbortController;const s=AbortSignal.any([this.#h,this.#c.signal]),n=this.#e,a={signal:s,capture:!1,passive:!1};n.addEventListener("touchmove",this.#p.bind(this),a);const o=this.#g.bind(this);n.addEventListener("touchend",o,a),n.addEventListener("touchcancel",o,a),a.capture=!0,n.addEventListener("pointerdown",ye,a),n.addEventListener("pointermove",ye,a),n.addEventListener("pointercancel",ye,a),n.addEventListener("pointerup",ye,a),this.#r?.()}if(ye(e),e.touches.length!==2||this.#i?.()){this.#l=null;return}let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]),this.#l={touch0X:t.screenX,touch0Y:t.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#p(e){if(!this.#l||e.touches.length!==2)return;ye(e);let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]);const{screenX:s,screenY:n}=t,{screenX:a,screenY:o}=i,l=this.#l,{touch0X:u,touch0Y:c,touch1X:h,touch1Y:d}=l,f=h-u,p=d-c,g=a-s,m=o-n,y=Math.hypot(g,m)||1,v=Math.hypot(f,p)||1;if(!this.#t&&Math.abs(v-y)<=Di.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=s,l.touch0Y=n,l.touch1X=a,l.touch1Y=o,!this.#t){this.#t=!0;return}const A=[(s+a)/2,(n+o)/2];this.#n?.(A,v,y)}#g(e){e.touches.length>=2||(this.#c&&(this.#c.abort(),this.#c=null,this.#o?.()),this.#l&&(ye(e),this.#l=null,this.#t=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#a?.abort(),this.#a=null}}class V{#e=null;#t=null;#i=null;#s=!1;#r=null;#n="";#o=!1;#a=null;#h=null;#l=null;#d=null;#c="";#f=!1;#p=null;#g=!1;#u=!1;#m=!1;#y=null;#b=0;#w=0;#A=null;#S=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#C=!1;#T=V._zIndex++;static _borderLineWidth=-1;static _colorManager=new dn;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=V.prototype._resizeWithKeyboard,t=dt.TRANSLATE_SMALL,i=dt.TRANSLATE_BIG;return q(this,"_resizerKeyboardManager",new Pi([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],V.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null;const{rotation:t,rawDims:{pageWidth:i,pageHeight:s,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,s],this.pageTranslation=[n,a];const[o,l]=this.parentDimensions;this.x=e.x/o,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return q(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new Ou({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(V._l10n??=e,V._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),V._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);V._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){se("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#C}set _isDraggable(e){this.#C=e,this.div?.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#T}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):this.#K(),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#f?this.#f=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,s){const[n,a]=this.parentDimensions;[i,s]=this.screenToPageTranslation(i,s),this.x=(e+i)/n,this.y=(t+s)/a,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[i,s]=this.parentDimensions;this.setAt(e*i,t*s,this.width*i,this.height*s),this._onTranslated()}#k([e,t],i,s){[i,s]=this.screenToPageTranslation(i,s),this.x+=i/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#k(this.parentDimensions,e,t)}translateInPage(e,t){this.#p||=[this.x,this.y,this.width,this.height],this.#k(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#p||=[this.x,this.y,this.width,this.height];const{div:i,parentDimensions:[s,n]}=this;if(this.x+=e/s,this.y+=t/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:d}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,d)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,u]=this.getBaseTranslation();a+=l,o+=u;const{style:c}=i;c.left=`${(100*a).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#p&&(this.#p[0]!==this.x||this.#p[1]!==this.y)}get _hasBeenResized(){return!!this.#p&&(this.#p[2]!==this.width||this.#p[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:i}=V,s=i/e,n=i/t;switch(this.rotation){case 90:return[-s,n];case 180:return[s,n];case 270:return[s,-n];default:return[-s,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[i,s]}=this;let{x:n,y:a,width:o,height:l}=this;if(o*=i,l*=s,n*=i,a*=s,this._mustFixPosition)switch(e){case 0:n=ke(n,0,i-o),a=ke(a,0,s-l);break;case 90:n=ke(n,0,i-l),a=ke(a,o,s);break;case 180:n=ke(n,o,i),a=ke(a,l,s);break;case 270:n=ke(n,l,i),a=ke(a,0,s-o);break}this.x=n/=i,this.y=a/=s;const[u,c]=this.getBaseTranslation();n+=u,a+=c,t.left=`${(100*n).toFixed(2)}%`,t.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}static#E(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return V.#E(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return V.#E(e,t,360-this.parentRotation)}#R(e){switch(e){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(e,t){const[i,s]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*e/i).toFixed(2)}%`,this.#o||(n.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:i}=e,s=i.endsWith("%"),n=!this.#o&&t.endsWith("%");if(s&&n)return;const[a,o]=this.parentDimensions;s||(e.width=`${(100*parseFloat(i)/a).toFixed(2)}%`),!this.#o&&!n&&(e.height=`${(100*parseFloat(t)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#_(){if(this.#a)return;this.#a=document.createElement("div"),this.#a.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const i of e){const s=document.createElement("div");this.#a.append(s),s.classList.add("resizer",i),s.setAttribute("data-resizer-name",i),s.addEventListener("pointerdown",this.#D.bind(this,i),{signal:t}),s.addEventListener("contextmenu",Ke,{signal:t}),s.tabIndex=-1}this.div.prepend(this.#a)}#D(e,t){t.preventDefault();const{isMac:i}=Ce.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#i?.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,this.#h=[t.screenX,t.screenY];const n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#V.bind(this,e),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",ye,{passive:!1,signal:a}),window.addEventListener("contextmenu",Ke,{signal:a}),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=o,this.div.style.cursor=l,this.#I()};window.addEventListener("pointerup",u,{signal:a}),window.addEventListener("blur",u,{signal:a})}#M(e,t,i,s){this.width=i,this.height=s,this.x=e,this.y=t;const[n,a]=this.parentDimensions;this.setDims(n*i,a*s),this.fixAndSetPosition(),this._onResized()}_onResized(){}#I(){if(!this.#l)return;const{savedX:e,savedY:t,savedWidth:i,savedHeight:s}=this.#l;this.#l=null;const n=this.x,a=this.y,o=this.width,l=this.height;n===e&&a===t&&o===i&&l===s||this.addCommands({cmd:this.#M.bind(this,n,a,o,l),undo:this.#M.bind(this,e,t,i,s),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#V(e,t){const[i,s]=this.parentDimensions,n=this.x,a=this.y,o=this.width,l=this.height,u=V.MIN_SIZE/i,c=V.MIN_SIZE/s,h=this.#R(this.rotation),d=(P,M)=>[h[0]*P+h[2]*M,h[1]*P+h[3]*M],f=this.#R(360-this.rotation),p=(P,M)=>[f[0]*P+f[2]*M,f[1]*P+f[3]*M];let g,m,y=!1,v=!1;switch(e){case"topLeft":y=!0,g=(P,M)=>[0,0],m=(P,M)=>[P,M];break;case"topMiddle":g=(P,M)=>[P/2,0],m=(P,M)=>[P/2,M];break;case"topRight":y=!0,g=(P,M)=>[P,0],m=(P,M)=>[0,M];break;case"middleRight":v=!0,g=(P,M)=>[P,M/2],m=(P,M)=>[0,M/2];break;case"bottomRight":y=!0,g=(P,M)=>[P,M],m=(P,M)=>[0,0];break;case"bottomMiddle":g=(P,M)=>[P/2,M],m=(P,M)=>[P/2,0];break;case"bottomLeft":y=!0,g=(P,M)=>[0,M],m=(P,M)=>[P,0];break;case"middleLeft":v=!0,g=(P,M)=>[0,M/2],m=(P,M)=>[P,M/2];break}const A=g(o,l),w=m(o,l);let S=d(...w);const E=V._round(n+S[0]),x=V._round(a+S[1]);let _=1,C=1,T,D;if(t.fromKeyboard)({deltaX:T,deltaY:D}=t);else{const{screenX:P,screenY:M}=t,[O,J]=this.#h;[T,D]=this.screenToPageTranslation(P-O,M-J),this.#h[0]=P,this.#h[1]=M}if([T,D]=p(T/i,D/s),y){const P=Math.hypot(o,l);_=C=Math.max(Math.min(Math.hypot(w[0]-A[0]-T,w[1]-A[1]-D)/P,1/o,1/l),u/o,c/l)}else v?_=ke(Math.abs(w[0]-A[0]-T),u,1)/o:C=ke(Math.abs(w[1]-A[1]-D),c,1)/l;const B=V._round(o*_),k=V._round(l*C);S=d(...m(B,k));const R=E-S[0],$=x-S[1];this.#p||=[this.x,this.y,this.width,this.height],this.width=B,this.height=k,this.x=R,this.y=$,this.setDims(i*B,s*k),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#u)return this._editToolbar;this._editToolbar=new pi(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,i]of e)await this._editToolbar.addButton(t,i);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,this.#i?.destroy())}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(Je.initialize(V._l10n),this.#i=new Je(this),this.#e&&(this.#i.data=this.#e,this.#e=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(e){this.#i&&(this.#i.data=e)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(e){await this.#i?.setGuessedText(e)}serializeAltText(e){return this.#i?.serialize(e)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#s?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#j();const[t,i]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*i/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/i).toFixed(2)}%`);const[s,n]=this.getInitialTranslation();return this.translate(s,n),ra(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#S||=new Di({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#x.bind(this),onPinching:this.#v.bind(this),onPinchEnd:this.#O.bind(this),signal:this._uiManager._signal})),this._uiManager._editorUndoBar?.hide(),e}#x(){this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#v(e,t,i){let n=.7*(i/t)+1-.7;if(n===1)return;const a=this.#R(this.rotation),o=(E,x)=>[a[0]*E+a[2]*x,a[1]*E+a[3]*x],[l,u]=this.parentDimensions,c=this.x,h=this.y,d=this.width,f=this.height,p=V.MIN_SIZE/l,g=V.MIN_SIZE/u;n=Math.max(Math.min(n,1/d,1/f),p/d,g/f);const m=V._round(d*n),y=V._round(f*n);if(m===d&&y===f)return;this.#p||=[c,h,d,f];const v=o(d/2,f/2),A=V._round(c+v[0]),w=V._round(h+v[1]),S=o(m/2,y/2);this.x=A-S[0],this.y=w-S[1],this.width=m,this.height=y,this.setDims(l*m,u*y),this.fixAndSetPosition(),this._onResizing()}#O(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#I()}pointerdown(e){const{isMac:t}=Ce.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#f=!0,this._isDraggable){this.#U(e);return}this.#N(e)}#N(e){const{isMac:t}=Ce.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let i=!1;const s=new AbortController,n=this._uiManager.combinedSignal(s),a={capture:!0,passive:!1,signal:n},o=u=>{s.abort(),this.#r=null,this.#f=!1,this._uiManager.endDragSession()||this.#N(u),i&&this._onStopDragging()};t&&(this.#b=e.clientX,this.#w=e.clientY,this.#r=e.pointerId,this.#n=e.pointerType,window.addEventListener("pointermove",u=>{i||(i=!0,this._onStartDragging());const{clientX:c,clientY:h,pointerId:d}=u;if(d!==this.#r){ye(u);return}const[f,p]=this.screenToPageTranslation(c-this.#b,h-this.#w);this.#b=c,this.#w=h,this._uiManager.dragSelectedEditors(f,p)},a),window.addEventListener("touchmove",ye,a),window.addEventListener("pointerdown",u=>{u.pointerType===this.#n&&(this.#S||u.isPrimary)&&o(u),ye(u)},a));const l=u=>{if(!this.#r||this.#r===u.pointerId){o(u);return}ye(u)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){const s=this.parentScale,[n,a]=this.pageDimensions,[o,l]=this.pageTranslation,u=e/s,c=t/s,h=this.x*n,d=this.y*a,f=this.width*n,p=this.height*a;switch(i){case 0:return[h+u+o,a-d-c-p+l,h+u+f+o,a-d-c+l];case 90:return[h+c+o,a-d+u+l,h+c+p+o,a-d+u+f+l];case 180:return[h-u-f+o,a-d+c+l,h-u+o,a-d+c+p+l];case 270:return[h-c-p+o,a-d-u-f+l,h-c+o,a-d-u+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,s,n,a]=e,o=n-i,l=a-s;switch(this.rotation){case 0:return[i,t-a,o,l];case 90:return[i,t-s,l,o];case 180:return[n,t-s,o,l];case 270:return[n,t-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#u=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#u=!1,!0):!1}isInEditMode(){return this.#u}shouldGetKeyboardEvents(){return this.#m}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:i,right:s}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return t<a&&s>0&&e<n&&i>0}#j(){if(this.#d||!this.div)return;this.#d=new AbortController;const e=this._uiManager.combinedSignal(this.#d);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#j()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){se("An editor must be serializable")}static async deserialize(e,t,i){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i,annotationElementId:e.annotationElementId});s.rotation=e.rotation,s.#e=e.accessibilityData,s._isCopy=e.isCopy||!1;const[n,a]=s.pageDimensions,[o,l,u,c]=s.getRectInCurrentCoords(e.rect,a);return s.x=o/n,s.y=l/a,s.width=u/n,s.height=c/a,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#d?.abort(),this.#d=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#K(),this.removeEditToolbar(),this.#A){for(const e of this.#A.values())clearTimeout(e);this.#A=null}this.parent=null,this.#S?.destroy(),this.#S=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#_(),this.#a.classList.remove("hidden"))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#l={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#a.children;if(!this.#t){this.#t=Array.from(t);const a=this.#z.bind(this),o=this.#H.bind(this),l=this._uiManager._signal;for(const u of this.#t){const c=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",a,{signal:l}),u.addEventListener("blur",o,{signal:l}),u.addEventListener("focus",this.#L.bind(this,c),{signal:l}),u.setAttribute("data-l10n-id",V._l10nResizer[c])}}const i=this.#t[0];let s=0;for(const a of t){if(a===i)break;s++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(n!==s){if(n<s)for(let o=0;o<s-n;o++)this.#a.append(this.#a.firstChild);else if(n>s)for(let o=0;o<n-s;o++)this.#a.firstChild.before(this.#a.lastChild);let a=0;for(const o of t){const u=this.#t[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",V._l10nResizer[u])}}this.#F(0),this.#m=!0,this.#a.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#z(e){V._resizerKeyboardManager.exec(this,e)}#H(e){this.#m&&e.relatedTarget?.parentNode!==this.#a&&this.#K()}#L(e){this.#c=this.#m?e:""}#F(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#m&&this.#V(this.#c,{deltaX:e,deltaY:t,fromKeyboard:!0})}#K(){this.#m=!1,this.#F(-1),this.#I()}_stopResizingWithKeyboard(){this.#K(),this.div.focus()}select(){if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}}unselect(){this.isSelected&&(this.isSelected=!1,this.#a?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#g}set isEditing(e){this.#g=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){this.#o=!0;const i=e/t,{style:s}=this.div;s.aspectRatio=i,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#A||=new Map;const{action:i}=e;let s=this.#A.get(i);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),this.#A.delete(i),this.#A.size===0&&(this.#A=null)},V._telemetryTimeout),this.#A.set(i,s);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class Ou extends V{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Hn=3285377520,Ve=4294901760,Ye=65535;class aa{constructor(e){this.h1=e?e&4294967295:Hn,this.h2=e?e&4294967295:Hn}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let g=0,m=e.length;g<m;g++){const y=e.charCodeAt(g);y<=255?t[i++]=y:(t[i++]=y>>>8,t[i++]=y&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=i>>2,n=i-s*4,a=new Uint32Array(t.buffer,0,s);let o=0,l=0,u=this.h1,c=this.h2;const h=3432918353,d=461845907,f=h&Ye,p=d&Ye;for(let g=0;g<s;g++)g&1?(o=a[g],o=o*h&Ve|o*f&Ye,o=o<<15|o>>>17,o=o*d&Ve|o*p&Ye,u^=o,u=u<<13|u>>>19,u=u*5+3864292196):(l=a[g],l=l*h&Ve|l*f&Ye,l=l<<15|l>>>17,l=l*d&Ve|l*p&Ye,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,n){case 3:o^=t[s*4+2]<<16;case 2:o^=t[s*4+1]<<8;case 1:o^=t[s*4],o=o*h&Ve|o*f&Ye,o=o<<15|o>>>17,o=o*d&Ve|o*p&Ye,s&1?u^=o:c^=o}this.h1=u,this.h2=c}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Ve|e*36045&Ye,t=t*4283543511&Ve|((t<<16|e>>>16)*2950163797&Ve)>>>16,e^=t>>>1,e=e*444984403&Ve|e*60499&Ye,t=t*3301882366&Ve|((t<<16|e>>>16)*3120437893&Ve)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const $s=Object.freeze({map:null,hash:"",transfer:void 0});class fn{#e=!1;#t=null;#i=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=this.#i.get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return this.#i.get(e)}remove(e){if(this.#i.delete(e),this.#i.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of this.#i.values())if(t instanceof V)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=this.#i.get(e);let s=!1;if(i!==void 0)for(const[n,a]of Object.entries(t))i[n]!==a&&(s=!0,i[n]=a);else s=!0,this.#i.set(e,t);s&&this.#s(),t instanceof V&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return this.#i.has(e)}get size(){return this.#i.size}#s(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new oa(this)}get serializable(){if(this.#i.size===0)return $s;const e=new Map,t=new aa,i=[],s=Object.create(null);let n=!1;for(const[a,o]of this.#i){const l=o instanceof V?o.serialize(!1,s):o;l&&(e.set(a,l),t.update(`${a}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(const a of e.values())a.bitmap&&i.push(a.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:$s}get editorStats(){let e=null;const t=new Map;for(const i of this.#i.values()){if(!(i instanceof V))continue;const s=i.telemetryFinalData;if(!s)continue;const{type:n}=s;t.has(n)||t.set(n,Object.getPrototypeOf(i).constructor),e||=Object.create(null);const a=e[n]||=new Map;for(const[o,l]of Object.entries(s)){if(o==="type")continue;let u=a.get(o);u||(u=new Map,a.set(o,u));const c=u.get(l)??0;u.set(l,c+1)}}for(const[i,s]of t)e[i]=s.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){this.#t=null}get modifiedIds(){if(this.#t)return this.#t;const e=[];for(const t of this.#i.values())!(t instanceof V)||!t.annotationElementId||!t.serialize()||e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#i.entries()}}class oa extends fn{#e;constructor(e){super();const{map:t,hash:i,transfer:s}=e.serializable,n=structuredClone(t,s?{transfer:s}:null);this.#e={map:n,hash:i,transfer:s}}get print(){se("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return q(this,"modifiedIds",{ids:new Set,hash:""})}}class Nu{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:i}){if(!(!e||this.#e.has(e.loadedName))){if(Ae(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:n,style:a}=e,o=new FontFace(s,n,a);this.addNativeFontFace(o);try{await o.load(),this.#e.add(s),i?.(e)}catch{z(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}se("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(s){throw z(`Failed to load font '${i.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const s=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return q(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return q(this,"isSyncFontLoadingSupported",De||Ce.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Ae(!s.done,"completeRequest() cannot be called twice."),s.done=!0;i.length>0&&i[0].done;){const n=i.shift();setTimeout(n.callback,0)}}const{loadingRequests:i}=this,s={done:!1,complete:t,callback:e};return i.push(s),s}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return q(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(w,S){return w.charCodeAt(S)<<24|w.charCodeAt(S+1)<<16|w.charCodeAt(S+2)<<8|w.charCodeAt(S+3)&255}function s(w,S,E,x){const _=w.substring(0,S),C=w.substring(S+E);return _+x+C}let n,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let u=0;function c(w,S){if(++u>30){z("Load test font never loaded."),S();return}if(l.font="30px "+w,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){S();return}setTimeout(c.bind(null,w,S))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let d=this._loadTestFont;d=s(d,976,h.length,h);const p=16,g=1482184792;let m=i(d,p);for(n=0,a=h.length-3;n<a;n+=4)m=m-g+i(h,n)|0;n<h.length&&(m=m-g+i(h+"XXX",n)|0),d=s(d,p,4,_u(m));const y=`url(data:font/opentype;base64,${btoa(d)});`,v=`@font-face {font-family:"${h}";src:${y}}`;this.insertRule(v);const A=this._document.createElement("div");A.style.visibility="hidden",A.style.width=A.style.height="10px",A.style.position="absolute",A.style.top=A.style.left="0px";for(const w of[e.loadedName,h]){const S=this._document.createElement("span");S.textContent="Hi",S.style.fontFamily=w,A.append(S)}this._document.body.append(A),c(h,()=>{A.remove(),t.complete()})}}class Bu{constructor(e,t=null){this.compiledGlyphs=Object.create(null);for(const i in e)this[i]=e[i];this._inspectFont=t}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${ta(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const i=this.loadedName+"_path_"+t;let s;try{s=e.get(i)}catch(a){z(`getPathGenerator - ignoring character: "${a}".`)}const n=new Path2D(s||"");return this.fontExtraProperties||e.delete(i),this.compiledGlyphs[t]=n}}function Vu(r){if(r instanceof URL)return r.href;if(typeof r=="string"){if(De)return r;const e=URL.parse(r,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Hu(r){if(De&&typeof Buffer<"u"&&r instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength)return r;if(typeof r=="string")return Ti(r);if(r instanceof ArrayBuffer||ArrayBuffer.isView(r)||typeof r=="object"&&!isNaN(r?.length))return new Uint8Array(r);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Ni(r){if(typeof r!="string")return null;if(r.endsWith("/"))return r;throw new Error(`Invalid factory url: "${r}" must include trailing slash.`)}const Os=r=>typeof r=="object"&&Number.isInteger(r?.num)&&r.num>=0&&Number.isInteger(r?.gen)&&r.gen>=0,Ku=r=>typeof r=="object"&&typeof r?.name=="string",la=Pu.bind(null,Os,Ku);class Uu{#e=new Map;#t=Promise.resolve();postMessage(e,t){const i={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[s]of this.#e)s.call(this,i)})}addEventListener(e,t,i=null){let s=null;if(i?.signal instanceof AbortSignal){const{signal:n}=i;if(n.aborted){z("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(e,t);s=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}this.#e.set(t,s)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const Bi={DATA:1,ERROR:2},we={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Kn(){}function Le(r){if(r instanceof ht||r instanceof Zi||r instanceof Nn||r instanceof yi||r instanceof vs)return r;switch(r instanceof Error||typeof r=="object"&&r!==null||se('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),r.name){case"AbortException":return new ht(r.message);case"InvalidPDFException":return new Zi(r.message);case"PasswordException":return new Nn(r.message,r.code);case"ResponseException":return new yi(r.message,r.status,r.missing);case"UnknownErrorException":return new vs(r.message,r.details)}return new vs(r.message,r.toString())}class hi{#e=new AbortController;constructor(e,t,i){this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#s(e);return}if(e.callback){const i=e.callbackId,s=this.callbackCapabilities[i];if(!s)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===Bi.DATA)s.resolve(e.data);else if(e.callback===Bi.ERROR)s.reject(Le(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const i=this.sourceName,s=e.sourceName,n=this.comObj;Promise.try(t,e.data).then(function(a){n.postMessage({sourceName:i,targetName:s,callback:Bi.DATA,callbackId:e.callbackId,data:a})},function(a){n.postMessage({sourceName:i,targetName:s,callback:Bi.ERROR,callbackId:e.callbackId,reason:Le(a)})});return}if(e.streamId){this.#i(e);return}t(e.data)}on(e,t){const i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const s=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[s]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},i)}catch(a){n.reject(a)}return n.promise}sendWithStream(e,t,i,s){const n=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:u=>{const c=Promise.withResolvers();return this.streamControllers[n]={controller:u,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:e,streamId:n,data:t,desiredSize:u.desiredSize},s),c.promise},pull:u=>{const c=Promise.withResolvers();return this.streamControllers[n].pullCall=c,l.postMessage({sourceName:a,targetName:o,stream:we.PULL,streamId:n,desiredSize:u.desiredSize}),c.promise},cancel:u=>{Ae(u instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[n].cancelCall=c,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:we.CANCEL,streamId:n,reason:Le(u)}),c.promise}},i)}#i(e){const t=e.streamId,i=this.sourceName,s=e.sourceName,n=this.comObj,a=this,o=this.actionHandler[e.action],l={enqueue(u,c=1,h){if(this.isCancelled)return;const d=this.desiredSize;this.desiredSize-=c,d>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:i,targetName:s,stream:we.ENQUEUE,streamId:t,chunk:u},h)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:we.CLOSE,streamId:t}),delete a.streamSinks[t])},error(u){Ae(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:i,targetName:s,stream:we.ERROR,streamId:t,reason:Le(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(o,e.data,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:we.START_COMPLETE,streamId:t,success:!0})},function(u){n.postMessage({sourceName:i,targetName:s,stream:we.START_COMPLETE,streamId:t,reason:Le(u)})})}#s(e){const t=e.streamId,i=this.sourceName,s=e.sourceName,n=this.comObj,a=this.streamControllers[t],o=this.streamSinks[t];switch(e.stream){case we.START_COMPLETE:e.success?a.startCall.resolve():a.startCall.reject(Le(e.reason));break;case we.PULL_COMPLETE:e.success?a.pullCall.resolve():a.pullCall.reject(Le(e.reason));break;case we.PULL:if(!o){n.postMessage({sourceName:i,targetName:s,stream:we.PULL_COMPLETE,streamId:t,success:!0});break}o.desiredSize<=0&&e.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=e.desiredSize,Promise.try(o.onPull||Kn).then(function(){n.postMessage({sourceName:i,targetName:s,stream:we.PULL_COMPLETE,streamId:t,success:!0})},function(u){n.postMessage({sourceName:i,targetName:s,stream:we.PULL_COMPLETE,streamId:t,reason:Le(u)})});break;case we.ENQUEUE:if(Ae(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(e.chunk);break;case we.CLOSE:if(Ae(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),this.#r(a,t);break;case we.ERROR:Ae(a,"error should have stream controller"),a.controller.error(Le(e.reason)),this.#r(a,t);break;case we.CANCEL_COMPLETE:e.success?a.cancelCall.resolve():a.cancelCall.reject(Le(e.reason)),this.#r(a,t);break;case we.CANCEL:if(!o)break;const l=Le(e.reason);Promise.try(o.onCancel||Kn,l).then(function(){n.postMessage({sourceName:i,targetName:s,stream:we.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){n.postMessage({sourceName:i,targetName:s,stream:we.CANCEL_COMPLETE,streamId:t,reason:Le(u)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#r(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class ua{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){se("Abstract method `_createCanvas` called.")}}class ju extends ua{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}class ca{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){se("Abstract method `_fetch` called.")}}class Un extends ca{async _fetch(e){const t=await Qt(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Ti(t)}}class ha{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,s,n){return"none"}destroy(e=!1){}}class zu extends ha{#e;#t;#i;#s;#r;#n;#o=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#s=e,this.#r=t}get#a(){return this.#t||=new Map}get#h(){return this.#n||=new Map}get#l(){if(!this.#i){const e=this.#r.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const i=this.#r.createElementNS(at,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#i=this.#r.createElementNS(at,"defs"),e.append(i),i.append(this.#i),this.#r.body.append(e)}return this.#i}#d(e){if(e.length===1){const l=e[0],u=new Array(256);for(let h=0;h<256;h++)u[h]=l[h]/255;const c=u.join(",");return[c,c,c]}const[t,i,s]=e,n=new Array(256),a=new Array(256),o=new Array(256);for(let l=0;l<256;l++)n[l]=t[l]/255,a[l]=i[l]/255,o[l]=s[l]/255;return[n.join(","),a.join(","),o.join(",")]}#c(e){if(this.#e===void 0){this.#e="";const t=this.#r.URL;t!==this.#r.baseURI&&(ki(t)?z('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=an(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#a.get(e);if(t)return t;const[i,s,n]=this.#d(e),a=e.length===1?i:`${i}${s}${n}`;if(t=this.#a.get(a),t)return this.#a.set(e,t),t;const o=`g_${this.#s}_transfer_map_${this.#o++}`,l=this.#c(o);this.#a.set(e,l),this.#a.set(a,l);const u=this.#g(o);return this.#m(i,s,n,u),l}addHCMFilter(e,t){const i=`${e}-${t}`,s="base";let n=this.#h.get(s);if(n?.key===i||(n?(n.filter?.remove(),n.key=i,n.url="none",n.filter=null):(n={key:i,url:"none",filter:null},this.#h.set(s,n)),!e||!t))return n.url;const a=this.#b(e);e=N.makeHexColor(...a);const o=this.#b(t);if(t=N.makeHexColor(...o),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return n.url;const l=new Array(256);for(let f=0;f<=255;f++){const p=f/255;l[f]=p<=.03928?p/12.92:((p+.055)/1.055)**2.4}const u=l.join(","),c=`g_${this.#s}_hcm_filter`,h=n.filter=this.#g(c);this.#m(u,u,u,h),this.#p(h);const d=(f,p)=>{const g=a[f]/255,m=o[f]/255,y=new Array(p+1);for(let v=0;v<=p;v++)y[v]=g+v/p*(m-g);return y.join(",")};return this.#m(d(0,5),d(1,5),d(2,5),h),n.url=this.#c(c),n.url}addAlphaFilter(e){let t=this.#a.get(e);if(t)return t;const[i]=this.#d([e]),s=`alpha_${i}`;if(t=this.#a.get(s),t)return this.#a.set(e,t),t;const n=`g_${this.#s}_alpha_map_${this.#o++}`,a=this.#c(n);this.#a.set(e,a),this.#a.set(s,a);const o=this.#g(n);return this.#y(i,o),a}addLuminosityFilter(e){let t=this.#a.get(e||"luminosity");if(t)return t;let i,s;if(e?([i]=this.#d([e]),s=`luminosity_${i}`):s="luminosity",t=this.#a.get(s),t)return this.#a.set(e,t),t;const n=`g_${this.#s}_luminosity_map_${this.#o++}`,a=this.#c(n);this.#a.set(e,a),this.#a.set(s,a);const o=this.#g(n);return this.#f(o),e&&this.#y(i,o),a}addHighlightHCMFilter(e,t,i,s,n){const a=`${t}-${i}-${s}-${n}`;let o=this.#h.get(e);if(o?.key===a||(o?(o.filter?.remove(),o.key=a,o.url="none",o.filter=null):(o={key:a,url:"none",filter:null},this.#h.set(e,o)),!t||!i))return o.url;const[l,u]=[t,i].map(this.#b.bind(this));let c=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),h=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),[d,f]=[s,n].map(this.#b.bind(this));h<c&&([c,h,d,f]=[h,c,f,d]),this.#l.style.color="";const p=(y,v,A)=>{const w=new Array(256),S=(h-c)/A,E=y/255,x=(v-y)/(255*A);let _=0;for(let C=0;C<=A;C++){const T=Math.round(c+C*S),D=E+C*x;for(let B=_;B<=T;B++)w[B]=D;_=T+1}for(let C=_;C<256;C++)w[C]=w[_-1];return w.join(",")},g=`g_${this.#s}_hcm_${e}_filter`,m=o.filter=this.#g(g);return this.#p(m),this.#m(p(d[0],f[0],5),p(d[1],f[1],5),p(d[2],f[2],5),m),o.url=this.#c(g),o.url}destroy(e=!1){e&&this.#n?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#t?.clear(),this.#t=null,this.#n?.clear(),this.#n=null,this.#o=0)}#f(e){const t=this.#r.createElementNS(at,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#p(e){const t=this.#r.createElementNS(at,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#g(e){const t=this.#r.createElementNS(at,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#u(e,t,i){const s=this.#r.createElementNS(at,t);s.setAttribute("type","discrete"),s.setAttribute("tableValues",i),e.append(s)}#m(e,t,i,s){const n=this.#r.createElementNS(at,"feComponentTransfer");s.append(n),this.#u(n,"feFuncR",e),this.#u(n,"feFuncG",t),this.#u(n,"feFuncB",i)}#y(e,t){const i=this.#r.createElementNS(at,"feComponentTransfer");t.append(i),this.#u(i,"feFuncA",e)}#b(e){return this.#l.style.color=e,cn(getComputedStyle(this.#l).getPropertyValue("color"))}}class da{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){se("Abstract method `_fetch` called.")}}class jn extends da{async _fetch(e){const t=await Qt(e,"arraybuffer");return new Uint8Array(t)}}class fa{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){se("Abstract method `_fetch` called.")}}class zn extends fa{async _fetch(e){const t=await Qt(e,"arraybuffer");return new Uint8Array(t)}}De&&z("Please use the `legacy` build in Node.js environments.");async function pn(r){const t=await process.getBuiltinModule("fs").promises.readFile(r);return new Uint8Array(t)}class Gu extends ha{}class Wu extends ua{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class qu extends ca{async _fetch(e){return pn(e)}}class Xu extends da{async _fetch(e){return pn(e)}}class Yu extends fa{async _fetch(e){return pn(e)}}const Te={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ns(r,e){if(!e)return;const t=e[2]-e[0],i=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,i),r.clip(s)}class gn{isModifyingCurrentTransform(){return!1}getPattern(){se("Abstract method `getPattern` called.")}}class Zu extends gn{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,s){let n;if(s===Te.STROKE||s===Te.FILL){const a=t.current.getClippedPathBoundingBox(s,ce(e))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,u=t.cachedCanvases.getCanvas("pattern",o,l),c=u.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-a[0],-a[1]),i=N.transform(i,[1,0,0,1,a[0],a[1]]),c.transform(...t.baseTransform),this.matrix&&c.transform(...this.matrix),Ns(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),n=e.createPattern(u.canvas,"no-repeat");const h=new DOMMatrix(i);n.setTransform(h)}else Ns(e,this._bbox),n=this._createGradient(e);return n}}function Ss(r,e,t,i,s,n,a,o){const l=e.coords,u=e.colors,c=r.data,h=r.width*4;let d;l[t+1]>l[i+1]&&(d=t,t=i,i=d,d=n,n=a,a=d),l[i+1]>l[s+1]&&(d=i,i=s,s=d,d=a,a=o,o=d),l[t+1]>l[i+1]&&(d=t,t=i,i=d,d=n,n=a,a=d);const f=(l[t]+e.offsetX)*e.scaleX,p=(l[t+1]+e.offsetY)*e.scaleY,g=(l[i]+e.offsetX)*e.scaleX,m=(l[i+1]+e.offsetY)*e.scaleY,y=(l[s]+e.offsetX)*e.scaleX,v=(l[s+1]+e.offsetY)*e.scaleY;if(p>=v)return;const A=u[n],w=u[n+1],S=u[n+2],E=u[a],x=u[a+1],_=u[a+2],C=u[o],T=u[o+1],D=u[o+2],B=Math.round(p),k=Math.round(v);let R,$,P,M,O,J,ee,L;for(let K=B;K<=k;K++){if(K<m){const Z=K<p?0:(p-K)/(p-m);R=f-(f-g)*Z,$=A-(A-E)*Z,P=w-(w-x)*Z,M=S-(S-_)*Z}else{let Z;K>v?Z=1:m===v?Z=0:Z=(m-K)/(m-v),R=g-(g-y)*Z,$=E-(E-C)*Z,P=x-(x-T)*Z,M=_-(_-D)*Z}let j;K<p?j=0:K>v?j=1:j=(p-K)/(p-v),O=f-(f-y)*j,J=A-(A-C)*j,ee=w-(w-T)*j,L=S-(S-D)*j;const ne=Math.round(Math.min(R,O)),ue=Math.round(Math.max(R,O));let Q=h*K+ne*4;for(let Z=ne;Z<=ue;Z++)j=(R-Z)/(R-O),j<0?j=0:j>1&&(j=1),c[Q++]=$-($-J)*j|0,c[Q++]=P-(P-ee)*j|0,c[Q++]=M-(M-L)*j|0,c[Q++]=255}}function Ju(r,e,t){const i=e.coords,s=e.colors;let n,a;switch(e.type){case"lattice":const o=e.verticesPerRow,l=Math.floor(i.length/o)-1,u=o-1;for(n=0;n<l;n++){let c=n*o;for(let h=0;h<u;h++,c++)Ss(r,t,i[c],i[c+1],i[c+o],s[c],s[c+1],s[c+o]),Ss(r,t,i[c+o+1],i[c+1],i[c+o],s[c+o+1],s[c+1],s[c+o])}break;case"triangles":for(n=0,a=i.length;n<a;n+=3)Ss(r,t,i[n],i[n+1],i[n+2],s[n],s[n+1],s[n+2]);break;default:throw new Error("illegal figure")}}class Qu extends gn{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,i){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),d=Math.min(Math.ceil(Math.abs(c*e[1]*1.1)),3e3),f=u/h,p=c/d,g={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/f,scaleY:1/p},m=h+4,y=d+4,v=i.getCanvas("mesh",m,y),A=v.context,w=A.createImageData(h,d);if(t){const E=w.data;for(let x=0,_=E.length;x<_;x+=4)E[x]=t[0],E[x+1]=t[1],E[x+2]=t[2],E[x+3]=255}for(const E of this._figures)Ju(w,E,g);return A.putImageData(w,2,2),{canvas:v.canvas,offsetX:o-2*f,offsetY:l-2*p,scaleX:f,scaleY:p}}isModifyingCurrentTransform(){return!0}getPattern(e,t,i,s){Ns(e,this._bbox);const n=new Float32Array(2);if(s===Te.SHADING)N.singularValueDecompose2dScale(ce(e),n);else if(this.matrix){N.singularValueDecompose2dScale(this.matrix,n);const[o,l]=n;N.singularValueDecompose2dScale(t.baseTransform,n),n[0]*=o,n[1]*=l}else N.singularValueDecompose2dScale(t.baseTransform,n);const a=this._createMeshCanvas(n,s===Te.SHADING?null:this._background,t.cachedCanvases);return s!==Te.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(a.offsetX,a.offsetY),e.scale(a.scaleX,a.scaleY),e.createPattern(a.canvas,"no-repeat")}}class ec extends gn{getPattern(){return"hotpink"}}function tc(r){switch(r[0]){case"RadialAxial":return new Zu(r);case"Mesh":return new Qu(r);case"Dummy":return new ec}throw new Error(`Unknown IR type: ${r[0]}`)}const Gn={COLORED:1,UNCOLORED:2};class mn{static MAX_PATTERN_SIZE=3e3;constructor(e,t,i,s){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=i,this.baseTransform=s}createPatternCanvas(e){const{bbox:t,operatorList:i,paintType:s,tilingType:n,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:u}=this;l=Math.abs(l),u=Math.abs(u),ns("TilingType: "+n);const c=t[0],h=t[1],d=t[2],f=t[3],p=d-c,g=f-h,m=new Float32Array(2);N.singularValueDecompose2dScale(this.matrix,m);const[y,v]=m;N.singularValueDecompose2dScale(this.baseTransform,m);const A=y*m[0],w=v*m[1];let S=p,E=g,x=!1,_=!1;const C=Math.ceil(l*A),T=Math.ceil(u*w),D=Math.ceil(p*A),B=Math.ceil(g*w);C>=D?S=l:x=!0,T>=B?E=u:_=!0;const k=this.getSizeAndScale(S,this.ctx.canvas.width,A),R=this.getSizeAndScale(E,this.ctx.canvas.height,w),$=e.cachedCanvases.getCanvas("pattern",k.size,R.size),P=$.context,M=o.createCanvasGraphics(P);if(M.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(M,s,a),P.translate(-k.scale*c,-R.scale*h),M.transform(k.scale,0,0,R.scale,0,0),P.save(),this.clipBbox(M,c,h,d,f),M.baseTransform=ce(M.ctx),M.executeOperatorList(i),M.endDrawing(),P.restore(),x||_){const O=$.canvas;x&&(S=l),_&&(E=u);const J=this.getSizeAndScale(S,this.ctx.canvas.width,A),ee=this.getSizeAndScale(E,this.ctx.canvas.height,w),L=J.size,K=ee.size,j=e.cachedCanvases.getCanvas("pattern-workaround",L,K),ne=j.context,ue=x?Math.floor(p/l):0,Q=_?Math.floor(g/u):0;for(let Z=0;Z<=ue;Z++)for(let _e=0;_e<=Q;_e++)ne.drawImage(O,L*Z,K*_e,L,K,0,0,L,K);return{canvas:j.canvas,scaleX:J.scale,scaleY:ee.scale,offsetX:c,offsetY:h}}return{canvas:$.canvas,scaleX:k.scale,scaleY:R.scale,offsetX:c,offsetY:h}}getSizeAndScale(e,t,i){const s=Math.max(mn.MAX_PATTERN_SIZE,t);let n=Math.ceil(e*i);return n>=s?n=s:i=n/e,{scale:i,size:n}}clipBbox(e,t,i,s,n){const a=s-t,o=n-i;e.ctx.rect(t,i,a,o),N.axialAlignedBoundingBox([t,i,s,n],ce(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,i){const s=e.ctx,n=e.current;switch(t){case Gn.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;s.fillStyle=n.fillColor=a,s.strokeStyle=n.strokeColor=o;break;case Gn.UNCOLORED:s.fillStyle=s.strokeStyle=i,n.fillColor=n.strokeColor=i;break;default:throw new Cu(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,i,s){let n=i;s!==Te.SHADING&&(n=N.transform(n,t.baseTransform),this.matrix&&(n=N.transform(n,this.matrix)));const a=this.createPatternCanvas(t);let o=new DOMMatrix(n);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=e.createPattern(a.canvas,"repeat");return l.setTransform(o),l}}function ic({src:r,srcPos:e=0,dest:t,width:i,height:s,nonBlackColor:n=4294967295,inverseDecode:a=!1}){const o=Ce.isLittleEndian?4278190080:255,[l,u]=a?[n,o]:[o,n],c=i>>3,h=i&7,d=r.length;t=new Uint32Array(t.buffer);let f=0;for(let p=0;p<s;p++){for(const m=e+c;e<m;e++){const y=e<d?r[e]:255;t[f++]=y&128?u:l,t[f++]=y&64?u:l,t[f++]=y&32?u:l,t[f++]=y&16?u:l,t[f++]=y&8?u:l,t[f++]=y&4?u:l,t[f++]=y&2?u:l,t[f++]=y&1?u:l}if(h===0)continue;const g=e<d?r[e++]:255;for(let m=0;m<h;m++)t[f++]=g&1<<7-m?u:l}return{srcPos:e,destPos:f}}const Wn=16,qn=100,sc=15,Xn=10,Fe=16,Es=new DOMMatrix,Be=new Float32Array(2),Kt=new Float32Array([1/0,1/0,-1/0,-1/0]);function nc(r,e){if(r._removeMirroring)throw new Error("Context is already forwarding operations.");r.__originalSave=r.save,r.__originalRestore=r.restore,r.__originalRotate=r.rotate,r.__originalScale=r.scale,r.__originalTranslate=r.translate,r.__originalTransform=r.transform,r.__originalSetTransform=r.setTransform,r.__originalResetTransform=r.resetTransform,r.__originalClip=r.clip,r.__originalMoveTo=r.moveTo,r.__originalLineTo=r.lineTo,r.__originalBezierCurveTo=r.bezierCurveTo,r.__originalRect=r.rect,r.__originalClosePath=r.closePath,r.__originalBeginPath=r.beginPath,r._removeMirroring=()=>{r.save=r.__originalSave,r.restore=r.__originalRestore,r.rotate=r.__originalRotate,r.scale=r.__originalScale,r.translate=r.__originalTranslate,r.transform=r.__originalTransform,r.setTransform=r.__originalSetTransform,r.resetTransform=r.__originalResetTransform,r.clip=r.__originalClip,r.moveTo=r.__originalMoveTo,r.lineTo=r.__originalLineTo,r.bezierCurveTo=r.__originalBezierCurveTo,r.rect=r.__originalRect,r.closePath=r.__originalClosePath,r.beginPath=r.__originalBeginPath,delete r._removeMirroring},r.save=function(){e.save(),this.__originalSave()},r.restore=function(){e.restore(),this.__originalRestore()},r.translate=function(t,i){e.translate(t,i),this.__originalTranslate(t,i)},r.scale=function(t,i){e.scale(t,i),this.__originalScale(t,i)},r.transform=function(t,i,s,n,a,o){e.transform(t,i,s,n,a,o),this.__originalTransform(t,i,s,n,a,o)},r.setTransform=function(t,i,s,n,a,o){e.setTransform(t,i,s,n,a,o),this.__originalSetTransform(t,i,s,n,a,o)},r.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},r.rotate=function(t){e.rotate(t),this.__originalRotate(t)},r.clip=function(t){e.clip(t),this.__originalClip(t)},r.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},r.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},r.bezierCurveTo=function(t,i,s,n,a,o){e.bezierCurveTo(t,i,s,n,a,o),this.__originalBezierCurveTo(t,i,s,n,a,o)},r.rect=function(t,i,s,n){e.rect(t,i,s,n),this.__originalRect(t,i,s,n)},r.closePath=function(){e.closePath(),this.__originalClosePath()},r.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class rc{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,i)):(s=this.canvasFactory.create(t,i),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Vi(r,e,t,i,s,n,a,o,l,u){const[c,h,d,f,p,g]=ce(r);if(h===0&&d===0){const v=a*c+p,A=Math.round(v),w=o*f+g,S=Math.round(w),E=(a+l)*c+p,x=Math.abs(Math.round(E)-A)||1,_=(o+u)*f+g,C=Math.abs(Math.round(_)-S)||1;return r.setTransform(Math.sign(c),0,0,Math.sign(f),A,S),r.drawImage(e,t,i,s,n,0,0,x,C),r.setTransform(c,h,d,f,p,g),[x,C]}if(c===0&&f===0){const v=o*d+p,A=Math.round(v),w=a*h+g,S=Math.round(w),E=(o+u)*d+p,x=Math.abs(Math.round(E)-A)||1,_=(a+l)*h+g,C=Math.abs(Math.round(_)-S)||1;return r.setTransform(0,Math.sign(h),Math.sign(d),0,A,S),r.drawImage(e,t,i,s,n,0,0,C,x),r.setTransform(c,h,d,f,p,g),[C,x]}r.drawImage(e,t,i,s,n,a,o,l,u);const m=Math.hypot(c,h),y=Math.hypot(d,f);return[m*l,y*u]}class Yn{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Fs;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Re.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t){this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Kt.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Te.FILL,t=null){const i=this.minMax.slice();if(e===Te.STROKE){t||se("Stroke bounding box must include transform."),N.singularValueDecompose2dScale(t,Be);const s=Be[0]*this.lineWidth/2,n=Be[1]*this.lineWidth/2;i[0]-=s,i[1]-=n,i[2]+=s,i[3]+=n}return i}updateClipFromPath(){const e=N.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Kt,0)}getClippedPathBoundingBox(e=Te.FILL,t=null){return N.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function Zn(r,e){if(e instanceof ImageData){r.putImageData(e,0,0);return}const t=e.height,i=e.width,s=t%Fe,n=(t-s)/Fe,a=s===0?n:n+1,o=r.createImageData(i,Fe);let l=0,u;const c=e.data,h=o.data;let d,f,p,g;if(e.kind===fi.GRAYSCALE_1BPP){const m=c.byteLength,y=new Uint32Array(h.buffer,0,h.byteLength>>2),v=y.length,A=i+7>>3,w=4294967295,S=Ce.isLittleEndian?4278190080:255;for(d=0;d<a;d++){for(p=d<n?Fe:s,u=0,f=0;f<p;f++){const E=m-l;let x=0;const _=E>A?i:E*8-7,C=_&-8;let T=0,D=0;for(;x<C;x+=8)D=c[l++],y[u++]=D&128?w:S,y[u++]=D&64?w:S,y[u++]=D&32?w:S,y[u++]=D&16?w:S,y[u++]=D&8?w:S,y[u++]=D&4?w:S,y[u++]=D&2?w:S,y[u++]=D&1?w:S;for(;x<_;x++)T===0&&(D=c[l++],T=128),y[u++]=D&T?w:S,T>>=1}for(;u<v;)y[u++]=0;r.putImageData(o,0,d*Fe)}}else if(e.kind===fi.RGBA_32BPP){for(f=0,g=i*Fe*4,d=0;d<n;d++)h.set(c.subarray(l,l+g)),l+=g,r.putImageData(o,0,f),f+=Fe;d<a&&(g=i*s*4,h.set(c.subarray(l,l+g)),r.putImageData(o,0,f))}else if(e.kind===fi.RGB_24BPP)for(p=Fe,g=i*p,d=0;d<a;d++){for(d>=n&&(p=s,g=i*p),u=0,f=g;f--;)h[u++]=c[l++],h[u++]=c[l++],h[u++]=c[l++],h[u++]=255;r.putImageData(o,0,d*Fe)}else throw new Error(`bad image kind: ${e.kind}`)}function Jn(r,e){if(e.bitmap){r.drawImage(e.bitmap,0,0);return}const t=e.height,i=e.width,s=t%Fe,n=(t-s)/Fe,a=s===0?n:n+1,o=r.createImageData(i,Fe);let l=0;const u=e.data,c=o.data;for(let h=0;h<a;h++){const d=h<n?Fe:s;({srcPos:l}=ic({src:u,srcPos:l,dest:c,width:i,height:d,nonBlackColor:0})),r.putImageData(o,0,h*Fe)}}function si(r,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)r[i]!==void 0&&(e[i]=r[i]);r.setLineDash!==void 0&&(e.setLineDash(r.getLineDash()),e.lineDashOffset=r.lineDashOffset)}function Hi(r){r.strokeStyle=r.fillStyle="#000000",r.fillRule="nonzero",r.globalAlpha=1,r.lineWidth=1,r.lineCap="butt",r.lineJoin="miter",r.miterLimit=10,r.globalCompositeOperation="source-over",r.font="10px sans-serif",r.setLineDash!==void 0&&(r.setLineDash([]),r.lineDashOffset=0);const{filter:e}=r;e!=="none"&&e!==""&&(r.filter="none")}function Qn(r,e){if(e)return!0;N.singularValueDecompose2dScale(r,Be);const t=Math.fround(ze.pixelRatio*Dt.PDF_TO_CSS_UNITS);return Be[0]<=t&&Be[1]<=t}const ac=["butt","round","square"],oc=["miter","round","bevel"],lc={},er={};class jt{constructor(e,t,i,s,n,{optionalContentConfig:a,markedContentStack:o=null},l,u){this.ctx=e,this.current=new Yn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=s,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new rc(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:s=null}){const n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,i){const l=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...ce(this.compositeCtx))}this.ctx.save(),Hi(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=ce(this.ctx)}executeOperatorList(e,t,i,s){const n=e.argsArray,a=e.fnArray;let o=t||0;const l=n.length;if(l===o)return o;const u=l-o>Xn&&typeof i=="function",c=u?Date.now()+sc:0;let h=0;const d=this.commonObjs,f=this.objs;let p;for(;;){if(s!==void 0&&o===s.nextBreakPoint)return s.breakIt(o,i),o;if(p=a[o],p!==mi.dependency)this[p].apply(this,n[o]);else for(const g of n[o]){const m=g.startsWith("g_")?d:f;if(!m.has(g))return m.get(g,i),o}if(o++,o===l)return o;if(u&&++h>Xn){if(Date.now()>c)return i(),o;h=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const i=e.width??e.displayWidth,s=e.height??e.displayHeight;let n=Math.max(Math.hypot(t[0],t[1]),1),a=Math.max(Math.hypot(t[2],t[3]),1),o=i,l=s,u="prescale1",c,h;for(;n>2&&o>1||a>2&&l>1;){let d=o,f=l;n>2&&o>1&&(d=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/d),a>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/f),c=this.cachedCanvases.getCanvas(u,d,f),h=c.context,h.clearRect(0,0,d,f),h.drawImage(e,0,0,o,l,0,0,d,f),e=c.canvas,o=d,l=f,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:o,paintHeight:l}}_createMaskCanvas(e){const t=this.ctx,{width:i,height:s}=e,n=this.current.fillColor,a=this.current.patternFill,o=ce(t);let l,u,c,h;if((e.bitmap||e.data)&&e.count>1){const C=e.bitmap||e.data.buffer;u=JSON.stringify(a?o:[o.slice(0,4),n]),l=this._cachedBitmapsMap.get(C),l||(l=new Map,this._cachedBitmapsMap.set(C,l));const T=l.get(u);if(T&&!a){const D=Math.round(Math.min(o[0],o[2])+o[4]),B=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:T,offsetX:D,offsetY:B}}c=T}c||(h=this.cachedCanvases.getCanvas("maskCanvas",i,s),Jn(h.context,e));let d=N.transform(o,[1/i,0,0,-1/s,0,0]);d=N.transform(d,[1,0,0,1,0,-s]);const f=Kt.slice();N.axialAlignedBoundingBox([0,0,i,s],d,f);const[p,g,m,y]=f,v=Math.round(m-p)||1,A=Math.round(y-g)||1,w=this.cachedCanvases.getCanvas("fillCanvas",v,A),S=w.context,E=p,x=g;S.translate(-E,-x),S.transform(...d),c||(c=this._scaleImage(h.canvas,Xe(S)),c=c.img,l&&a&&l.set(u,c)),S.imageSmoothingEnabled=Qn(ce(S),e.interpolate),Vi(S,c,0,0,c.width,c.height,0,0,i,s),S.globalCompositeOperation="source-in";const _=N.transform(Xe(S),[1,0,0,1,-E,-x]);return S.fillStyle=a?n.getPattern(t,this,_,Te.FILL):n,S.fillRect(0,0,i,s),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(u,w.canvas)),{canvas:w.canvas,offsetX:Math.round(E),offsetY:Math.round(x)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=ac[e]}setLineJoin(e){this.ctx.lineJoin=oc[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,i]of e)switch(t){case"LW":this.setLineWidth(i);break;case"LC":this.setLineCap(i);break;case"LJ":this.setLineJoin(i);break;case"ML":this.setMiterLimit(i);break;case"D":this.setDash(i[0],i[1]);break;case"RI":this.setRenderingIntent(i);break;case"FL":this.setFlatness(i);break;case"Font":this.setFont(i[0],i[1]);break;case"CA":this.current.strokeAlpha=i;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.ctx.globalCompositeOperation=i;break;case"SMask":this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(i,e,t);this.suspendedCtx=this.ctx;const n=this.ctx=s.context;n.setTransform(this.suspendedCtx.getTransform()),si(this.suspendedCtx,n),nc(n,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),si(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,s){const n=s[0],a=s[1],o=s[2]-n,l=s[3]-a;o===0||l===0||(this.genericComposeSMask(t.context,i,o,l,t.subtype,t.backdrop,t.transferMap,n,a,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,s,n,a,o,l,u,c,h){let d=e.canvas,f=l-c,p=u-h;if(a)if(f<0||p<0||f+i>d.width||p+s>d.height){const m=this.cachedCanvases.getCanvas("maskExtension",i,s),y=m.context;y.drawImage(d,-f,-p),y.globalCompositeOperation="destination-atop",y.fillStyle=a,y.fillRect(0,0,i,s),y.globalCompositeOperation="source-over",d=m.canvas,f=p=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const m=new Path2D;m.rect(f,p,i,s),e.clip(m),e.globalCompositeOperation="destination-atop",e.fillStyle=a,e.fillRect(f,p,i,s),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?t.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(o));const g=new Path2D;g.rect(l,u,i,s),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(d,f,p,i,s,l,u,i,s),t.restore()}save(){this.inSMaskMode&&si(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&si(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,i,s,n,a){this.ctx.transform(e,t,i,s,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i){let[s]=t;if(!i){s||=t[0]=new Path2D,this[e](s);return}if(!(s instanceof Path2D)){const n=t[0]=new Path2D;for(let a=0,o=s.length;a<o;)switch(s[a++]){case Oi.moveTo:n.moveTo(s[a++],s[a++]);break;case Oi.lineTo:n.lineTo(s[a++],s[a++]);break;case Oi.curveTo:n.bezierCurveTo(s[a++],s[a++],s[a++],s[a++],s[a++],s[a++]);break;case Oi.closePath:n.closePath();break;default:z(`Unrecognized drawing path operator: ${s[a-1]}`);break}s=n}N.axialAlignedBoundingBox(i,ce(this.ctx),this.current.minMax),this[e](s)}closePath(){this.ctx.closePath()}stroke(e,t=!0){const i=this.ctx,s=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof s=="object"&&s?.getPattern){const n=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=s.getPattern(i,this,Xe(i),Te.STROKE),n){const a=new Path2D;a.addPath(e,i.getTransform().invertSelf().multiplySelf(n)),e=a}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);t&&this.consumePath(e,this.current.getClippedPathBoundingBox(Te.STROKE,ce(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e){this.stroke(e)}fill(e,t=!0){const i=this.ctx,s=this.current.fillColor,n=this.current.patternFill;let a=!1;if(n){const l=s.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.fillStyle=s.getPattern(i,this,Xe(i),Te.FILL),l){const u=new Path2D;u.addPath(e,i.getTransform().invertSelf().multiplySelf(l)),e=u}a=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),a&&i.restore(),t&&this.consumePath(e,o)}eoFill(e){this.pendingEOFill=!0,this.fill(e)}fillStroke(e){this.fill(e,!1),this.stroke(e,!1),this.consumePath(e)}eoFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}closeFillStroke(e){this.fillStroke(e)}closeEOFillStroke(e){this.pendingEOFill=!0,this.fillStroke(e)}endPath(e){this.consumePath(e)}rawFillPath(e){this.ctx.fill(e)}clip(){this.pendingClip=lc}eoClip(){this.pendingClip=er}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0)return;const i=new Path2D,s=t.getTransform().invertSelf();for(const{transform:n,x:a,y:o,fontSize:l,path:u}of e)i.addPath(u,new DOMMatrix(n).preMultiplySelf(s).translate(a,o).scale(l,-l));t.clip(i),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){const i=this.commonObjs.get(e),s=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=i.fontMatrix||Fs,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&z("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=i,this.current.fontSize=t,i.isType3Font)return;const n=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${n}", ${i.fallbackName}`;let o="normal";i.black?o="900":i.bold&&(o="bold");const l=i.italic?"italic":"normal";let u=t;t<Wn?u=Wn:t>qn&&(u=qn),this.current.fontSizeScale=t/u,this.ctx.font=`${l} ${o} ${u}px ${a}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e){const{current:t}=this;t.textMatrix=e,t.textMatrixScale=Math.hypot(e[0],e[1]),t.x=t.lineX=0,t.y=t.lineY=0}nextLine(){this.moveText(0,this.current.leading)}#i(e,t,i){const s=new Path2D;return s.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),s}paintChar(e,t,i,s,n){const a=this.ctx,o=this.current,l=o.font,u=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,h=u&Re.FILL_STROKE_MASK,d=!!(u&Re.ADD_TO_PATH_FLAG),f=o.patternFill&&!l.missingFile,p=o.patternStroke&&!l.missingFile;let g;if((l.disableFontFace||d||f||p)&&(g=l.getPathGenerator(this.commonObjs,e)),l.disableFontFace||f||p){a.save(),a.translate(t,i),a.scale(c,-c);let m;if((h===Re.FILL||h===Re.FILL_STROKE)&&(s?(m=a.getTransform(),a.setTransform(...s),a.fill(this.#i(g,m,s))):a.fill(g)),h===Re.STROKE||h===Re.FILL_STROKE)if(n){m||=a.getTransform(),a.setTransform(...n);const{a:y,b:v,c:A,d:w}=m,S=N.inverseTransform(n),E=N.transform([y,v,A,w,0,0],S);N.singularValueDecompose2dScale(E,Be),a.lineWidth*=Math.max(Be[0],Be[1])/c,a.stroke(this.#i(g,m,n))}else a.lineWidth/=c,a.stroke(g);a.restore()}else(h===Re.FILL||h===Re.FILL_STROKE)&&a.fillText(e,t,i),(h===Re.STROKE||h===Re.FILL_STROKE)&&a.strokeText(e,t,i);d&&(this.pendingTextPaths||=[]).push({transform:ce(a),x:t,y:i,fontSize:c,path:g})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){i=!0;break}return q(this,"isFontSubpixelAAEnabled",i)}showText(e){const t=this.current,i=t.font;if(i.isType3Font)return this.showType3Text(e);const s=t.fontSize;if(s===0)return;const n=this.ctx,a=t.fontSizeScale,o=t.charSpacing,l=t.wordSpacing,u=t.fontDirection,c=t.textHScale*u,h=e.length,d=i.vertical,f=d?1:-1,p=i.defaultVMetrics,g=s*t.fontMatrix[0],m=t.textRenderingMode===Re.FILL&&!i.disableFontFace&&!t.patternFill;n.save(),t.textMatrix&&n.transform(...t.textMatrix),n.translate(t.x,t.y+t.textRise),u>0?n.scale(c,-1):n.scale(c,1);let y,v;if(t.patternFill){n.save();const x=t.fillColor.getPattern(n,this,Xe(n),Te.FILL);y=ce(n),n.restore(),n.fillStyle=x}if(t.patternStroke){n.save();const x=t.strokeColor.getPattern(n,this,Xe(n),Te.STROKE);v=ce(n),n.restore(),n.strokeStyle=x}let A=t.lineWidth;const w=t.textMatrixScale;if(w===0||A===0){const x=t.textRenderingMode&Re.FILL_STROKE_MASK;(x===Re.STROKE||x===Re.FILL_STROKE)&&(A=this.getSinglePixelWidth())}else A/=w;if(a!==1&&(n.scale(a,a),A/=a),n.lineWidth=A,i.isInvalidPDFjsFont){const x=[];let _=0;for(const C of e)x.push(C.unicode),_+=C.width;n.fillText(x.join(""),0,0),t.x+=_*g*c,n.restore(),this.compose();return}let S=0,E;for(E=0;E<h;++E){const x=e[E];if(typeof x=="number"){S+=f*x*s/1e3;continue}let _=!1;const C=(x.isSpace?l:0)+o,T=x.fontChar,D=x.accent;let B,k,R=x.width;if(d){const P=x.vmetric||p,M=-(x.vmetric?P[1]:R*.5)*g,O=P[2]*g;R=P?-P[0]:R,B=M/a,k=(S+O)/a}else B=S/a,k=0;if(i.remeasure&&R>0){const P=n.measureText(T).width*1e3/s*a;if(R<P&&this.isFontSubpixelAAEnabled){const M=R/P;_=!0,n.save(),n.scale(M,1),B/=M}else R!==P&&(B+=(R-P)/2e3*s/a)}if(this.contentVisible&&(x.isInFont||i.missingFile)){if(m&&!D)n.fillText(T,B,k);else if(this.paintChar(T,B,k,y,v),D){const P=B+s*D.offset.x/a,M=k-s*D.offset.y/a;this.paintChar(D.fontChar,P,M,y,v)}}const $=d?R*g-C*u:R*g+C*u;S+=$,_&&n.restore()}d?t.y-=S:t.x+=S*c,n.restore(),this.compose()}showType3Text(e){const t=this.ctx,i=this.current,s=i.font,n=i.fontSize,a=i.fontDirection,o=s.vertical?1:-1,l=i.charSpacing,u=i.wordSpacing,c=i.textHScale*a,h=i.fontMatrix||Fs,d=e.length,f=i.textRenderingMode===Re.INVISIBLE;let p,g,m,y;if(!(f||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),i.textMatrix&&t.transform(...i.textMatrix),t.translate(i.x,i.y+i.textRise),t.scale(c,a),p=0;p<d;++p){if(g=e[p],typeof g=="number"){y=o*g*n/1e3,this.ctx.translate(y,0),i.x+=y*c;continue}const v=(g.isSpace?u:0)+l,A=s.charProcOperatorList[g.operatorListId];A?this.contentVisible&&(this.save(),t.scale(n,n),t.transform(...h),this.executeOperatorList(A),this.restore()):z(`Type3 character "${g.operatorListId}" is not available.`);const w=[g.width,0];N.applyTransform(w,h),m=w[0]*n+v,t.translate(m,0),i.x+=m*c}t.restore()}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,i,s,n,a){const o=new Path2D;o.rect(i,s,n-i,a-s),this.ctx.clip(o),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const i=this.baseTransform||ce(this.ctx),s={createCanvasGraphics:n=>new jt(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new mn(e,this.ctx,s,i)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e){this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e){this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=tc(this.getObject(e)),this.cachedPatterns.set(e,i)),t&&(i.matrix=t),i}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const i=this._getPattern(e);t.fillStyle=i.getPattern(t,this,Xe(t),Te.SHADING);const s=Xe(t);if(s){const{width:n,height:a}=t.canvas,o=Kt.slice();N.axialAlignedBoundingBox([0,0,n,a],s,o);const[l,u,c,h]=o;this.ctx.fillRect(l,u,c-l,h-u)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){se("Should not call beginInlineImage")}beginImageData(){se("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=ce(this.ctx),t)){N.axialAlignedBoundingBox(t,this.baseTransform,this.current.minMax);const[i,s,n,a]=t,o=new Path2D;o.rect(i,s,n-i,a-s),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||ns("TODO: Support non-isolated groups."),e.knockout&&z("Knockout groups not supported.");const i=ce(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=Kt.slice();N.axialAlignedBoundingBox(e.bbox,ce(t),s);const n=[0,0,t.canvas.width,t.canvas.height];s=N.intersect(s,n)||[0,0,0,0];const a=Math.floor(s[0]),o=Math.floor(s[1]),l=Math.max(Math.ceil(s[2])-a,1),u=Math.max(Math.ceil(s[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,u]);let c="groupAt"+this.groupLevel;e.smask&&(c+="_smask_"+this.smaskCounter++%2);const h=this.cachedCanvases.getCanvas(c,l,u),d=h.context;d.translate(-a,-o),d.transform(...i);let f=new Path2D;const[p,g,m,y]=e.bbox;if(f.rect(p,g,m-p,y-g),e.matrix){const v=new Path2D;v.addPath(f,new DOMMatrix(e.matrix)),f=v}d.clip(f),e.smask?this.smaskStack.push({canvas:h.canvas,context:d,offsetX:a,offsetY:o,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(a,o),t.save()),si(t,d),this.ctx=d,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=ce(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const n=Kt.slice();N.axialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s,n),this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(e,t,i,s,n){if(this.#e(),Hi(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const a=t[2]-t[0],o=t[3]-t[1];if(n&&this.annotationCanvasMap){i=i.slice(),i[4]-=t[0],i[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=a,t[3]=o,N.singularValueDecompose2dScale(ce(this.ctx),Be);const{viewportScale:l}=this,u=Math.ceil(a*this.outputScaleX*l),c=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(u,c);const{canvas:h,context:d}=this.annotationCanvas;this.annotationCanvasMap.set(e,h),this.annotationCanvas.savedCtx=this.ctx,this.ctx=d,this.ctx.save(),this.ctx.setTransform(Be[0],0,0,-Be[1],0,o*Be[1]),Hi(this.ctx)}else{Hi(this.ctx),this.endPath();const l=new Path2D;l.rect(t[0],t[1],a,o),this.ctx.clip(l)}}this.current=new Yn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...i),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const i=this.ctx,s=this._createMaskCanvas(e),n=s.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(n,s.offsetX,s.offsetY),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i=0,s=0,n,a){if(!this.contentVisible)return;e=this.getObject(e.data,e);const o=this.ctx;o.save();const l=ce(o);o.transform(t,i,s,n,0,0);const u=this._createMaskCanvas(e);o.setTransform(1,0,0,1,u.offsetX-l[4],u.offsetY-l[5]);for(let c=0,h=a.length;c<h;c+=2){const d=N.transform(l,[t,i,s,n,a[c],a[c+1]]);o.drawImage(u.canvas,d[4],d[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,i=this.current.fillColor,s=this.current.patternFill;for(const n of e){const{data:a,width:o,height:l,transform:u}=n,c=this.cachedCanvases.getCanvas("maskCanvas",o,l),h=c.context;h.save();const d=this.getObject(a,n);Jn(h,d),h.globalCompositeOperation="source-in",h.fillStyle=s?i.getPattern(h,this,Xe(t),Te.FILL):i,h.fillRect(0,0,o,l),h.restore(),t.save(),t.transform(...u),t.scale(1,-1),Vi(t,c.canvas,0,0,o,l,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){z("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,i,s){if(!this.contentVisible)return;const n=this.getObject(e);if(!n){z("Dependent image isn't ready yet");return}const a=n.width,o=n.height,l=[];for(let u=0,c=s.length;u<c;u+=2)l.push({transform:[t,0,0,i,s[u],s[u+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:i,height:s}=e,n=this.cachedCanvases.getCanvas("inlineImage",i,s),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(t,0,0),a.filter="none",n.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,i=e.height,s=this.ctx;this.save();const{filter:n}=s;n!=="none"&&n!==""&&(s.filter="none"),s.scale(1/t,-1/i);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const u=this.cachedCanvases.getCanvas("inlineImage",t,i).context;Zn(u,e),a=this.applyTransferMapsToCanvas(u)}const o=this._scaleImage(a,Xe(s));s.imageSmoothingEnabled=Qn(ce(s),e.interpolate),Vi(s,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,t,i),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const n=e.width,a=e.height,l=this.cachedCanvases.getCanvas("inlineImage",n,a).context;Zn(l,e),s=this.applyTransferMapsToCanvas(l)}for(const n of t)i.save(),i.transform(...n.transform),i.scale(1,-1),Vi(i,s,n.x,n.y,n.w,n.h,0,-1,1,1),i.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e,t){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);const s=this.ctx;this.pendingClip&&(i||(this.pendingClip===er?s.clip(e,"evenodd"):s.clip(e)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=ce(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:i,c:s,d:n}=this.ctx.getTransform();let a,o;if(i===0&&s===0){const l=Math.abs(t),u=Math.abs(n);if(l===u)if(e===0)a=o=1/l;else{const c=l*e;a=o=c<1?1/c:1}else if(e===0)a=1/l,o=1/u;else{const c=l*e,h=u*e;a=c<1?1/c:1,o=h<1?1/h:1}}else{const l=Math.abs(t*n-i*s),u=Math.hypot(t,i),c=Math.hypot(s,n);if(e===0)a=c/l,o=u/l;else{const h=e*l;a=c>h?c/h:1,o=u>h?u/h:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:i,current:{lineWidth:s}}=this,[n,a]=this.getScaleForStroking();if(n===a){i.lineWidth=(s||1)*n,i.stroke(e);return}const o=i.getLineDash();t&&i.save(),i.scale(n,a),Es.a=1/n,Es.d=1/a;const l=new Path2D;if(l.addPath(e,Es),o.length>0){const u=Math.max(n,a);i.setLineDash(o.map(c=>c/u)),i.lineDashOffset/=u}i.lineWidth=s||1,i.stroke(l),t&&i.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const r in mi)jt.prototype[r]!==void 0&&(jt.prototype[mi[r]]=jt.prototype[r]);class Pt{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class uc{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const Ht=Symbol("INTERNAL");class cc{#e=!1;#t=!1;#i=!1;#s=!0;constructor(e,{name:t,intent:i,usage:s,rbGroups:n}){this.#e=!!(e&Oe.DISPLAY),this.#t=!!(e&Oe.PRINT),this.name=t,this.intent=i,this.usage=s,this.rbGroups=n}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,i=!1){e!==Ht&&se("Internal method `_setVisible` called."),this.#i=i,this.#s=t}}class hc{#e=null;#t=new Map;#i=null;#s=null;constructor(e,t=Oe.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#s=e.order;for(const i of e.groups)this.#t.set(i.id,new cc(t,i));if(e.baseState==="OFF")for(const i of this.#t.values())i._setVisible(Ht,!1);for(const i of e.on)this.#t.get(i)._setVisible(Ht,!0);for(const i of e.off)this.#t.get(i)._setVisible(Ht,!1);this.#i=this.getHash()}}#r(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let s=1;s<t;s++){const n=e[s];let a;if(Array.isArray(n))a=this.#r(n);else if(this.#t.has(n))a=this.#t.get(n).visible;else return z(`Optional content group not found: ${n}`),!0;switch(i){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return i==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return ns("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(z(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#r(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return z(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return z(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return z(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return z(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return z(`Unknown optional content policy ${e.policy}.`),!0}return z(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){const s=this.#t.get(e);if(!s){z(`Optional content group not found: ${e}`);return}if(i&&t&&s.rbGroups.length)for(const n of s.rbGroups)for(const a of n)a!==e&&this.#t.get(a)?._setVisible(Ht,!1,!0);s._setVisible(Ht,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let i;for(const s of e){switch(s){case"ON":case"OFF":case"Toggle":i=s;continue}const n=this.#t.get(s);if(n)switch(i){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!n.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#t.size?this.#s?this.#s.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new aa;for(const[t,i]of this.#t)e.update(`${t}:${i.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class dc{constructor(e,{disableRange:t=!1,disableStream:i=!1}){Ae(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:n,progressiveDone:a,contentDispositionFilename:o}=e;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,n?.length>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((l,u)=>{this._onReceiveData({begin:l,chunk:u})}),e.addProgressListener((l,u)=>{this._onProgress({loaded:l,total:u})}),e.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const s=this._rangeReaders.some(function(n){return n._begin!==e?!1:(n._enqueue(i),!0)});Ae(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Ae(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new fc(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new pc(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class fc{constructor(e,t,i=!1,s=null){this._stream=e,this._done=i||!1,this._filename=as(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class pc{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function gc(r){let e=!0,t=i("filename\\*","i").exec(r);if(t){t=t[1];let c=o(t);return c=unescape(c),c=l(c),c=u(c),n(c)}if(t=a(r),t){const c=u(t);return n(c)}if(t=i("filename","i").exec(r),t){t=t[1];let c=o(t);return c=u(c),n(c)}function i(c,h){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function s(c,h){if(c){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const d=new TextDecoder(c,{fatal:!0}),f=Ti(h);h=d.decode(f),e=!1}catch{}}return h}function n(c){return e&&/[\x80-\xff]/.test(c)&&(c=s("utf-8",c),e&&(c=s("iso-8859-1",c))),c}function a(c){const h=[];let d;const f=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(d=f.exec(c))!==null;){let[,g,m,y]=d;if(g=parseInt(g,10),g in h){if(g===0)break;continue}h[g]=[m,y]}const p=[];for(let g=0;g<h.length&&g in h;++g){let[m,y]=h[g];y=o(y),m&&(y=unescape(y),g===0&&(y=l(y))),p.push(y)}return p.join("")}function o(c){if(c.startsWith('"')){const h=c.slice(1).split('\\"');for(let d=0;d<h.length;++d){const f=h[d].indexOf('"');f!==-1&&(h[d]=h[d].slice(0,f),h.length=d+1),h[d]=h[d].replaceAll(/\\(.)/g,"$1")}c=h.join('"')}return c}function l(c){const h=c.indexOf("'");if(h===-1)return c;const d=c.slice(0,h),p=c.slice(h+1).replace(/^[^']*'/,"");return s(d,p)}function u(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,d,f,p){if(f==="q"||f==="Q")return p=p.replaceAll("_"," "),p=p.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,m){return String.fromCharCode(parseInt(m,16))}),s(d,p);try{p=atob(p)}catch{}return s(d,p)})}return""}function pa(r,e){const t=new Headers;if(!r||!e||typeof e!="object")return t;for(const i in e){const s=e[i];s!==void 0&&t.append(i,s)}return t}function os(r){return URL.parse(r)?.origin??null}function ga({responseHeaders:r,isHttp:e,rangeChunkSize:t,disableRange:i}){const s={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(r.get("Content-Length"),10);return!Number.isInteger(n)||(s.suggestedLength=n,n<=2*t)||i||!e||r.get("Accept-Ranges")!=="bytes"||(r.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function ma(r){const e=r.get("Content-Disposition");if(e){let t=gc(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(as(t))return t}return null}function Mi(r,e){return new yi(`Unexpected server response (${r}) while retrieving PDF "${e}".`,r,r===404||r===0&&e.startsWith("file:"))}function ya(r){return r===200||r===206}function ba(r,e,t){return{method:"GET",headers:r,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function va(r){return r instanceof Uint8Array?r.buffer:r instanceof ArrayBuffer?r:(z(`getArrayBuffer - unexpected data format: ${r}`),new Uint8Array(r).buffer)}class mc{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=pa(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Ae(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new yc(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new bc(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class yc{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const i=new Headers(e.headers),s=t.url;fetch(s,ba(i,this._withCredentials,this._abortController)).then(n=>{if(e._responseOrigin=os(n.url),!ya(n.status))throw Mi(n.status,s);this._reader=n.body.getReader(),this._headersCapability.resolve();const a=n.headers,{allowRangeRequests:o,suggestedLength:l}=ga({responseHeaders:a,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=ma(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ht("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:va(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class bc{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const n=new Headers(e.headers);n.append("Range",`bytes=${t}-${i-1}`);const a=s.url;fetch(a,ba(n,this._withCredentials,this._abortController)).then(o=>{const l=os(o.url);if(l!==e._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${e._responseOrigin}".`);if(!ya(o.status))throw Mi(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:va(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const xs=200,Cs=206;function vc(r){const e=r.response;return typeof e!="string"?e:Ti(e).buffer}class wc{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:i}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=pa(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,i=this.currXhrId++,s=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[n,a]of this.headers)t.setRequestHeader(n,a);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=Cs):s.expectedStatus=xs,t.responseType="arraybuffer",Ae(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){const i=this.pendingRequests[e];i&&i.onProgress?.(t)}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const s=i.xhr;if(s.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){i.onError(s.status);return}const n=s.status||xs;if(!(n===xs&&i.expectedStatus===Cs)&&n!==i.expectedStatus){i.onError(s.status);return}const o=vc(s);if(n===Cs){const l=s.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);u?i.onDone({begin:parseInt(u[1],10),chunk:o}):(z('Missing or invalid "Content-Range" header.'),i.onError(0))}else o?i.onDone({begin:0,chunk:o}):i.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class Ac{constructor(e){this._source=e,this._manager=new wc(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Ae(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Sc(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new Ec(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Sc{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=os(t.responseURL);const i=t.getAllResponseHeaders(),s=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...u]=o.split(": ");return[l,u.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=ga({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=ma(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=Mi(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Ec{constructor(e,t,i){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=os(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=Mi(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const xc=/^[a-z][a-z0-9\-+.]+:/i;function Cc(r){if(xc.test(r))return new URL(r);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(r))}class _c{constructor(e){this.source=e,this.url=Cc(e.url),Ae(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Ae(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Tc(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Rc(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Tc{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=Mi(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ht("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Rc{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=e.source;this._isStreamingSupported=!s.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ni=Symbol("INITIAL_DATA");class wa{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:ni}}get(e,t=null){if(t){const s=this.#t(e);return s.promise.then(()=>t(s.data)),null}const i=this.#e[e];if(!i||i.data===ni)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){const t=this.#e[e];return!!t&&t.data!==ni}delete(e){const t=this.#e[e];return!t||t.data===ni?!1:(delete this.#e[e],!0)}resolve(e,t=null){const i=this.#t(e);i.data=t,i.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==ni&&(yield[e,t])}}}const kc=1e5,tr=30;let bi=class He{#e=Promise.withResolvers();#t=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#r=null;#n=null;#o=0;#a=0;#h=null;#l=null;#d=0;#c=0;#f=Object.create(null);#p=[];#g=null;#u=[];#m=new WeakMap;#y=null;static#b=new Map;static#w=new Map;static#A=new WeakMap;static#S=null;static#C=new Set;constructor({textContentSource:e,container:t,viewport:i}){if(e instanceof ReadableStream)this.#g=e;else if(typeof e=="object")this.#g=new ReadableStream({start(l){l.enqueue(e),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#l=t,this.#c=i.scale*ze.pixelRatio,this.#d=i.rotation,this.#n={div:null,properties:null,ctx:null};const{pageWidth:s,pageHeight:n,pageX:a,pageY:o}=i.rawDims;this.#y=[1,0,0,-1,-a,o+n],this.#a=s,this.#o=n,He.#D(),vt(t,i),this.#e.promise.finally(()=>{He.#C.delete(this),this.#n=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Ce.platform;return q(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#h.read().then(({value:t,done:i})=>{if(i){this.#e.resolve();return}this.#r??=t.lang,Object.assign(this.#f,t.styles),this.#T(t.items),e()},this.#e.reject)};return this.#h=this.#g.getReader(),He.#C.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const i=e.scale*ze.pixelRatio,s=e.rotation;if(s!==this.#d&&(t?.(),this.#d=s,vt(this.#l,{rotation:s})),i!==this.#c){t?.(),this.#c=i;const n={div:null,properties:null,ctx:He.#R(this.#r)};for(const a of this.#u)n.properties=this.#m.get(a),n.div=a,this.#E(n)}}cancel(){const e=new ht("TextLayer task cancelled.");this.#h?.cancel(e).catch(()=>{}),this.#h=null,this.#e.reject(e)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#p}#T(e){if(this.#i)return;this.#n.ctx??=He.#R(this.#r);const t=this.#u,i=this.#p;for(const s of e){if(t.length>kc){z("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(s.str===void 0){if(s.type==="beginMarkedContentProps"||s.type==="beginMarkedContent"){const n=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),s.id!==null&&this.#t.setAttribute("id",`${s.id}`),n.append(this.#t)}else s.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}i.push(s.str),this.#k(s)}}#k(e){const t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#u.push(t);const s=N.transform(this.#y,e.transform);let n=Math.atan2(s[1],s[0]);const a=this.#f[e.fontName];a.vertical&&(n+=Math.PI/2);let o=this.#s&&a.fontSubstitution||a.fontFamily;o=He.fontFamilyMap.get(o)||o;const l=Math.hypot(s[2],s[3]),u=l*He.#M(o,a,this.#r);let c,h;n===0?(c=s[4],h=s[5]-u):(c=s[4]+u*Math.sin(n),h=s[5]-u*Math.cos(n));const d="calc(var(--total-scale-factor) *",f=t.style;this.#t===this.#l?(f.left=`${(100*c/this.#a).toFixed(2)}%`,f.top=`${(100*h/this.#o).toFixed(2)}%`):(f.left=`${d}${c.toFixed(2)}px)`,f.top=`${d}${h.toFixed(2)}px)`),f.fontSize=`${d}${(He.#S*l).toFixed(2)}px)`,f.fontFamily=o,i.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#s&&(t.dataset.fontName=a.fontSubstitutionLoadedName||e.fontName),n!==0&&(i.angle=n*(180/Math.PI));let p=!1;if(e.str.length>1)p=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const g=Math.abs(e.transform[0]),m=Math.abs(e.transform[3]);g!==m&&Math.max(g,m)/Math.min(g,m)>1.5&&(p=!0)}if(p&&(i.canvasWidth=a.vertical?e.height:e.width),this.#m.set(t,i),this.#n.div=t,this.#n.properties=i,this.#E(this.#n),i.hasText&&this.#t.append(t),i.hasEOL){const g=document.createElement("br");g.setAttribute("role","presentation"),this.#t.append(g)}}#E(e){const{div:t,properties:i,ctx:s}=e,{style:n}=t;let a="";if(He.#S>1&&(a=`scale(${1/He.#S})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:o}=n,{canvasWidth:l,fontSize:u}=i;He.#_(s,u*this.#c,o);const{width:c}=s.measureText(t.textContent);c>0&&(a=`scaleX(${l*this.#c/c}) ${a}`)}i.angle!==0&&(a=`rotate(${i.angle}deg) ${a}`),a.length>0&&(n.transform=a)}static cleanup(){if(!(this.#C.size>0)){this.#b.clear();for(const{canvas:e}of this.#w.values())e.remove();this.#w.clear()}}static#R(e=null){let t=this.#w.get(e||="");if(!t){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#w.set(e,t),this.#A.set(t,{size:0,family:""})}return t}static#_(e,t,i){const s=this.#A.get(e);t===s.size&&i===s.family||(e.font=`${t}px ${i}`,s.size=t,s.family=i)}static#D(){if(this.#S!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#S=e.getBoundingClientRect().height,e.remove()}static#M(e,t,i){const s=this.#b.get(e);if(s)return s;const n=this.#R(i);n.canvas.width=n.canvas.height=tr,this.#_(n,tr,e);const a=n.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let u=.8;return o?u=o/(o+l):(Ce.platform.isFirefox&&z("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?u=t.ascent:t.descent&&(u=1+t.descent)),this.#b.set(e,u),u}};class vi{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};function s(n){if(!n)return;let a=null;const o=n.name;if(o==="#text")a=n.value;else if(vi.shouldBuildText(o))n?.attributes?.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&t.push({str:a}),!!n.children)for(const l of n.children)s(l)}return s(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const Pc=100;function yn(r={}){typeof r=="string"||r instanceof URL?r={url:r}:(r instanceof ArrayBuffer||ArrayBuffer.isView(r))&&(r={data:r});const e=new bn,{docId:t}=e,i=r.url?Vu(r.url):null,s=r.data?Hu(r.data):null,n=r.httpHeaders||null,a=r.withCredentials===!0,o=r.password??null,l=r.range instanceof vn?r.range:null,u=Number.isInteger(r.rangeChunkSize)&&r.rangeChunkSize>0?r.rangeChunkSize:2**16;let c=r.worker instanceof Xt?r.worker:null;const h=r.verbosity,d=typeof r.docBaseUrl=="string"&&!ki(r.docBaseUrl)?r.docBaseUrl:null,f=Ni(r.cMapUrl),p=r.cMapPacked!==!1,g=r.CMapReaderFactory||(De?qu:Un),m=Ni(r.iccUrl),y=Ni(r.standardFontDataUrl),v=r.StandardFontDataFactory||(De?Xu:jn),A=Ni(r.wasmUrl),w=r.WasmFactory||(De?Yu:zn),S=r.stopAtErrors!==!0,E=Number.isInteger(r.maxImageSize)&&r.maxImageSize>-1?r.maxImageSize:-1,x=r.isEvalSupported!==!1,_=typeof r.isOffscreenCanvasSupported=="boolean"?r.isOffscreenCanvasSupported:!De,C=typeof r.isImageDecoderSupported=="boolean"?r.isImageDecoderSupported:!De&&(Ce.platform.isFirefox||!globalThis.chrome),T=Number.isInteger(r.canvasMaxAreaInBytes)?r.canvasMaxAreaInBytes:-1,D=typeof r.disableFontFace=="boolean"?r.disableFontFace:De,B=r.fontExtraProperties===!0,k=r.enableXfa===!0,R=r.ownerDocument||globalThis.document,$=r.disableRange===!0,P=r.disableStream===!0,M=r.disableAutoFetch===!0,O=r.pdfBug===!0,J=r.CanvasFactory||(De?Wu:ju),ee=r.FilterFactory||(De?Gu:zu),L=r.enableHWA===!0,K=r.useWasm!==!1,j=l?l.length:r.length??NaN,ne=typeof r.useSystemFonts=="boolean"?r.useSystemFonts:!De&&!D,ue=typeof r.useWorkerFetch=="boolean"?r.useWorkerFetch:!!(g===Un&&v===jn&&w===zn&&f&&y&&A&&ci(f,document.baseURI)&&ci(y,document.baseURI)&&ci(A,document.baseURI)),Q=null;Su(h);const Z={canvasFactory:new J({ownerDocument:R,enableHWA:L}),filterFactory:new ee({docId:t,ownerDocument:R}),cMapReaderFactory:ue?null:new g({baseUrl:f,isCompressed:p}),standardFontDataFactory:ue?null:new v({baseUrl:y}),wasmFactory:ue?null:new w({baseUrl:A})};c||(c=Xt.create({verbosity:h,port:Pt.workerPort}),e._worker=c);const _e={docId:t,apiVersion:"5.3.93",data:s,password:o,disableAutoFetch:M,rangeChunkSize:u,length:j,docBaseUrl:d,enableXfa:k,evaluatorOptions:{maxImageSize:E,disableFontFace:D,ignoreErrors:S,isEvalSupported:x,isOffscreenCanvasSupported:_,isImageDecoderSupported:C,canvasMaxAreaInBytes:T,fontExtraProperties:B,useSystemFonts:ne,useWasm:K,useWorkerFetch:ue,cMapUrl:f,iccUrl:m,standardFontDataUrl:y,wasmUrl:A}},Ee={ownerDocument:R,pdfBug:O,styleElement:Q,loadingParams:{disableAutoFetch:M,enableXfa:k}};return c.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const I=c.messageHandler.sendWithPromise("GetDocRequest",_e,s?[s.buffer]:null);let Y;if(l)Y=new dc(l,{disableRange:$,disableStream:P});else if(!s){if(!i)throw new Error("getDocument - no `url` parameter provided.");const te=ci(i)?mc:De?_c:Ac;Y=new te({url:i,length:j,httpHeaders:n,withCredentials:a,rangeChunkSize:u,disableRange:$,disableStream:P})}return I.then(te=>{if(e.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const G=new hi(t,te,c.port),ie=new Ic(G,e,Y,Ee,Z);e._transport=ie,G.send("Ready",null)})}).catch(e._capability.reject),e}class bn{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${bn.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}let vn=class{#e=Promise.withResolvers();#t=[];#i=[];#s=[];#r=[];constructor(e,t,i=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=s}addRangeListener(e){this.#r.push(e)}addProgressListener(e){this.#s.push(e)}addProgressiveReadListener(e){this.#i.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const i of this.#r)i(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const i of this.#s)i(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#i)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){se("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}};class Dc{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return q(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Mc{#e=!1;constructor(e,t,i,s=!1){this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=s?new Vn:null,this._pdfBug=s,this.commonObjs=i.commonObjs,this.objs=new wa,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:s=0,dontFlip:n=!1}={}){return new Ri({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:s,dontFlip:n})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return q(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,viewport:t,intent:i="display",annotationMode:s=tt.ENABLE,transform:n=null,background:a=null,optionalContentConfigPromise:o=null,annotationCanvasMap:l=null,pageColors:u=null,printAnnotationStorage:c=null,isEditing:h=!1}){this._stats?.time("Overall");const d=this._transport.getRenderingIntent(i,s,c,h),{renderingIntent:f,cacheKey:p}=d;this.#e=!1,o||=this._transport.getOptionalContentConfig(f);let g=this._intentStates.get(p);g||(g=Object.create(null),this._intentStates.set(p,g)),g.streamReaderCancelTimeout&&(clearTimeout(g.streamReaderCancelTimeout),g.streamReaderCancelTimeout=null);const m=!!(f&Oe.PRINT);g.displayReadyCapability||(g.displayReadyCapability=Promise.withResolvers(),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(d));const y=w=>{g.renderTasks.delete(v),m&&(this.#e=!0),this.#t(),w?(v.capability.reject(w),this._abortOperatorList({intentState:g,reason:w instanceof Error?w:new Error(w)})):v.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},v=new Ut({callback:y,params:{canvasContext:e,viewport:t,transform:n,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:l,operatorList:g.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!m,pdfBug:this._pdfBug,pageColors:u});(g.renderTasks||=new Set).add(v);const A=v.task;return Promise.all([g.displayReadyCapability.promise,o]).then(([w,S])=>{if(this.destroyed){y();return}if(this._stats?.time("Rendering"),!(S.renderingIntent&f))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");v.initializeGraphics({transparency:w,optionalContentConfig:S}),v.operatorListChanged()}).catch(y),A}getOperatorList({intent:e="display",annotationMode:t=tt.ENABLE,printAnnotationStorage:i=null,isEditing:s=!1}={}){function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(e,t,i,s,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||=new Set).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>vi.textContent(i));const t=this.streamTextContent(e);return new Promise(function(i,s){function n(){a.read().then(function({value:l,done:u}){if(u){i(o);return}o.lang??=l.lang,Object.assign(o.styles,l.styles),o.items.push(...l.items),n()},s)}const a=t.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#t();return e&&t&&(this._stats&&=new Vn),t}#t(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const i=this._intentStates.get(t);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let i=0,s=e.length;i<s;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this.#t()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:s}){const{map:n,transfer:a}=i,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:n,modifiedIds:s},a).getReader(),u=this._intentStates.get(t);u.streamReader=l;const c=()=>{l.read().then(({value:h,done:d})=>{if(d){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,u),c())},h=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const d of u.renderTasks)d.operatorListChanged();this.#t()}if(u.displayReadyCapability)u.displayReadyCapability.reject(h);else if(u.opListReadCapability)u.opListReadCapability.reject(h);else throw h}})};c()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof rs){let s=Pc;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new ht(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[s,n]of this._intentStates)if(n===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}var yt,Ue,ot,Tt,Qi,Rt,kt,Me,Wi,Aa,Sa,di,qt,qi;const le=class le{constructor({name:e=null,port:t=null,verbosity:i=Eu()}={}){We(this,Me);We(this,yt,Promise.withResolvers());We(this,Ue,null);We(this,ot,null);We(this,Tt,null);if(this.name=e,this.destroyed=!1,this.verbosity=i,t){if(oe(le,kt).has(t))throw new Error("Cannot use more than one PDFWorker per port.");oe(le,kt).set(t,this),qe(this,Me,Aa).call(this,t)}else qe(this,Me,Sa).call(this)}get promise(){return oe(this,yt).promise}get port(){return oe(this,ot)}get messageHandler(){return oe(this,Ue)}destroy(){this.destroyed=!0,oe(this,Tt)?.terminate(),Ie(this,Tt,null),oe(le,kt).delete(oe(this,ot)),Ie(this,ot,null),oe(this,Ue)?.destroy(),Ie(this,Ue,null)}static create(e){const t=oe(this,kt).get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new le(e)}static get workerSrc(){if(Pt.workerSrc)return Pt.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return q(this,"_setupFakeWorkerGlobal",(async()=>oe(this,qt,qi)?oe(this,qt,qi):(await import(this.workerSrc)).WorkerMessageHandler)())}};yt=new WeakMap,Ue=new WeakMap,ot=new WeakMap,Tt=new WeakMap,Qi=new WeakMap,Rt=new WeakMap,kt=new WeakMap,Me=new WeakSet,Wi=function(){oe(this,yt).resolve(),oe(this,Ue).send("configure",{verbosity:this.verbosity})},Aa=function(e){Ie(this,ot,e),Ie(this,Ue,new hi("main","worker",e)),oe(this,Ue).on("ready",()=>{}),qe(this,Me,Wi).call(this)},Sa=function(){if(oe(le,Rt)||oe(le,qt,qi)){qe(this,Me,di).call(this);return}let{workerSrc:e}=le;try{le._isSameOrigin(window.location,e)||(e=le._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),i=new hi("main","worker",t),s=()=>{n.abort(),i.destroy(),t.terminate(),this.destroyed?oe(this,yt).reject(new Error("Worker was destroyed")):qe(this,Me,di).call(this)},n=new AbortController;t.addEventListener("error",()=>{oe(this,Tt)||s()},{signal:n.signal}),i.on("test",o=>{if(n.abort(),this.destroyed||!o){s();return}Ie(this,Ue,i),Ie(this,ot,t),Ie(this,Tt,t),qe(this,Me,Wi).call(this)}),i.on("ready",o=>{if(n.abort(),this.destroyed){s();return}try{a()}catch{qe(this,Me,di).call(this)}});const a=()=>{const o=new Uint8Array;i.send("test",o,[o.buffer])};a();return}catch{ns("The worker has been disabled.")}qe(this,Me,di).call(this)},di=function(){oe(le,Rt)||(z("Setting up fake worker."),Ie(le,Rt,!0)),le._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){oe(this,yt).reject(new Error("Worker was destroyed"));return}const t=new Uu;Ie(this,ot,t);const i=`fake${Dn(le,Qi)._++}`,s=new hi(i+"_worker",i,t);e.setup(s,t),Ie(this,Ue,new hi(i,i+"_worker",t)),qe(this,Me,Wi).call(this)}).catch(e=>{oe(this,yt).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},qt=new WeakSet,qi=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},We(le,qt),We(le,Qi,0),We(le,Rt,!1),We(le,kt,new WeakMap),De&&(Ie(le,Rt,!0),Pt.workerSrc||="./pdf.worker.mjs"),le._isSameOrigin=(e,t)=>{const i=URL.parse(e);if(!i?.origin||i.origin==="null")return!1;const s=new URL(t,i);return i.origin===s.origin},le._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},le.fromPort=e=>{if(Mu("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return le.create(e)};let Xt=le;class Ic{#e=new Map;#t=new Map;#i=new Map;#s=new Map;#r=null;constructor(e,t,i,s,n){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new wa,this.fontLoader=new Nu({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}#n(e,t=null){const i=this.#e.get(e);if(i)return i;const s=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,s),s}get annotationStorage(){return q(this,"annotationStorage",new fn)}getRenderingIntent(e,t=tt.ENABLE,i=null,s=!1,n=!1){let a=Oe.DISPLAY,o=$s;switch(e){case"any":a=Oe.ANY;break;case"display":break;case"print":a=Oe.PRINT;break;default:z(`getRenderingIntent - invalid intent: ${e}`)}const l=a&Oe.PRINT&&i instanceof oa?i:this.annotationStorage;switch(t){case tt.DISABLE:a+=Oe.ANNOTATIONS_DISABLE;break;case tt.ENABLE:break;case tt.ENABLE_FORMS:a+=Oe.ANNOTATIONS_FORMS;break;case tt.ENABLE_STORAGE:a+=Oe.ANNOTATIONS_STORAGE,o=l.serializable;break;default:z(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(a+=Oe.IS_EDITING),n&&(a+=Oe.OPLIST);const{ids:u,hash:c}=l.modifiedIds,h=[a,o.hash,c];return{renderingIntent:a,cacheKey:h.join("_"),annotationStorageSerializable:o,modifiedIds:u}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of this.#t.values())e.push(i._destroy());this.#t.clear(),this.#i.clear(),this.#s.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),bi.cleanup(),this._networkStream?.cancelAllRequests(new ht("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,s)=>{Ae(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},s.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){s.close();return}Ae(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{s.error(n)})},s.onCancel=n=>{this._fullReader.cancel(n),s.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("ReaderHeadersReady",async i=>{await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:n,contentLength:a}=this._fullReader;return(!s||!n)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=o=>{t.onProgress?.({loaded:o.loaded,total:o.total})}),{isStreamingSupported:s,isRangeSupported:n,contentLength:a}}),e.on("GetRangeReader",(i,s)=>{Ae(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(i.begin,i.end);if(!n){s.close();return}s.onPull=()=>{n.read().then(function({value:a,done:o}){if(o){s.close();return}Ae(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{s.error(a)})},s.onCancel=a=>{n.cancel(a),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new Dc(i,this))}),e.on("DocException",i=>{t._capability.reject(Le(i))}),e.on("PasswordRequest",i=>{this.#r=Promise.withResolvers();try{if(!t.onPassword)throw Le(i);const s=n=>{n instanceof Error?this.#r.reject(n):this.#r.resolve({password:n})};t.onPassword(s,i.code)}catch(s){this.#r.reject(s)}return this.#r.promise}),e.on("DataLoaded",i=>{t.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;this.#t.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,s,n])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(s){case"Font":if("error"in n){const u=n.error;z(`Error during font loading: ${u}`),this.commonObjs.resolve(i,u);break}const a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(u,c)=>globalThis.FontInspector.fontAdded(u,c):null,o=new Bu(n,a);this.fontLoader.bind(o).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!o.fontExtraProperties&&o.data&&(o.data=null),this.commonObjs.resolve(i,o)});break;case"CopyLocalImage":const{imageRef:l}=n;Ae(l,"The imageRef must be defined.");for(const u of this.#t.values())for(const[,c]of u.objs)if(c?.ref===l)return c.dataLen?(this.commonObjs.resolve(i,structuredClone(c)),c.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,n);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([i,s,n,a])=>{if(this.destroyed)return;const o=this.#t.get(s);if(!o.objs.has(i)){if(o._intentStates.size===0){a?.bitmap?.close();return}switch(n){case"Image":case"Pattern":o.objs.resolve(i,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),e.on("DocProgress",i=>{this.destroyed||t.onProgress?.({loaded:i.loaded,total:i.total})}),e.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[i.type];if(!s)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&z("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=this.#i.get(t);if(i)return i;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&this.#s.set(n.refStr,e);const a=new Mc(t,n,this,this._params.pdfBug);return this.#t.set(t,a),a});return this.#i.set(t,s),s}getPageIndex(e){return Os(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#n("GetFieldObjects")}hasJSActions(){return this.#n("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#n("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#n("GetOptionalContentConfig").then(t=>new hc(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then(s=>({info:s[0],metadata:s[1]?new uc(s[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),bi.cleanup()}}cachedPageNumber(e){if(!Os(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#s.get(t)??null}}class Lc{#e=null;onContinue=null;onError=null;constructor(e){this.#e=e}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class Ut{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:s,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:u,useRequestAnimationFrame:c=!1,pdfBug:h=!1,pageColors:d=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=s,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=u,this._pdfBug=h,this.pageColors=d,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Lc(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(Ut.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ut.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:i,viewport:s,transform:n,background:a}=this.params;this.gfx=new jt(i,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:n,viewport:s,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),Ut.#t.delete(this._canvas),e||=new rs(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ut.#t.delete(this._canvas),this.callback())))}}const Ea="5.3.93",xa="cbeef3233";function ir(r){return Math.floor(Math.max(0,Math.min(1,r))*255).toString(16).padStart(2,"0")}function ri(r){return Math.max(0,Math.min(255,255*r))}class sr{static CMYK_G([e,t,i,s]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ri(e),[e,e,e]}static G_HTML([e]){const t=ir(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(ri)}static RGB_HTML(e){return`#${e.map(ir).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,i+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,i,s]){return[ri(1-Math.min(1,e+s)),ri(1-Math.min(1,i+s)),ri(1-Math.min(1,t+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){const s=1-e,n=1-t,a=1-i,o=Math.min(s,n,a);return["CMYK",s,n,a,o]}}class Fc{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),i||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){se("Abstract method `_createSVG` called.")}}class wi extends Fc{_createSVG(e){return document.createElementNS(at,e)}}class wn{static setupStorage(e,t,i,s,n){const a=s.getValue(t,{value:null});switch(i.name){case"textarea":if(a.value!==null&&(e.textContent=a.value),n==="print")break;e.addEventListener("input",o=>{s.setValue(t,{value:o.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(a.value===i.attributes.xfaOn?e.setAttribute("checked",!0):a.value===i.attributes.xfaOff&&e.removeAttribute("checked"),n==="print")break;e.addEventListener("change",o=>{s.setValue(t,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&e.setAttribute("value",a.value),n==="print")break;e.addEventListener("input",o=>{s.setValue(t,{value:o.target.value})})}break;case"select":if(a.value!==null){e.setAttribute("value",a.value);for(const o of i.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}e.addEventListener("input",o=>{const l=o.target.options,u=l.selectedIndex===-1?"":l[l.selectedIndex].value;s.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:s,linkService:n}){const{attributes:a}=t,o=e instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${s}`);for(const[l,u]of Object.entries(a))if(u!=null)switch(l){case"class":u.length&&e.setAttribute(l,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!o||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,u)}o&&n.addLinkAttributes(e,a.href,a.newWindow),i&&a.dataId&&this.setupStorage(e,a.dataId,t,i)}static render(e){const t=e.annotationStorage,i=e.linkService,s=e.xfaHtml,n=e.intent||"display",a=document.createElement(s.name);s.attributes&&this.setAttributes({html:a,element:s,intent:n,linkService:i});const o=n!=="richText",l=e.div;if(l.append(a),e.viewport){const h=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=h}o&&l.setAttribute("class","xfaLayer xfaFont");const u=[];if(s.children.length===0){if(s.value){const h=document.createTextNode(s.value);a.append(h),o&&vi.shouldBuildText(s.name)&&u.push(h)}return{textDivs:u}}const c=[[s,-1,a]];for(;c.length>0;){const[h,d,f]=c.at(-1);if(d+1===h.children.length){c.pop();continue}const p=h.children[++c.at(-1)[1]];if(p===null)continue;const{name:g}=p;if(g==="#text"){const y=document.createTextNode(p.value);u.push(y),f.append(y);continue}const m=p?.attributes?.xmlns?document.createElementNS(p.attributes.xmlns,g):document.createElement(g);if(f.append(m),p.attributes&&this.setAttributes({html:m,element:p,storage:t,intent:n,linkService:i}),p.children?.length>0)c.push([p,-1,m]);else if(p.value){const y=document.createTextNode(p.value);o&&vi.shouldBuildText(g)&&u.push(y),m.append(y)}}for(const h of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const $c=9,Mt=new WeakSet;class nr{static create(e){switch(e.data.annotationType){case ge.LINK:return new Ca(e);case ge.TEXT:return new Oc(e);case ge.WIDGET:switch(e.data.fieldType){case"Tx":return new Nc(e);case"Btn":return e.data.radioButton?new _a(e):e.data.checkBox?new Vc(e):new Hc(e);case"Ch":return new Kc(e);case"Sig":return new Bc(e)}return new $t(e);case ge.POPUP:return new Bs(e);case ge.FREETEXT:return new Ta(e);case ge.LINE:return new jc(e);case ge.SQUARE:return new zc(e);case ge.CIRCLE:return new Gc(e);case ge.POLYLINE:return new Ra(e);case ge.CARET:return new qc(e);case ge.INK:return new An(e);case ge.POLYGON:return new Wc(e);case ge.HIGHLIGHT:return new ka(e);case ge.UNDERLINE:return new Xc(e);case ge.SQUIGGLY:return new Yc(e);case ge.STRIKEOUT:return new Zc(e);case ge.STAMP:return new Pa(e);case ge.FILEATTACHMENT:return new Jc(e);default:return new be(e)}}}class be{#e=null;#t=!1;#i=null;constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:s=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return be._hasPopupData(this.data)}updateEdited(e){if(!this.container)return;this.#e||={rect:this.data.rect.slice(0)};const{rect:t}=e;t&&this.#s(t),this.#i?.popup.updateEdited(e)}resetEdited(){this.#e&&(this.#s(this.#e.rect),this.#i?.popup.resetEdited(),this.#e=null)}#s(e){const{container:{style:t},data:{rect:i,rotation:s},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}}}=this;i?.splice(0,4,...e),t.left=`${100*(e[0]-o)/n}%`,t.top=`${100*(a-e[3]+l)/a}%`,s===0?(t.width=`${100*(e[2]-e[0])/n}%`,t.height=`${100*(e[3]-e[1])/a}%`):this.setRotation(s)}_createContainer(e){const{data:t,parent:{page:i,viewport:s}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",t.id),this instanceof $t||(n.tabIndex=0);const{style:a}=n;if(a.zIndex=this.parent.zIndex++,t.alternativeText&&(n.title=t.alternativeText),t.noRotate&&n.classList.add("norotate"),!t.rect||this instanceof Bs){const{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}const{width:o,height:l}=this;if(!e&&t.borderStyle.width>0){a.borderWidth=`${t.borderStyle.width}px`;const g=t.borderStyle.horizontalCornerRadius,m=t.borderStyle.verticalCornerRadius;if(g>0||m>0){const v=`calc(${g}px * var(--total-scale-factor)) / calc(${m}px * var(--total-scale-factor))`;a.borderRadius=v}else if(this instanceof _a){const v=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;a.borderRadius=v}switch(t.borderStyle.style){case Vt.SOLID:a.borderStyle="solid";break;case Vt.DASHED:a.borderStyle="dashed";break;case Vt.BEVELED:z("Unimplemented border style: beveled");break;case Vt.INSET:z("Unimplemented border style: inset");break;case Vt.UNDERLINE:a.borderBottomStyle="solid";break}const y=t.borderColor||null;y?(this.#t=!0,a.borderColor=N.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):a.borderWidth=0}const u=N.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:c,pageHeight:h,pageX:d,pageY:f}=s.rawDims;a.left=`${100*(u[0]-d)/c}%`,a.top=`${100*(u[1]-f)/h}%`;const{rotation:p}=t;return t.hasOwnCanvas||p===0?(a.width=`${100*o/c}%`,a.height=`${100*l/h}%`):this.setRotation(p,n),n}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:s}=this.parent.viewport.rawDims;let{width:n,height:a}=this;e%180!==0&&([n,a]=[a,n]),t.style.width=`${100*n/i}%`,t.style.height=`${100*a/s}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,i,s)=>{const n=s.detail[t],a=n[0],o=n.slice(1);s.target.style[i]=sr[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[i]:sr[`${a}_rgb`](o)})};return q(this,"_commonActions",{display:t=>{const{display:i}=t.detail,s=i%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const s of Object.keys(t.detail))(e[s]||i[s])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[s,n]of Object.entries(t)){const a=i[s];if(a){const o={detail:{[s]:n},target:e};a(o),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,i,s,n]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){const[g,m,y,v]=e.subarray(2,6);if(s===g&&n===m&&t===y&&i===v)return}const{style:a}=this.container;let o;if(this.#t){const{borderColor:g,borderWidth:m}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${m}">`],this.container.classList.add("hasBorder")}const l=s-t,u=n-i,{svgFactory:c}=this,h=c.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0),h.role="none";const d=c.createElement("defs");h.append(d);const f=c.createElement("clipPath"),p=`clippath_${this.data.id}`;f.setAttribute("id",p),f.setAttribute("clipPathUnits","objectBoundingBox"),d.append(f);for(let g=2,m=e.length;g<m;g+=8){const y=e[g],v=e[g+1],A=e[g+2],w=e[g+3],S=c.createElement("rect"),E=(A-t)/l,x=(n-v)/u,_=(y-A)/l,C=(v-w)/u;S.setAttribute("x",E),S.setAttribute("y",x),S.setAttribute("width",_),S.setAttribute("height",C),f.append(S),o?.push(`<rect vector-effect="non-scaling-stroke" x="${E}" y="${x}" width="${_}" height="${C}"/>`)}this.#t&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(h),this.container.style.clipPath=`url(#${p})`}_createPopup(){const{data:e}=this,t=this.#i=new Bs({data:{color:e.color,titleObj:e.titleObj,modificationDate:e.modificationDate,contentsObj:e.contentsObj,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},parent:this.parent,elements:[this]});this.parent.div.append(t.render())}render(){se("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const i=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:n,id:a,exportValues:o}of s){if(n===-1||a===t)continue;const l=typeof o=="string"?o:null,u=document.querySelector(`[data-element-id="${a}"]`);if(u&&!Mt.has(u)){z(`_getElementsByName - element not allowed: ${a}`);continue}i.push({id:a,exportValue:l,domElement:u})}return i}for(const s of document.getElementsByName(e)){const{exportValue:n}=s,a=s.getAttribute("data-element-id");a!==t&&Mt.has(s)&&i.push({id:a,exportValue:n,domElement:s})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Ca extends be{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let s=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),s=!0):e.action?(this._bindNamedAction(i,e.action),s=!0):e.attachment?(this.#t(i,e.attachment,e.attachmentDest),s=!0):e.setOCGState?(this.#i(i,e.setOCGState),s=!0):e.dest?(this._bindLink(i,e.dest),s=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),s=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),s=!0):this.isTooltipOnly&&!s&&(this._bindLink(i,""),s=!0)),this.container.classList.add("linkAnnotation"),s&&this.container.append(i),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e()}_bindNamedAction(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),this.#e()}#t(e,t,i=null){e.href=this.linkService.getAnchorUrl(""),t.description&&(e.title=t.description),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,i),!1),this.#e()}#i(e,t){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const s of Object.keys(t.actions)){const n=i.get(s);n&&(e[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:s}}),!1))}e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){z('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{i?.();const{fields:s,refs:n,include:a}=t,o=[];if(s.length!==0||n.length!==0){const c=new Set(n);for(const h of s){const d=this._fieldObjects[h]||[];for(const{id:f}of d)c.add(f)}for(const h of Object.values(this._fieldObjects))for(const d of h)c.has(d.id)===a&&o.push(d)}else for(const c of Object.values(this._fieldObjects))o.push(...c);const l=this.annotationStorage,u=[];for(const c of o){const{id:h}=c;switch(u.push(h),c.type){case"text":{const f=c.defaultValue||"";l.setValue(h,{value:f});break}case"checkbox":case"radiobutton":{const f=c.defaultValue===c.exportValues;l.setValue(h,{value:f});break}case"combobox":case"listbox":{const f=c.defaultValue||"";l.setValue(h,{value:f});break}default:continue}const d=document.querySelector(`[data-element-id="${h}"]`);if(d){if(!Mt.has(d)){z(`_bindResetFormAction - element not allowed: ${h}`);continue}}else continue;d.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:u,name:"ResetForm"}}),!1}}}class Oc extends be{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class $t extends be{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Ce.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,s,n){i.includes("mouse")?e.addEventListener(i,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):e.addEventListener(i,a=>{if(i==="blur"){if(!t.focused||!a.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:n(a)}})})}_setEventListeners(e,t,i,s){for(const[n,a]of i)(a==="Action"||this.data.actions?.[a])&&((a==="Focus"||a==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,n,a,s),a==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):a==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":N.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||$c,n=e.style;let a;const o=2,l=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(u/(bs*s))||1,h=u/c;a=Math.min(s,l(h/bs))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(s,l(u/bs))}n.fontSize=`calc(${a}px * var(--total-scale-factor))`,n.color=N.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(n.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Nc extends $t{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,s){const n=this.annotationStorage;for(const a of this._getElementsByName(e.name,e.id))a.domElement&&(a.domElement[t]=i),n.setValue(a.id,{[s]:i})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const s=e.getValue(t,{value:this.data.fieldValue});let n=s.value||"";const a=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;a&&n.length>a&&(n=n.slice(0,a));let o=s.formattedValue||this.data.textContent?.join(`
`)||null;o&&this.data.comb&&(o=o.replaceAll(/\s+/g,""));const l={userValue:n,formattedValue:o,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=o??n,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",o??n),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),Mt.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=0;const u=this.data.dateFormat||this.data.timeFormat;u&&(i.title=u),this._setRequired(i,this.data.required),a&&(i.maxLength=a),i.addEventListener("input",h=>{e.setValue(t,{value:h.target.value}),this.setPropertyOnSiblings(i,"value",h.target.value,"value"),l.formattedValue=null}),i.addEventListener("resetform",h=>{const d=this.data.defaultFieldValue??"";i.value=l.userValue=d,l.formattedValue=null});let c=h=>{const{formattedValue:d}=l;d!=null&&(h.target.value=d),h.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",d=>{if(l.focused)return;const{target:f}=d;l.userValue&&(f.value=l.userValue),l.lastCommittedValue=f.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),i.addEventListener("updatefromsandbox",d=>{this.showElementAndHideCanvas(d.target);const f={value(p){l.userValue=p.detail.value??"",e.setValue(t,{value:l.userValue.toString()}),p.target.value=l.userValue},formattedValue(p){const{formattedValue:g}=p.detail;l.formattedValue=g,g!=null&&p.target!==document.activeElement&&(p.target.value=g),e.setValue(t,{formattedValue:g})},selRange(p){p.target.setSelectionRange(...p.detail.selRange)},charLimit:p=>{const{charLimit:g}=p.detail,{target:m}=p;if(g===0){m.removeAttribute("maxLength");return}m.setAttribute("maxLength",g);let y=l.userValue;!y||y.length<=g||(y=y.slice(0,g),m.value=l.userValue=y,e.setValue(t,{value:y}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:y,willCommit:!0,commitKey:1,selStart:m.selectionStart,selEnd:m.selectionEnd}}))}};this._dispatchEventFromSandbox(f,d)}),i.addEventListener("keydown",d=>{l.commitKey=1;let f=-1;if(d.key==="Escape"?f=0:d.key==="Enter"&&!this.data.multiLine?f=2:d.key==="Tab"&&(l.commitKey=3),f===-1)return;const{value:p}=d.target;l.lastCommittedValue!==p&&(l.lastCommittedValue=p,l.userValue=p,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:p,willCommit:!0,commitKey:f,selStart:d.target.selectionStart,selEnd:d.target.selectionEnd}}))});const h=c;c=null,i.addEventListener("blur",d=>{if(!l.focused||!d.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{value:f}=d.target;l.userValue=f,l.lastCommittedValue!==f&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:f,willCommit:!0,commitKey:l.commitKey,selStart:d.target.selectionStart,selEnd:d.target.selectionEnd}}),h(d)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",d=>{l.lastCommittedValue=null;const{data:f,target:p}=d,{value:g,selectionStart:m,selectionEnd:y}=p;let v=m,A=y;switch(d.inputType){case"deleteWordBackward":{const w=g.substring(0,m).match(/\w*[^\w]*$/);w&&(v-=w[0].length);break}case"deleteWordForward":{const w=g.substring(m).match(/^[^\w]*\w*/);w&&(A+=w[0].length);break}case"deleteContentBackward":m===y&&(v-=1);break;case"deleteContentForward":m===y&&(A+=1);break}d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,change:f||"",willCommit:!1,selStart:v,selEnd:A}})}),this._setEventListeners(i,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],d=>d.target.value)}if(c&&i.addEventListener("blur",c),this.data.comb){const d=(this.data.rect[2]-this.data.rect[0])/a;i.classList.add("comb"),i.style.letterSpacing=`calc(${d}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Bc extends $t{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Vc extends $t{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let s=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(i,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Mt.add(n),n.setAttribute("data-element-id",i),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=t.fieldName,s&&n.setAttribute("checked",!0),n.setAttribute("exportValue",t.exportValue),n.tabIndex=0,n.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,i)){const c=l&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=c),e.setValue(u.id,{value:c})}e.setValue(i,{value:l})}),n.addEventListener("resetform",a=>{const o=t.defaultFieldValue||"Off";a.target.checked=o===t.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(i,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class _a extends $t{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,i=t.id;let s=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(i,{value:s})),s)for(const a of this._getElementsByName(t.fieldName,i))e.setValue(a.id,{value:!1});const n=document.createElement("input");if(Mt.add(n),n.setAttribute("data-element-id",i),n.disabled=t.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=t.fieldName,s&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const u of this._getElementsByName(o,i))e.setValue(u.id,{value:!1});e.setValue(i,{value:l})}),n.addEventListener("resetform",a=>{const o=t.defaultFieldValue;a.target.checked=o!=null&&o===t.buttonValue}),this.enableScripting&&this.hasJSActions){const a=t.buttonValue;n.addEventListener("updatefromsandbox",o=>{const l={value:u=>{const c=a===u.detail.value;for(const h of this._getElementsByName(u.target.name)){const d=c&&h.id===i;h.domElement&&(h.domElement.checked=d),e.setValue(h.id,{value:d})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Hc extends Ca{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}}class Kc extends $t{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");Mt.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",c=>{const h=this.data.defaultFieldValue;for(const d of s.options)d.selected=d.value===h});for(const c of this.data.options){const h=document.createElement("option");h.textContent=c.displayValue,h.value=c.exportValue,i.value.includes(c.exportValue)&&(h.setAttribute("selected",!0),n=!1),s.append(h)}let a=null;if(n){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),s.prepend(c),a=()=>{c.remove(),s.removeEventListener("input",a),a=null},s.addEventListener("input",a)}const o=c=>{const h=c?"value":"textContent",{options:d,multiple:f}=s;return f?Array.prototype.filter.call(d,p=>p.selected).map(p=>p[h]):d.selectedIndex===-1?null:d[d.selectedIndex][h]};let l=o(!1);const u=c=>{const h=c.target.options;return Array.prototype.map.call(h,d=>({displayValue:d.textContent,exportValue:d.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",c=>{const h={value(d){a?.();const f=d.detail.value,p=new Set(Array.isArray(f)?f:[f]);for(const g of s.options)g.selected=p.has(g.value);e.setValue(t,{value:o(!0)}),l=o(!1)},multipleSelection(d){s.multiple=!0},remove(d){const f=s.options,p=d.detail.remove;f[p].selected=!1,s.remove(p),f.length>0&&Array.prototype.findIndex.call(f,m=>m.selected)===-1&&(f[0].selected=!0),e.setValue(t,{value:o(!0),items:u(d)}),l=o(!1)},clear(d){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),l=o(!1)},insert(d){const{index:f,displayValue:p,exportValue:g}=d.detail.insert,m=s.children[f],y=document.createElement("option");y.textContent=p,y.value=g,m?m.before(y):s.append(y),e.setValue(t,{value:o(!0),items:u(d)}),l=o(!1)},items(d){const{items:f}=d.detail;for(;s.length!==0;)s.remove(0);for(const p of f){const{displayValue:g,exportValue:m}=p,y=document.createElement("option");y.textContent=g,y.value=m,s.append(y)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:o(!0),items:u(d)}),l=o(!1)},indices(d){const f=new Set(d.detail.indices);for(const p of d.target.options)p.selected=f.has(p.index);e.setValue(t,{value:o(!0)}),l=o(!1)},editable(d){d.target.disabled=!d.detail.editable}};this._dispatchEventFromSandbox(h,c)}),s.addEventListener("input",c=>{const h=o(!0),d=o(!1);e.setValue(t,{value:h}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:d,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):s.addEventListener("input",function(c){e.setValue(t,{value:o(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Bs extends be{constructor(e){const{data:t,elements:i}=e;super(e,{isRenderable:be._hasPopupData(t)}),this.elements=i,this.popup=null}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=new Uc({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),i=[];for(const s of this.elements)s.popup=t,s.container.ariaHasPopup="dialog",i.push(s.data.id),s.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(s=>`${ln}${s}`).join(",")),this.container}}class Uc{#e=this.#T.bind(this);#t=this.#_.bind(this);#i=this.#R.bind(this);#s=this.#E.bind(this);#r=null;#n=null;#o=null;#a=null;#h=null;#l=null;#d=null;#c=!1;#f=null;#p=null;#g=null;#u=null;#m=null;#y=null;#b=!1;constructor({container:e,color:t,elements:i,titleObj:s,modificationDate:n,contentsObj:a,richText:o,parent:l,rect:u,parentRect:c,open:h}){this.#n=e,this.#m=s,this.#o=a,this.#u=o,this.#l=l,this.#r=t,this.#g=u,this.#d=c,this.#h=i,this.#a=un.toDateObject(n),this.trigger=i.flatMap(d=>d.getElementsToTriggerPopup());for(const d of this.trigger)d.addEventListener("click",this.#s),d.addEventListener("mouseenter",this.#i),d.addEventListener("mouseleave",this.#t),d.classList.add("popupTriggerArea");for(const d of i)d.container?.addEventListener("keydown",this.#e);this.#n.hidden=!0,h&&this.#E()}render(){if(this.#f)return;const e=this.#f=document.createElement("div");if(e.className="popup",this.#r){const n=e.style.outlineColor=N.makeHexColor(...this.#r);e.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const t=document.createElement("span");t.className="header";const i=document.createElement("h1");if(t.append(i),{dir:i.dir,str:i.textContent}=this.#m,e.append(t),this.#a){const n=document.createElement("time");n.classList.add("popupDate"),n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#a.valueOf()})),n.dateTime=this.#a.toISOString(),t.append(n)}const s=this.#w;if(s)wn.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(this.#o);e.append(n)}this.#n.append(e)}get#w(){const e=this.#u,t=this.#o;return e?.str&&(!t?.str||t.str===e.str)&&this.#u.html||null}get#A(){return this.#w?.attributes?.style?.fontSize||0}get#S(){return this.#w?.attributes?.style?.color||null}#C(e){const t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:this.#S,fontSize:this.#A?`calc(${this.#A}px * var(--total-scale-factor))`:""}};for(const n of e.split(`
`))t.push({name:"span",value:n,attributes:s});return i}_formatContents({str:e,dir:t}){const i=document.createElement("p");i.classList.add("popupContent"),i.dir=t;const s=e.split(/(?:\r\n?|\n)/);for(let n=0,a=s.length;n<a;++n){const o=s[n];i.append(document.createTextNode(o)),n<a-1&&i.append(document.createElement("br"))}return i}#T(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#c)&&this.#E()}updateEdited({rect:e,popupContent:t}){this.#y||={contentsObj:this.#o,richText:this.#u},e&&(this.#p=null),t&&(this.#u=this.#C(t),this.#o=null),this.#f?.remove(),this.#f=null}resetEdited(){this.#y&&({contentsObj:this.#o,richText:this.#u}=this.#y,this.#y=null,this.#f?.remove(),this.#f=null,this.#p=null)}#k(){if(this.#p!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:s,pageY:n}}}=this.#l;let a=!!this.#d,o=a?this.#d:this.#g;for(const p of this.#h)if(!o||N.intersect(p.data.rect,o)!==null){o=p.data.rect,a=!0;break}const l=N.normalizeRect([o[0],e[3]-o[1]+e[1],o[2],e[3]-o[3]+e[1]]),c=a?o[2]-o[0]+5:0,h=l[0]+c,d=l[1];this.#p=[100*(h-s)/t,100*(d-n)/i];const{style:f}=this.#n;f.left=`${this.#p[0]}%`,f.top=`${this.#p[1]}%`}#E(){this.#c=!this.#c,this.#c?(this.#R(),this.#n.addEventListener("click",this.#s),this.#n.addEventListener("keydown",this.#e)):(this.#_(),this.#n.removeEventListener("click",this.#s),this.#n.removeEventListener("keydown",this.#e))}#R(){this.#f||this.render(),this.isVisible?this.#c&&this.#n.classList.add("focused"):(this.#k(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#_(){this.#n.classList.remove("focused"),!(this.#c||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#b=this.isVisible,this.#b&&(this.#n.hidden=!0)}maybeShow(){this.#b&&(this.#f||this.#R(),this.#b=!1,this.#n.hidden=!1)}get isVisible(){return this.#n.hidden===!1}}class Ta extends be{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=U.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class jc extends be{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:i}=this,s=this.svgFactory.create(t,i,!0),n=this.#e=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),n.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),n.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),n.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),n.setAttribute("stroke-width",e.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),s.append(n),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class zc extends be{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:i}=this,s=this.svgFactory.create(t,i,!0),n=e.borderStyle.width,a=this.#e=this.svgFactory.createElement("svg:rect");return a.setAttribute("x",n/2),a.setAttribute("y",n/2),a.setAttribute("width",t-n),a.setAttribute("height",i-n),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Gc extends be{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:i}=this,s=this.svgFactory.create(t,i,!0),n=e.borderStyle.width,a=this.#e=this.svgFactory.createElement("svg:ellipse");return a.setAttribute("cx",t/2),a.setAttribute("cy",i/2),a.setAttribute("rx",t/2-n/2),a.setAttribute("ry",i/2-n/2),a.setAttribute("stroke-width",n||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),s.append(a),this.container.append(s),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ra extends be{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:i,popupRef:s},width:n,height:a}=this;if(!t)return this.container;const o=this.svgFactory.create(n,a,!0);let l=[];for(let c=0,h=t.length;c<h;c+=2){const d=t[c]-e[0],f=e[3]-t[c+1];l.push(`${d},${f}`)}l=l.join(" ");const u=this.#e=this.svgFactory.createElement(this.svgElementName);return u.setAttribute("points",l),u.setAttribute("stroke-width",i.width||1),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),o.append(u),this.container.append(o),!s&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Wc extends Ra{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class qc extends be{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class An extends be{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?U.HIGHLIGHT:U.INK}#i(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:i,borderStyle:s,popupRef:n}}=this,{transform:a,width:o,height:l}=this.#i(t,e),u=this.svgFactory.create(o,l,!0),c=this.#e=this.svgFactory.createElement("svg:g");u.append(c),c.setAttribute("stroke-width",s.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",a);for(let h=0,d=i.length;h<d;h++){const f=this.svgFactory.createElement(this.svgElementName);this.#t.push(f),f.setAttribute("points",i[h].join(",")),c.append(f)}return!n&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:i,rect:s}=e,n=this.#e;if(t>=0&&n.setAttribute("stroke-width",t||1),i)for(let a=0,o=this.#t.length;a<o;a++)this.#t[a].setAttribute("points",i[a].join(","));if(s){const{transform:a,width:o,height:l}=this.#i(this.data.rotation,s);n.parentElement.setAttribute("viewBox",`0 0 ${o} ${l}`),n.setAttribute("transform",a)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class ka extends be{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=U.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class Xc extends be{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class Yc extends be{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class Zc extends be{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class Pa extends be{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=U.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Jc extends be{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let i;t.hasAppearance||t.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#t.bind(this)),this.#e=i;const{isMac:s}=Ce.platform;return e.addEventListener("keydown",n=>{n.key==="Enter"&&(s?n.metaKey:n.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}let Sn=class Da{#e=null;#t=null;#i=new Map;#s=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:s,page:n,viewport:a,structTreeLayer:o}){this.div=e,this.#e=t,this.#t=i,this.#s=o||null,this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=s}hasEditableAnnotations(){return this.#i.size>0}async#r(e,t,i){const s=e.firstChild||e,n=s.id=`${ln}${t}`,a=await this.#s?.getAriaAttributes(n);if(a)for(const[o,l]of a)s.setAttribute(o,l);i?i.at(-1).container.after(e):(this.div.append(e),this.#e?.moveElementInDOM(this.div,e,s,!1))}async render(e){const{annotations:t}=e,i=this.div;vt(i,this.viewport);const s=new Map,n={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new wi,annotationStorage:e.annotationStorage||new fn,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const o=a.annotationType===ge.POPUP;if(o){const c=s.get(a.id);if(!c)continue;n.elements=c}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;n.data=a;const l=nr.create(n);if(!l.isRenderable)continue;if(!o&&a.popupRef){const c=s.get(a.popupRef);c?c.push(l):s.set(a.popupRef,[l])}const u=l.render();a.hidden&&(u.style.visibility="hidden"),await this.#r(u,a.id,n.elements),l._isEditable&&(this.#i.set(l.data.id,l),this._annotationEditorUIManager?.renderAnnotationElement(l))}this.#n()}async addLinkAnnotations(e,t){const i={data:null,layer:this.div,linkService:t,svgFactory:new wi,parent:this};for(const s of e){s.borderStyle||=Da._defaultBorderStyle,i.data=s;const n=nr.create(i);if(!n.isRenderable)continue;const a=n.render();await this.#r(a,s.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,vt(t,{rotation:e.rotation}),this.#n(),t.hidden=!1}#n(){if(!this.#t)return;const e=this.div;for(const[t,i]of this.#t){const s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;i.className="annotationContent";const{firstChild:n}=s;n?n.nodeName==="CANVAS"?n.replaceWith(i):n.classList.contains("annotationContent")?n.after(i):n.before(i):s.append(i);const a=this.#i.get(t);a&&(a._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,s.id,i),a._hasNoCanvas=!1):a.canvas=i)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#i.values())}getEditableAnnotation(e){return this.#i.get(e)}static get _defaultBorderStyle(){return q(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Vt.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};const Ki=/\r\n?|\n/g;class Se extends V{#e;#t="";#i=`${this.id}-editor`;#s=null;#r;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=Se.prototype,t=n=>n.isEmpty(),i=dt.TRANSLATE_SMALL,s=dt.TRANSLATE_BIG;return q(this,"_keyboardManager",new Pi([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}]]))}static _type="freetext";static _editorType=U.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.#e=e.color||Se._defaultColor||V._defaultLineColor,this.#r=e.fontSize||Se._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(e,t){V.initialize(e,t);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case X.FREETEXT_SIZE:Se._defaultFontSize=t;break;case X.FREETEXT_COLOR:Se._defaultColor=t;break}}updateParams(e,t){switch(e){case X.FREETEXT_SIZE:this.#n(t);break;case X.FREETEXT_COLOR:this.#o(t);break}}static get defaultPropertiesToUpdate(){return[[X.FREETEXT_SIZE,Se._defaultFontSize],[X.FREETEXT_COLOR,Se._defaultColor||V._defaultLineColor]]}get propertiesToUpdate(){return[[X.FREETEXT_SIZE,this.#r],[X.FREETEXT_COLOR,this.#e]]}#n(e){const t=s=>{this.editorDiv.style.fontSize=`calc(${s}px * var(--total-scale-factor))`,this.translate(0,-(s-this.#r)*this.parentScale),this.#r=s,this.#h()},i=this.#r;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#o(e){const t=s=>{this.#e=this.editorDiv.style.color=s},i=this.#e;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-Se._internalPadding*e,-(Se._internalPadding+this.#r)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;const e=this._uiManager.combinedSignal(this.#s);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#i),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#a(){const e=[];this.editorDiv.normalize();let t=null;for(const i of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(e.push(Se.#l(i)),t=i);return e.join(`
`)}#h(){const[e,t]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:s,div:n}=this,a=n.style.display,o=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",s.div.append(this.div),i=n.getBoundingClientRect(),n.remove(),n.style.display=a,n.classList.toggle("hidden",o)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/t):(this.width=i.height/e,this.height=i.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#t,t=this.#t=this.#a().trimEnd();if(e===t)return;const i=s=>{if(this.#t=s,!s){this.remove();return}this.#d(),this._uiManager.rebuild(this),this.#h()};this.addCommands({cmd:()=>{i(t)},undo:()=>{i(e)},mustExec:!1}),this.#h()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){Se._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#i),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#r}px * var(--total-scale-factor))`,i.color=this.#e,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[s,n]=this.parentDimensions;if(this.annotationElementId){const{position:a}=this._initialData;let[o,l]=this.getInitialTranslation();[o,l]=this.pageTranslationToScreen(o,l);const[u,c]=this.pageDimensions,[h,d]=this.pageTranslation;let f,p;switch(this.rotation){case 0:f=e+(a[0]-h)/u,p=t+this.height-(a[1]-d)/c;break;case 90:f=e+(a[0]-h)/u,p=t-(a[1]-d)/c,[o,l]=[l,-o];break;case 180:f=e-this.width+(a[0]-h)/u,p=t-(a[1]-d)/c,[o,l]=[-o,-l];break;case 270:f=e+(a[0]-h-this.height*c)/u,p=t+(a[1]-d-this.width*u)/c,[o,l]=[-l,o];break}this.setAt(f*s,p*n,o,l)}else this._moveAfterPaste(e,t);this.#d(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#l(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Ki,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:i}=t;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();const s=Se.#f(t.getData("text")||"").replaceAll(Ki,`
`);if(!s)return;const n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();const a=n.getRangeAt(0);if(!s.includes(`
`)){a.insertNode(document.createTextNode(s)),this.editorDiv.normalize(),n.collapseToStart();return}const{startContainer:o,startOffset:l}=a,u=[],c=[];if(o.nodeType===Node.TEXT_NODE){const f=o.parentElement;if(c.push(o.nodeValue.slice(l).replaceAll(Ki,"")),f!==this.editorDiv){let p=u;for(const g of this.editorDiv.childNodes){if(g===f){p=c;continue}p.push(Se.#l(g))}}u.push(o.nodeValue.slice(0,l).replaceAll(Ki,""))}else if(o===this.editorDiv){let f=u,p=0;for(const g of this.editorDiv.childNodes)p++===l&&(f=c),f.push(Se.#l(g))}this.#t=`${u.join(`
`)}${s}${c.join(`
`)}`,this.#d();const h=new Range;let d=Math.sumPrecise(u.map(f=>f.length));for(const{firstChild:f}of this.editorDiv.childNodes)if(f.nodeType===Node.TEXT_NODE){const p=f.nodeValue.length;if(d<=p){h.setStart(f,d),h.setEnd(f,d);break}d-=p}n.removeAllRanges(),n.addRange(h)}#d(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const e of this.#t.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#c(){return this.#t.replaceAll(" "," ")}static#f(e){return e.replaceAll(" "," ")}get contentDiv(){return this.editorDiv}static async deserialize(e,t,i){let s=null;if(e instanceof Ta){const{data:{defaultAppearanceData:{fontSize:a,fontColor:o},rect:l,rotation:u,id:c,popupRef:h},textContent:d,textPosition:f,parent:{page:{pageNumber:p}}}=e;if(!d||d.length===0)return null;s=e={annotationType:U.FREETEXT,color:Array.from(o),fontSize:a,value:d.join(`
`),position:f,pageIndex:p-1,rect:l.slice(0),rotation:u,annotationElementId:c,id:c,deleted:!1,popupRef:h}}const n=await super.deserialize(e,t,i);return n.#r=e.fontSize,n.#e=N.makeHexColor(...e.color),n.#t=Se.#f(e.value),n._initialData=s,n}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=Se._internalPadding*this.parentScale,i=this.getRect(t,t),s=V._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#e),n={annotationType:U.FREETEXT,color:s,fontSize:this.#r,value:this.#c(),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(n.isCopy=!0,n):this.annotationElementId&&!this.#p(n)?null:(n.id=this.annotationElementId,n)}#p(e){const{value:t,fontSize:i,color:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||e.value!==t||e.fontSize!==i||e.color.some((a,o)=>a!==s[o])||e.pageIndex!==n}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(this.deleted)return t;const{style:i}=t;i.fontSize=`calc(${this.#r}px * var(--total-scale-factor))`,i.color=this.#e,t.replaceChildren();for(const n of this.#t.split(`
`)){const a=document.createElement("div");a.append(n?document.createTextNode(n):document.createElement("br")),t.append(a)}const s=Se._internalPadding*this.parentScale;return e.updateEdited({rect:this.getRect(s,s),popupContent:this.#t}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class F{static PRECISION=1e-4;toSVGPath(){se("Abstract method `toSVGPath` must be implemented.")}get box(){se("Abstract getter `box` must be implemented.")}serialize(e,t){se("Abstract method `serialize` must be implemented.")}static _rescale(e,t,i,s,n,a){a||=new Float32Array(e.length);for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o]*s,a[o+1]=i+e[o+1]*n;return a}static _rescaleAndSwap(e,t,i,s,n,a){a||=new Float32Array(e.length);for(let o=0,l=e.length;o<l;o+=2)a[o]=t+e[o+1]*s,a[o+1]=i+e[o]*n;return a}static _translate(e,t,i,s){s||=new Float32Array(e.length);for(let n=0,a=e.length;n<a;n+=2)s[n]=t+e[n],s[n+1]=i+e[n+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,i,s,n){switch(n){case 90:return[1-t/i,e/s];case 180:return[1-e/i,1-t/s];case 270:return[t/i,1-e/s];default:return[e/i,t/s]}}static _normalizePagePoint(e,t,i){switch(i){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,i,s,n,a){return[(e+5*i)/6,(t+5*s)/6,(5*i+n)/6,(5*s+a)/6,(i+n)/2,(s+a)/2]}}class Ct{#e;#t=[];#i;#s;#r=[];#n=new Float32Array(18);#o;#a;#h;#l;#d;#c;#f=[];static#p=8;static#g=2;static#u=Ct.#p+Ct.#g;constructor({x:e,y:t},i,s,n,a,o=0){this.#e=i,this.#c=n*s,this.#s=a,this.#n.set([NaN,NaN,NaN,NaN,e,t],6),this.#i=o,this.#l=Ct.#p*s,this.#h=Ct.#u*s,this.#d=s,this.#f.push(e,t)}isEmpty(){return isNaN(this.#n[8])}#m(){const e=this.#n.subarray(4,6),t=this.#n.subarray(16,18),[i,s,n,a]=this.#e;return[(this.#o+(e[0]-t[0])/2-i)/n,(this.#a+(e[1]-t[1])/2-s)/a,(this.#o+(t[0]-e[0])/2-i)/n,(this.#a+(t[1]-e[1])/2-s)/a]}add({x:e,y:t}){this.#o=e,this.#a=t;const[i,s,n,a]=this.#e;let[o,l,u,c]=this.#n.subarray(8,12);const h=e-u,d=t-c,f=Math.hypot(h,d);if(f<this.#h)return!1;const p=f-this.#l,g=p/f,m=g*h,y=g*d;let v=o,A=l;o=u,l=c,u+=m,c+=y,this.#f?.push(e,t);const w=-y/p,S=m/p,E=w*this.#c,x=S*this.#c;return this.#n.set(this.#n.subarray(2,8),0),this.#n.set([u+E,c+x],4),this.#n.set(this.#n.subarray(14,18),12),this.#n.set([u-E,c-x],16),isNaN(this.#n[6])?(this.#r.length===0&&(this.#n.set([o+E,l+x],2),this.#r.push(NaN,NaN,NaN,NaN,(o+E-i)/n,(l+x-s)/a),this.#n.set([o-E,l-x],14),this.#t.push(NaN,NaN,NaN,NaN,(o-E-i)/n,(l-x-s)/a)),this.#n.set([v,A,o,l,u,c],6),!this.isEmpty()):(this.#n.set([v,A,o,l,u,c],6),Math.abs(Math.atan2(A-l,v-o)-Math.atan2(y,m))<Math.PI/2?([o,l,u,c]=this.#n.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((o+u)/2-i)/n,((l+c)/2-s)/a),[o,l,v,A]=this.#n.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((v+o)/2-i)/n,((A+l)/2-s)/a),!0):([v,A,o,l,u,c]=this.#n.subarray(0,6),this.#r.push(((v+5*o)/6-i)/n,((A+5*l)/6-s)/a,((5*o+u)/6-i)/n,((5*l+c)/6-s)/a,((o+u)/2-i)/n,((l+c)/2-s)/a),[u,c,o,l,v,A]=this.#n.subarray(12,18),this.#t.push(((v+5*o)/6-i)/n,((A+5*l)/6-s)/a,((5*o+u)/6-i)/n,((5*l+c)/6-s)/a,((o+u)/2-i)/n,((l+c)/2-s)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#r,t=this.#t;if(isNaN(this.#n[6])&&!this.isEmpty())return this.#y();const i=[];i.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?i.push(`L${e[s+4]} ${e[s+5]}`):i.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);this.#w(i);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?i.push(`L${t[s+4]} ${t[s+5]}`):i.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return this.#b(i),i.join(" ")}#y(){const[e,t,i,s]=this.#e,[n,a,o,l]=this.#m();return`M${(this.#n[2]-e)/i} ${(this.#n[3]-t)/s} L${(this.#n[4]-e)/i} ${(this.#n[5]-t)/s} L${n} ${a} L${o} ${l} L${(this.#n[16]-e)/i} ${(this.#n[17]-t)/s} L${(this.#n[14]-e)/i} ${(this.#n[15]-t)/s} Z`}#b(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#w(e){const[t,i,s,n]=this.#e,a=this.#n.subarray(4,6),o=this.#n.subarray(16,18),[l,u,c,h]=this.#m();e.push(`L${(a[0]-t)/s} ${(a[1]-i)/n} L${l} ${u} L${c} ${h} L${(o[0]-t)/s} ${(o[1]-i)/n}`)}newFreeDrawOutline(e,t,i,s,n,a){return new Ma(e,t,i,s,n,a)}getOutlines(){const e=this.#r,t=this.#t,i=this.#n,[s,n,a,o]=this.#e,l=new Float32Array((this.#f?.length??0)+2);for(let h=0,d=l.length-2;h<d;h+=2)l[h]=(this.#f[h]-s)/a,l[h+1]=(this.#f[h+1]-n)/o;if(l[l.length-2]=(this.#o-s)/a,l[l.length-1]=(this.#a-n)/o,isNaN(i[6])&&!this.isEmpty())return this.#A(l);const u=new Float32Array(this.#r.length+24+this.#t.length);let c=e.length;for(let h=0;h<c;h+=2){if(isNaN(e[h])){u[h]=u[h+1]=NaN;continue}u[h]=e[h],u[h+1]=e[h+1]}c=this.#C(u,c);for(let h=t.length-6;h>=6;h-=6)for(let d=0;d<6;d+=2){if(isNaN(t[h+d])){u[c]=u[c+1]=NaN,c+=2;continue}u[c]=t[h+d],u[c+1]=t[h+d+1],c+=2}return this.#S(u,c),this.newFreeDrawOutline(u,l,this.#e,this.#d,this.#i,this.#s)}#A(e){const t=this.#n,[i,s,n,a]=this.#e,[o,l,u,c]=this.#m(),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-i)/n,(t[3]-s)/a,NaN,NaN,NaN,NaN,(t[4]-i)/n,(t[5]-s)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,(t[16]-i)/n,(t[17]-s)/a,NaN,NaN,NaN,NaN,(t[14]-i)/n,(t[15]-s)/a],0),this.newFreeDrawOutline(h,e,this.#e,this.#d,this.#i,this.#s)}#S(e,t){const i=this.#t;return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6}#C(e,t){const i=this.#n.subarray(4,6),s=this.#n.subarray(16,18),[n,a,o,l]=this.#e,[u,c,h,d]=this.#m();return e.set([NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-a)/l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/l],t),t+=24}}class Ma extends F{#e;#t=new Float32Array(4);#i;#s;#r;#n;#o;constructor(e,t,i,s,n,a){super(),this.#o=e,this.#r=t,this.#e=i,this.#n=s,this.#i=n,this.#s=a,this.lastPoint=[NaN,NaN],this.#a(a);const[o,l,u,c]=this.#t;for(let h=0,d=e.length;h<d;h+=2)e[h]=(e[h]-o)/u,e[h+1]=(e[h+1]-l)/c;for(let h=0,d=t.length;h<d;h+=2)t[h]=(t[h]-o)/u,t[h+1]=(t[h+1]-l)/c}toSVGPath(){const e=[`M${this.#o[4]} ${this.#o[5]}`];for(let t=6,i=this.#o.length;t<i;t+=6){if(isNaN(this.#o[t])){e.push(`L${this.#o[t+4]} ${this.#o[t+5]}`);continue}e.push(`C${this.#o[t]} ${this.#o[t+1]} ${this.#o[t+2]} ${this.#o[t+3]} ${this.#o[t+4]} ${this.#o[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,i,s],n){const a=i-e,o=s-t;let l,u;switch(n){case 0:l=F._rescale(this.#o,e,s,a,-o),u=F._rescale(this.#r,e,s,a,-o);break;case 90:l=F._rescaleAndSwap(this.#o,e,t,a,o),u=F._rescaleAndSwap(this.#r,e,t,a,o);break;case 180:l=F._rescale(this.#o,i,t,-a,o),u=F._rescale(this.#r,i,t,-a,o);break;case 270:l=F._rescaleAndSwap(this.#o,i,s,-a,-o),u=F._rescaleAndSwap(this.#r,i,s,-a,-o);break}return{outline:Array.from(l),points:[Array.from(u)]}}#a(e){const t=this.#o;let i=t[4],s=t[5];const n=[i,s,i,s];let a=i,o=s;const l=e?Math.max:Math.min;for(let c=6,h=t.length;c<h;c+=6){const d=t[c+4],f=t[c+5];if(isNaN(t[c]))N.pointBoundingBox(d,f,n),o<f?(a=d,o=f):o===f&&(a=l(a,d));else{const p=[1/0,1/0,-1/0,-1/0];N.bezierBoundingBox(i,s,...t.slice(c,c+6),p),N.rectBoundingBox(...p,n),o<p[3]?(a=p[2],o=p[3]):o===p[3]&&(a=l(a,p[2]))}i=d,s=f}const u=this.#t;u[0]=n[0]-this.#i,u[1]=n[1]-this.#i,u[2]=n[2]-n[0]+2*this.#i,u[3]=n[3]-n[1]+2*this.#i,this.lastPoint=[a,o]}get box(){return this.#t}newOutliner(e,t,i,s,n,a=0){return new Ct(e,t,i,s,n,a)}getNewOutline(e,t){const[i,s,n,a]=this.#t,[o,l,u,c]=this.#e,h=n*u,d=a*c,f=i*u+o,p=s*c+l,g=this.newOutliner({x:this.#r[0]*h+f,y:this.#r[1]*d+p},this.#e,this.#n,e,this.#s,t??this.#i);for(let m=2;m<this.#r.length;m+=2)g.add({x:this.#r[m]*h+f,y:this.#r[m+1]*d+p});return g.getOutlines()}}class Vs{#e;#t;#i=[];#s=[];constructor(e,t=0,i=0,s=!0){const n=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:f,y:p,width:g,height:m}of e){const y=Math.floor((f-t)/a)*a,v=Math.ceil((f+g+t)/a)*a,A=Math.floor((p-t)/a)*a,w=Math.ceil((p+m+t)/a)*a,S=[y,A,w,!0],E=[v,A,w,!1];this.#i.push(S,E),N.rectBoundingBox(y,A,v,w,n)}const o=n[2]-n[0]+2*i,l=n[3]-n[1]+2*i,u=n[0]-i,c=n[1]-i,h=this.#i.at(s?-1:-2),d=[h[0],h[2]];for(const f of this.#i){const[p,g,m]=f;f[0]=(p-u)/o,f[1]=(g-c)/l,f[2]=(m-c)/l}this.#e=new Float32Array([u,c,o,l]),this.#t=d}getOutlines(){this.#i.sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);const e=[];for(const t of this.#i)t[3]?(e.push(...this.#h(t)),this.#o(t)):(this.#a(t),e.push(...this.#h(t)));return this.#r(e)}#r(e){const t=[],i=new Set;for(const a of e){const[o,l,u]=a;t.push([o,l,a],[o,u,a])}t.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=t.length;a<o;a+=2){const l=t[a][2],u=t[a+1][2];l.push(u),u.push(l),i.add(l),i.add(u)}const s=[];let n;for(;i.size>0;){const a=i.values().next().value;let[o,l,u,c,h]=a;i.delete(a);let d=o,f=l;for(n=[o,u],s.push(n);;){let p;if(i.has(c))p=c;else if(i.has(h))p=h;else break;i.delete(p),[o,l,u,c,h]=p,d!==o&&(n.push(d,f,o,f===l?l:u),d=o),f=f===l?u:l}n.push(d,f)}return new Qc(s,this.#e,this.#t)}#n(e){const t=this.#s;let i=0,s=t.length-1;for(;i<=s;){const n=i+s>>1,a=t[n][0];if(a===e)return n;a<e?i=n+1:s=n-1}return s+1}#o([,e,t]){const i=this.#n(e);this.#s.splice(i,0,[e,t])}#a([,e,t]){const i=this.#n(e);for(let s=i;s<this.#s.length;s++){const[n,a]=this.#s[s];if(n!==e)break;if(n===e&&a===t){this.#s.splice(s,1);return}}for(let s=i-1;s>=0;s--){const[n,a]=this.#s[s];if(n!==e)break;if(n===e&&a===t){this.#s.splice(s,1);return}}}#h(e){const[t,i,s]=e,n=[[t,i,s]],a=this.#n(s);for(let o=0;o<a;o++){const[l,u]=this.#s[o];for(let c=0,h=n.length;c<h;c++){const[,d,f]=n[c];if(!(u<=d||f<=l)){if(d>=l){if(f>u)n[c][1]=u;else{if(h===1)return[];n.splice(c,1),c--,h--}continue}n[c][2]=l,f>u&&n.push([t,u,f])}}}return n}}class Qc extends F{#e;#t;constructor(e,t,i){super(),this.#t=e,this.#e=t,this.lastPoint=i}toSVGPath(){const e=[];for(const t of this.#t){let[i,s]=t;e.push(`M${i} ${s}`);for(let n=2;n<t.length;n+=2){const a=t[n],o=t[n+1];a===i?(e.push(`V${o}`),s=o):o===s&&(e.push(`H${a}`),i=a)}e.push("Z")}return e.join(" ")}serialize([e,t,i,s],n){const a=[],o=i-e,l=s-t;for(const u of this.#t){const c=new Array(u.length);for(let h=0;h<u.length;h+=2)c[h]=e+u[h]*o,c[h+1]=s-u[h+1]*l;a.push(c)}return a}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class Hs extends Ct{newFreeDrawOutline(e,t,i,s,n,a){return new eh(e,t,i,s,n,a)}}class eh extends Ma{newOutliner(e,t,i,s,n,a=0){return new Hs(e,t,i,s,n,a)}}class Ne{#e=null;#t=null;#i;#s=null;#r=!1;#n=!1;#o=null;#a;#h=null;#l=null;#d;static#c=null;static get _keyboardManager(){return q(this,"_keyboardManager",new Pi([[["Escape","mac+Escape"],Ne.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ne.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ne.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ne.prototype._moveToPrevious],[["Home","mac+Home"],Ne.prototype._moveToBeginning],[["End","mac+End"],Ne.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#n=!1,this.#d=X.HIGHLIGHT_COLOR,this.#o=e):(this.#n=!0,this.#d=X.HIGHLIGHT_DEFAULT_COLOR),this.#l=e?._uiManager||t,this.#a=this.#l._eventBus,this.#i=e?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",Ne.#c||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#o&&(e.ariaControls=`${this.#o.id}_colorpicker_dropdown`);const t=this.#l._signal;e.addEventListener("click",this.#u.bind(this),{signal:t}),e.addEventListener("keydown",this.#g.bind(this),{signal:t});const i=this.#t=document.createElement("span");return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=this.#i,e.append(i),e}renderMainDropdown(){const e=this.#s=this.#f();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#f(){const e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",Ke,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#o&&(e.id=`${this.#o.id}_colorpicker_dropdown`);for(const[i,s]of this.#l.highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",s),n.title=i,n.setAttribute("data-l10n-id",Ne.#c[i]);const a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=s,n.ariaSelected=s===this.#i,n.addEventListener("click",this.#p.bind(this,s),{signal:t}),e.append(n)}return e.addEventListener("keydown",this.#g.bind(this),{signal:t}),e}#p(e,t){t.stopPropagation(),this.#a.dispatch("switchannotationeditorparams",{source:this,type:this.#d,value:e})}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#u(e);return}const t=e.target.getAttribute("data-color");t&&this.#p(t,e)}_moveToNext(e){if(!this.#y){this.#u(e);return}if(e.target===this.#e){this.#s.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#s?.firstChild||e.target===this.#e){this.#y&&this._hideDropdownFromKeyboard();return}this.#y||this.#u(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#y){this.#u(e);return}this.#s.firstChild?.focus()}_moveToEnd(e){if(!this.#y){this.#u(e);return}this.#s.lastChild?.focus()}#g(e){Ne._keyboardManager.exec(this,e)}#u(e){if(this.#y){this.hideDropdown();return}if(this.#r=e.detail===0,this.#h||(this.#h=new AbortController,window.addEventListener("pointerdown",this.#m.bind(this),{signal:this.#l.combinedSignal(this.#h)})),this.#e.ariaExpanded="true",this.#s){this.#s.classList.remove("hidden");return}const t=this.#s=this.#f();this.#e.append(t)}#m(e){this.#s?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#h?.abort(),this.#h=null}get#y(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#n){if(!this.#y){this.#o?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#s)return;const t=this.#l.highlightColors.values();for(const i of this.#s.children)i.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#s?.remove(),this.#s=null}}class me extends V{#e=null;#t=0;#i;#s=null;#r=null;#n=null;#o=null;#a=0;#h=null;#l=null;#d=null;#c=!1;#f=null;#p;#g=null;#u="";#m;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=U.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=me.prototype;return q(this,"_keyboardManager",new Pi([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||me._defaultColor,this.#m=e.thickness||me._defaultThickness,this.#p=e.opacity||me._defaultOpacity,this.#i=e.boxes||null,this.#y=e.methodOfCreation||"",this.#u=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#c=!0,this.#w(e),this.#k()):this.#i&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#o=e.focusNode,this.#a=e.focusOffset,this.#b(),this.#k(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#c?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:this.#m,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){const e=new Vs(this.#i,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const t=new Vs(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#n=t.getOutlines();const{lastPoint:i}=this.#n;this.#f=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#w({highlightOutlines:e,highlightId:t,clipPathId:i}){this.#l=e;const s=1.5;if(this.#n=e.getNewOutline(this.#m/2+s,.0025),t>=0)this.#d=t,this.#s=i,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#g=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},!0);else if(this.parent){const c=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:me.#E(this.#l.box,(c-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#g,{bbox:me.#E(this.#n.box,c),path:{d:this.#n.toSVGPath()}})}const[n,a,o,l]=e.box;switch(this.rotation){case 0:this.x=n,this.y=a,this.width=o,this.height=l;break;case 90:{const[c,h]=this.parentDimensions;this.x=a,this.y=1-n,this.width=o*h/c,this.height=l*c/h;break}case 180:this.x=1-n,this.y=1-a,this.width=o,this.height=l;break;case 270:{const[c,h]=this.parentDimensions;this.x=1-a,this.y=n,this.width=o*h/c,this.height=l*c/h;break}}const{lastPoint:u}=this.#n;this.#f=[(u[0]-n)/o,(u[1]-a)/l]}static initialize(e,t){V.initialize(e,t),me._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case X.HIGHLIGHT_DEFAULT_COLOR:me._defaultColor=t;break;case X.HIGHLIGHT_THICKNESS:me._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#f}updateParams(e,t){switch(e){case X.HIGHLIGHT_COLOR:this.#A(t);break;case X.HIGHLIGHT_THICKNESS:this.#S(t);break}}static get defaultPropertiesToUpdate(){return[[X.HIGHLIGHT_DEFAULT_COLOR,me._defaultColor],[X.HIGHLIGHT_THICKNESS,me._defaultThickness]]}get propertiesToUpdate(){return[[X.HIGHLIGHT_COLOR,this.color||me._defaultColor],[X.HIGHLIGHT_THICKNESS,this.#m||me._defaultThickness],[X.HIGHLIGHT_FREE,this.#c]]}#A(e){const t=(n,a)=>{this.color=n,this.#p=a,this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:n,"fill-opacity":a}}),this.#r?.updateColor(n)},i=this.color,s=this.#p;this.addCommands({cmd:t.bind(this,e,me._defaultOpacity),undo:t.bind(this,i,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(e)},!0)}#S(e){const t=this.#m,i=s=>{this.#m=s,this.#C(s)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:X.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#r=new Ne({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#D())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#D())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#T(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#k(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#T():e&&(this.#k(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#C(e){if(!this.#c)return;this.#w({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition();const[t,i]=this.parentDimensions;this.setDims(this.width*t,this.height*i)}#T(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#g),this.#g=null)}#k(e=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#s}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.#p},rootClass:{highlight:!0,free:this.#c},path:{d:this.#l.toSVGPath()}},!1,!0),this.#g=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#c},bbox:this.#n.box,path:{d:this.#n.toSVGPath()}},this.#c),this.#h&&(this.#h.style.clipPath=this.#s))}static#E([e,t,i,s],n){switch(n){case 90:return[1-t-s,e,s,i];case 180:return[1-e-i,1-t-s,i,s];case 270:return[t,1-e-i,s,i]}return[e,t,i,s]}rotate(e){const{drawLayer:t}=this.parent;let i;this.#c?(e=(e-this.rotation+360)%360,i=me.#E(this.#l.box,e)):i=me.#E([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#d,{bbox:i,root:{"data-main-rotation":e}}),t.updateProperties(this.#g,{bbox:me.#E(this.#n.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#u&&(e.setAttribute("aria-label",this.#u),e.setAttribute("role","mark")),this.#c?e.classList.add("free"):this.div.addEventListener("keydown",this.#R.bind(this),{signal:this._uiManager._signal});const t=this.#h=document.createElement("div");e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#s;const[i,s]=this.parentDimensions;return this.setDims(this.width*i,this.height*s),ra(this,this.#h,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1}})}#R(e){me._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#_(!0);break;case 1:case 3:this.#_(!1);break}}#_(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#o,this.#a)}select(){super.select(),this.#g&&this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#g&&(this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{selected:!1}}),this.#c||this.#_(!1))}get _mustFixPosition(){return!this.#c}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#g,{rootClass:{hidden:!e}}))}#D(){return this.#c?this.rotation:0}#M(){if(this.#c)return null;const[e,t]=this.pageDimensions,[i,s]=this.pageTranslation,n=this.#i,a=new Float32Array(n.length*8);let o=0;for(const{x:l,y:u,width:c,height:h}of n){const d=l*e+i,f=(1-u)*t+s;a[o]=a[o+4]=d,a[o+1]=a[o+3]=f,a[o+2]=a[o+6]=d+c*e,a[o+5]=a[o+7]=f-h*t,o+=8}return a}#I(e){return this.#l.serialize(e,this.#D())}static startHighlighting(e,t,{target:i,x:s,y:n}){const{x:a,y:o,width:l,height:u}=i.getBoundingClientRect(),c=new AbortController,h=e.combinedSignal(c),d=f=>{c.abort(),this.#x(e,f)};window.addEventListener("blur",d,{signal:h}),window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("pointerdown",ye,{capture:!0,passive:!1,signal:h}),window.addEventListener("contextmenu",Ke,{signal:h}),i.addEventListener("pointermove",this.#V.bind(this,e),{signal:h}),this._freeHighlight=new Hs({x:s,y:n},[a,o,l,u],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#V(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#x(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,i){let s=null;if(e instanceof ka){const{data:{quadPoints:p,rect:g,rotation:m,id:y,color:v,opacity:A,popupRef:w},parent:{page:{pageNumber:S}}}=e;s=e={annotationType:U.HIGHLIGHT,color:Array.from(v),opacity:A,quadPoints:p,boxes:null,pageIndex:S-1,rect:g.slice(0),rotation:m,annotationElementId:y,id:y,deleted:!1,popupRef:w}}else if(e instanceof An){const{data:{inkLists:p,rect:g,rotation:m,id:y,color:v,borderStyle:{rawWidth:A},popupRef:w},parent:{page:{pageNumber:S}}}=e;s=e={annotationType:U.HIGHLIGHT,color:Array.from(v),thickness:A,inkLists:p,boxes:null,pageIndex:S-1,rect:g.slice(0),rotation:m,annotationElementId:y,id:y,deleted:!1,popupRef:w}}const{color:n,quadPoints:a,inkLists:o,opacity:l}=e,u=await super.deserialize(e,t,i);u.color=N.makeHexColor(...n),u.#p=l||1,o&&(u.#m=e.thickness),u._initialData=s;const[c,h]=u.pageDimensions,[d,f]=u.pageTranslation;if(a){const p=u.#i=[];for(let g=0;g<a.length;g+=8)p.push({x:(a[g]-d)/c,y:1-(a[g+1]-f)/h,width:(a[g+2]-a[g])/c,height:(a[g+1]-a[g+5])/h});u.#b(),u.#k(),u.rotate(u.rotation)}else if(o){u.#c=!0;const p=o[0],g={x:p[0]-d,y:h-(p[1]-f)},m=new Hs(g,[0,0,c,h],1,u.#m/2,!0,.001);for(let A=0,w=p.length;A<w;A+=2)g.x=p[A]-d,g.y=h-(p[A+1]-f),m.add(g);const{id:y,clipPathId:v}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:u.color,"fill-opacity":u._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:m.toSVGPath()}},!0,!0);u.#w({highlightOutlines:m.getOutlines(),highlightId:y,clipPathId:v}),u.#k(),u.rotate(u.parentRotation)}return u}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=this.getRect(0,0),i=V._colorManager.convert(this.color),s={annotationType:U.HIGHLIGHT,color:i,opacity:this.#p,thickness:this.#m,quadPoints:this.#M(),outlines:this.#I(t),pageIndex:this.pageIndex,rect:t,rotation:this.#D(),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!this.#v(s)?null:(s.id=this.annotationElementId,s)}#v(e){const{color:t}=this._initialData;return e.color.some((i,s)=>i!==t[s])}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class Ia{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,i]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,i)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){se("Not implemented")}}class H extends V{#e=null;#t;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#s=null;static#r=null;static#n=NaN;static#o=null;static#a=null;static#h=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}_addOutlines(e){e.drawOutlines&&(this.#l(e),this.#f())}#l({drawOutlines:e,drawId:t,drawingOptions:i}){this.#e=e,this._drawingOptions||=i,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#d(e,this.parent),this.#u(e.box)}#d(e,t){const{id:i}=t.drawLayer.draw(H._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(e,t){const i=new Set(Object.keys(e));for(const[s,n]of Object.entries(t))i.has(s)?Object.assign(e[s],n):e[s]=n;return e}static getDefaultDrawingOptions(e){se("Not implemented")}static get typesMap(){se("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const i=this.typesMap.get(e);i&&this._defaultDrawingOptions.updateProperty(i,t),this._currentParent&&(H.#i.updateProperty(i,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[i,s]of this.typesMap)e.push([i,t[s]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[i,s]of this.constructor.typesMap)e.push([i,t[s]]);return e}_updateProperty(e,t,i){const s=this._drawingOptions,n=s[t],a=o=>{s.updateProperty(t,o);const l=this.#e.updateProperty(t,o);l&&this.#u(l),this.parent?.drawLayer.updateProperties(this._drawId,s.toSVGProperties())};this.addCommands({cmd:a.bind(this,i),undo:a.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#g()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#g()),{bbox:this.#m()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#g(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#c(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#u(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#c()):e&&(this._uiManager.addShouldRescale(this),this.#f(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#c(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#d(this.#e,e)}}#p([e,t,i,s]){const{parentDimensions:[n,a],rotation:o}=this;switch(o){case 90:return[t,1-e,i*(a/n),s*(n/a)];case 180:return[1-e,1-t,i,s];case 270:return[1-t,e,i*(a/n),s*(n/a)];default:return[e,t,i,s]}}#g(){const{x:e,y:t,width:i,height:s,parentDimensions:[n,a],rotation:o}=this;switch(o){case 90:return[1-t,e,i*(n/a),s*(a/n)];case 180:return[1-e,1-t,i,s];case 270:return[t,1-e,i*(n/a),s*(a/n)];default:return[e,t,i,s]}}#u(e){if([this.x,this.y,this.width,this.height]=this.#p(e),this.div){this.fixAndSetPosition();const[t,i]=this.parentDimensions;this.setDims(this.width*t,this.height*i)}this._onResized()}#m(){const{x:e,y:t,width:i,height:s,rotation:n,parentRotation:a,parentDimensions:[o,l]}=this;switch((n*4+a)/90){case 1:return[1-t-s,e,s,i];case 2:return[1-e-i,1-t-s,i,s];case 3:return[t,1-e-i,s,i];case 4:return[e,t-i*(o/l),s*(l/o),i*(o/l)];case 5:return[1-t,e,i*(o/l),s*(l/o)];case 6:return[1-e-s*(l/o),1-t,s*(l/o),i*(o/l)];case 7:return[t-i*(o/l),1-e-s*(l/o),i*(o/l),s*(l/o)];case 8:return[e-i,t-s,i,s];case 9:return[1-t,e-i,s,i];case 10:return[1-e,1-t,i,s];case 11:return[t-s,1-e,s,i];case 12:return[e-s*(l/o),t,s*(l/o),i*(o/l)];case 13:return[1-t-i*(o/l),e-s*(l/o),i*(o/l),s*(l/o)];case 14:return[1-e,1-t-i*(o/l),s*(l/o),i*(o/l)];case 15:return[t,1-e,i*(o/l),s*(l/o)];default:return[e,t,i,s]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,H._mergeSVGProperties({bbox:this.#m()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#u(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const i=super.render();i.classList.add("draw");const s=document.createElement("div");i.append(s),s.setAttribute("aria-hidden","true"),s.className="internal";const[n,a]=this.parentDimensions;return this.setDims(this.width*n,this.height*a),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),i}static createDrawerInstance(e,t,i,s,n){se("Not implemented")}static startDrawing(e,t,i,s){const{target:n,offsetX:a,offsetY:o,pointerId:l,pointerType:u}=s;if(H.#o&&H.#o!==u)return;const{viewport:{rotation:c}}=e,{width:h,height:d}=n.getBoundingClientRect(),f=H.#s=new AbortController,p=e.combinedSignal(f);if(H.#n||=l,H.#o??=u,window.addEventListener("pointerup",g=>{H.#n===g.pointerId?this._endDraw(g):H.#a?.delete(g.pointerId)},{signal:p}),window.addEventListener("pointercancel",g=>{H.#n===g.pointerId?this._currentParent.endDrawingSession():H.#a?.delete(g.pointerId)},{signal:p}),window.addEventListener("pointerdown",g=>{H.#o===g.pointerType&&((H.#a||=new Set).add(g.pointerId),H.#i.isCancellable()&&(H.#i.removeLastElement(),H.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Ke,{signal:p}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:p}),n.addEventListener("touchmove",g=>{g.timeStamp===H.#h&&ye(g)},{signal:p}),e.toggleDrawing(),t._editorUndoBar?.hide(),H.#i){e.drawLayer.updateProperties(this._currentDrawId,H.#i.startNew(a,o,h,d,c));return}t.updateUIForDefaultProperties(this),H.#i=this.createDrawerInstance(a,o,h,d,c),H.#r=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(H.#r.toSVGProperties(),H.#i.defaultSVGProperties),!0,!1)}static _drawMove(e){if(H.#h=-1,!H.#i)return;const{offsetX:t,offsetY:i,pointerId:s}=e;if(H.#n===s){if(H.#a?.size>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,H.#i.add(t,i)),H.#h=e.timeStamp,ye(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,H.#i=null,H.#r=null,H.#o=null,H.#h=NaN),H.#s&&(H.#s.abort(),H.#s=null,H.#n=NaN,H.#a=null)}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,H.#i.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const i=H.#i,s=this._currentDrawId,n=i.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(s,i.setLastElement(n))},undo:()=>{t.drawLayer.updateProperties(s,i.removeLastElement())},mustExec:!1,type:X.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(X.DRAW_STEP),!H.#i.isEmpty()){const{pageDimensions:[i,s],scale:n}=t,a=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:H.#i.getOutlines(i*n,s*n,n,this._INNER_MARGIN),drawingOptions:H.#r,mustBeCommitted:!e});return this._cleanup(!0),a}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,i,s,n,a){se("Not implemented")}static async deserialize(e,t,i){const{rawDims:{pageWidth:s,pageHeight:n,pageX:a,pageY:o}}=t.viewport,l=this.deserializeDraw(a,o,s,n,this._INNER_MARGIN,e),u=await super.deserialize(e,t,i);return u.createDrawingOptions(e),u.#l({drawOutlines:l}),u.#f(),u.onScaleChanging(),u.rotate(),u}serializeDraw(e){const[t,i]=this.pageTranslation,[s,n]=this.pageDimensions;return this.#e.serialize([t,i,s,n],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}}class th{#e=new Float64Array(6);#t;#i;#s;#r;#n;#o="";#a=0;#h=new Ii;#l;#d;constructor(e,t,i,s,n,a){this.#l=i,this.#d=s,this.#s=n,this.#r=a,[e,t]=this.#c(e,t);const o=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#n=[e,t],this.#i=[{line:o,points:this.#n}],this.#e.set(o,0)}updateProperty(e,t){e==="stroke-width"&&(this.#r=t)}#c(e,t){return F._normalizePoint(e,t,this.#l,this.#d,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#n.length<=10}add(e,t){[e,t]=this.#c(e,t);const[i,s,n,a]=this.#e.subarray(2,6),o=e-n,l=t-a;return Math.hypot(this.#l*o,this.#d*l)<=2?null:(this.#n.push(e,t),isNaN(i)?(this.#e.set([n,a,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([i,s,n,a,e,t],0),this.#t.push(...F.createBezierPoints(i,s,n,a,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const i=this.add(e,t);return i||(this.#n.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,s,n){this.#l=i,this.#d=s,this.#s=n,[e,t]=this.#c(e,t);const a=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#n=[e,t];const o=this.#i.at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),this.#i.push({line:a,points:this.#n}),this.#e.set(a,0),this.#a=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(e){return this.#i?(this.#i.push(e),this.#t=e.line,this.#n=e.points,this.#a=0,{path:{d:this.toSVGPath()}}):this.#h.setLastElement(e)}removeLastElement(){if(!this.#i)return this.#h.removeLastElement();this.#i.pop(),this.#o="";for(let e=0,t=this.#i.length;e<t;e++){const{line:i,points:s}=this.#i[e];this.#t=i,this.#n=s,this.#a=0,this.toSVGPath()}return{path:{d:this.#o}}}toSVGPath(){const e=F.svgRound(this.#t[4]),t=F.svgRound(this.#t[5]);if(this.#n.length===2)return this.#o=`${this.#o} M ${e} ${t} Z`,this.#o;if(this.#n.length<=6){const s=this.#o.lastIndexOf("M");this.#o=`${this.#o.slice(0,s)} M ${e} ${t}`,this.#a=6}if(this.#n.length===4){const s=F.svgRound(this.#t[10]),n=F.svgRound(this.#t[11]);return this.#o=`${this.#o} L ${s} ${n}`,this.#a=12,this.#o}const i=[];this.#a===0&&(i.push(`M ${e} ${t}`),this.#a=6);for(let s=this.#a,n=this.#t.length;s<n;s+=6){const[a,o,l,u,c,h]=this.#t.slice(s,s+6).map(F.svgRound);i.push(`C${a} ${o} ${l} ${u} ${c} ${h}`)}return this.#o+=i.join(" "),this.#a=this.#t.length,this.#o}getOutlines(e,t,i,s){const n=this.#i.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#h.build(this.#i,e,t,i,this.#s,this.#r,s),this.#e=null,this.#t=null,this.#i=null,this.#o=null,this.#h}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Ii extends F{#e;#t=0;#i;#s;#r;#n;#o;#a;#h;build(e,t,i,s,n,a,o){this.#r=t,this.#n=i,this.#o=s,this.#a=n,this.#h=a,this.#i=o??0,this.#s=e,this.#c()}get thickness(){return this.#h}setLastElement(e){return this.#s.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#s){if(e.push(`M${F.svgRound(t[4])} ${F.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${F.svgRound(t[10])} ${F.svgRound(t[11])}`);continue}for(let i=6,s=t.length;i<s;i+=6){const[n,a,o,l,u,c]=t.subarray(i,i+6).map(F.svgRound);e.push(`C${n} ${a} ${o} ${l} ${u} ${c}`)}}return e.join("")}serialize([e,t,i,s],n){const a=[],o=[],[l,u,c,h]=this.#d();let d,f,p,g,m,y,v,A,w;switch(this.#a){case 0:w=F._rescale,d=e,f=t+s,p=i,g=-s,m=e+l*i,y=t+(1-u-h)*s,v=e+(l+c)*i,A=t+(1-u)*s;break;case 90:w=F._rescaleAndSwap,d=e,f=t,p=i,g=s,m=e+u*i,y=t+l*s,v=e+(u+h)*i,A=t+(l+c)*s;break;case 180:w=F._rescale,d=e+i,f=t,p=-i,g=s,m=e+(1-l-c)*i,y=t+u*s,v=e+(1-l)*i,A=t+(u+h)*s;break;case 270:w=F._rescaleAndSwap,d=e+i,f=t+s,p=-i,g=-s,m=e+(1-u-h)*i,y=t+(1-l-c)*s,v=e+(1-u)*i,A=t+(1-l)*s;break}for(const{line:S,points:E}of this.#s)a.push(w(S,d,f,p,g,n?new Array(S.length):null)),o.push(w(E,d,f,p,g,n?new Array(E.length):null));return{lines:a,points:o,rect:[m,y,v,A]}}static deserialize(e,t,i,s,n,{paths:{lines:a,points:o},rotation:l,thickness:u}){const c=[];let h,d,f,p,g;switch(l){case 0:g=F._rescale,h=-e/i,d=t/s+1,f=1/i,p=-1/s;break;case 90:g=F._rescaleAndSwap,h=-t/s,d=-e/i,f=1/s,p=1/i;break;case 180:g=F._rescale,h=e/i+1,d=-t/s,f=-1/i,p=1/s;break;case 270:g=F._rescaleAndSwap,h=t/s+1,d=e/i+1,f=-1/s,p=-1/i;break}if(!a){a=[];for(const y of o){const v=y.length;if(v===2){a.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1]]));continue}if(v===4){a.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1],NaN,NaN,NaN,NaN,y[2],y[3]]));continue}const A=new Float32Array(3*(v-2));a.push(A);let[w,S,E,x]=y.subarray(0,4);A.set([NaN,NaN,NaN,NaN,w,S],0);for(let _=4;_<v;_+=2){const C=y[_],T=y[_+1];A.set(F.createBezierPoints(w,S,E,x,C,T),(_-2)*3),[w,S,E,x]=[E,x,C,T]}}}for(let y=0,v=a.length;y<v;y++)c.push({line:g(a[y].map(A=>A??NaN),h,d,f,p),points:g(o[y].map(A=>A??NaN),h,d,f,p)});const m=new this.prototype.constructor;return m.build(c,i,s,1,l,u,n),m}#l(e=this.#h){const t=this.#i+e/2*this.#o;return this.#a%180===0?[t/this.#r,t/this.#n]:[t/this.#n,t/this.#r]}#d(){const[e,t,i,s]=this.#e,[n,a]=this.#l(0);return[e+n,t+a,i-2*n,s-2*a]}#c(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:s}of this.#s){if(s.length<=12){for(let o=4,l=s.length;o<l;o+=6)N.pointBoundingBox(s[o],s[o+1],e);continue}let n=s[4],a=s[5];for(let o=6,l=s.length;o<l;o+=6){const[u,c,h,d,f,p]=s.subarray(o,o+6);N.bezierBoundingBox(n,a,u,c,h,d,f,p,e),n=f,a=p}}const[t,i]=this.#l();e[0]=ke(e[0]-t,0,1),e[1]=ke(e[1]-i,0,1),e[2]=ke(e[2]+t,0,1),e[3]=ke(e[3]+i,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,i]=this.#l();this.#h=e;const[s,n]=this.#l(),[a,o]=[s-t,n-i],l=this.#e;return l[0]-=a,l[1]-=o,l[2]+=2*a,l[3]+=2*o,l}updateParentDimensions([e,t],i){const[s,n]=this.#l();this.#r=e,this.#n=t,this.#o=i;const[a,o]=this.#l(),l=a-s,u=o-n,c=this.#e;return c[0]-=l,c[1]-=u,c[2]+=2*l,c[3]+=2*u,c}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(F.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let i=0,s=0,n=0,a=0,o=0,l=0;switch(this.#t){case 90:s=t/e,n=-e/t,o=e;break;case 180:i=-1,a=-1,o=e,l=t;break;case 270:s=-t/e,n=e/t,l=t;break;default:return""}return`matrix(${i} ${s} ${n} ${a} ${F.svgRound(o)} ${F.svgRound(l)})`}getPathResizingSVGProperties([e,t,i,s]){const[n,a]=this.#l(),[o,l,u,c]=this.#e;if(Math.abs(u-n)<=F.PRECISION||Math.abs(c-a)<=F.PRECISION){const g=e+i/2-(o+u/2),m=t+s/2-(l+c/2);return{path:{"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`,transform:`${this.rotationTransform} translate(${g} ${m})`}}}const h=(i-2*n)/(u-2*n),d=(s-2*a)/(c-2*a),f=u/i,p=c/s;return{path:{"transform-origin":`${F.svgRound(o)} ${F.svgRound(l)}`,transform:`${this.rotationTransform} scale(${f} ${p}) translate(${F.svgRound(n)} ${F.svgRound(a)}) scale(${h} ${d}) translate(${F.svgRound(-n)} ${F.svgRound(-a)})`}}}getPathResizedSVGProperties([e,t,i,s]){const[n,a]=this.#l(),o=this.#e,[l,u,c,h]=o;if(o[0]=e,o[1]=t,o[2]=i,o[3]=s,Math.abs(c-n)<=F.PRECISION||Math.abs(h-a)<=F.PRECISION){const m=e+i/2-(l+c/2),y=t+s/2-(u+h/2);for(const{line:v,points:A}of this.#s)F._translate(v,m,y,v),F._translate(A,m,y,A);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const d=(i-2*n)/(c-2*n),f=(s-2*a)/(h-2*a),p=-d*(l+n)+e+n,g=-f*(u+a)+t+a;if(d!==1||f!==1||p!==0||g!==0)for(const{line:m,points:y}of this.#s)F._rescale(m,p,g,d,f,m),F._rescale(y,p,g,d,f,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],i){const[s,n]=i,a=this.#e,o=e-a[0],l=t-a[1];if(this.#r===s&&this.#n===n)for(const{line:u,points:c}of this.#s)F._translate(u,o,l,u),F._translate(c,o,l,c);else{const u=this.#r/s,c=this.#n/n;this.#r=s,this.#n=n;for(const{line:h,points:d}of this.#s)F._rescale(h,o,l,u,c,h),F._rescale(d,o,l,u,c,d);a[2]*=u,a[3]*=c}return a[0]=e,a[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${F.svgRound(e)} ${F.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${F.svgRound(e[0])} ${F.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class ls extends Ia{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:V._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new ls(this._viewParameters);return e.updateAll(this),e}}class En extends H{static _type="ink";static _editorType=U.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){V.initialize(e,t),this._defaultDrawingOptions=new ls(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return q(this,"typesMap",new Map([[X.INK_THICKNESS,"stroke-width"],[X.INK_COLOR,"stroke"],[X.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,i,s,n){return new th(e,t,i,s,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,i,s,n,a){return Ii.deserialize(e,t,i,s,n,a)}static async deserialize(e,t,i){let s=null;if(e instanceof An){const{data:{inkLists:a,rect:o,rotation:l,id:u,color:c,opacity:h,borderStyle:{rawWidth:d},popupRef:f},parent:{page:{pageNumber:p}}}=e;s=e={annotationType:U.INK,color:Array.from(c),thickness:d,opacity:h,paths:{points:a},boxes:null,pageIndex:p-1,rect:o.slice(0),rotation:l,annotationElementId:u,id:u,deleted:!1,popupRef:f}}const n=await super.deserialize(e,t,i);return n._initialData=s,n}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:i}=this;t.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:i}){this._drawingOptions=En.getDefaultDrawingOptions({stroke:N.makeHexColor(...e),"stroke-width":t,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:i,rect:s}=this.serializeDraw(e),{_drawingOptions:{stroke:n,"stroke-opacity":a,"stroke-width":o}}=this,l={annotationType:U.INK,color:V._colorManager.convert(n),opacity:a,thickness:o,paths:{lines:t,points:i},pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(l.isCopy=!0,l):this.annotationElementId&&!this.#e(l)?null:(l.id=this.annotationElementId,l)}#e(e){const{color:t,thickness:i,opacity:s,pageIndex:n}=this._initialData;return this._hasBeenMoved||this._hasBeenResized||e.color.some((a,o)=>a!==t[o])||e.thickness!==i||e.opacity!==s||e.pageIndex!==n}renderAnnotationElement(e){const{points:t,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:t}),null}}class Ks extends Ii{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Ui=8,ai=3;class xt{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,i,s){return i-=e,s-=t,i===0?s>0?0:4:i===1?s+6:2-s}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#s(e,t,i,s,n,a,o){const l=this.#t(i,s,n,a);for(let u=0;u<8;u++){const c=(-u+l-o+16)%8,h=this.#i[2*c],d=this.#i[2*c+1];if(e[(i+h)*t+(s+d)]!==0)return c}return-1}static#r(e,t,i,s,n,a,o){const l=this.#t(i,s,n,a);for(let u=0;u<8;u++){const c=(u+l+o+16)%8,h=this.#i[2*c],d=this.#i[2*c+1];if(e[(i+h)*t+(s+d)]!==0)return c}return-1}static#n(e,t,i,s){const n=e.length,a=new Int32Array(n);for(let c=0;c<n;c++)a[c]=e[c]<=s?1:0;for(let c=1;c<i-1;c++)a[c*t]=a[c*t+t-1]=0;for(let c=0;c<t;c++)a[c]=a[t*i-1-c]=0;let o=1,l;const u=[];for(let c=1;c<i-1;c++){l=1;for(let h=1;h<t-1;h++){const d=c*t+h,f=a[d];if(f===0)continue;let p=c,g=h;if(f===1&&a[d-1]===0)o+=1,g-=1;else if(f>=1&&a[d+1]===0)o+=1,g+=1,f>1&&(l=f);else{f!==1&&(l=Math.abs(f));continue}const m=[h,c],y=g===h+1,v={isHole:y,points:m,id:o,parent:0};u.push(v);let A;for(const D of u)if(D.id===l){A=D;break}A?A.isHole?v.parent=y?A.parent:l:v.parent=y?l:A.parent:v.parent=y?l:0;const w=this.#s(a,t,c,h,p,g,0);if(w===-1){a[d]=-o,a[d]!==1&&(l=Math.abs(a[d]));continue}let S=this.#i[2*w],E=this.#i[2*w+1];const x=c+S,_=h+E;p=x,g=_;let C=c,T=h;for(;;){const D=this.#r(a,t,C,T,p,g,1);S=this.#i[2*D],E=this.#i[2*D+1];const B=C+S,k=T+E;m.push(k,B);const R=C*t+T;if(a[R+1]===0?a[R]=-o:a[R]===1&&(a[R]=o),B===c&&k===h&&C===x&&T===_){a[d]!==1&&(l=Math.abs(a[d]));break}else p=C,g=T,C=B,T=k}}}return u}static#o(e,t,i,s){if(i-t<=4){for(let x=t;x<i-2;x+=2)s.push(e[x],e[x+1]);return}const n=e[t],a=e[t+1],o=e[i-4]-n,l=e[i-3]-a,u=Math.hypot(o,l),c=o/u,h=l/u,d=c*a-h*n,f=l/o,p=1/u,g=Math.atan(f),m=Math.cos(g),y=Math.sin(g),v=p*(Math.abs(m)+Math.abs(y)),A=p*(1-v+v**2),w=Math.max(Math.atan(Math.abs(y+m)*A),Math.atan(Math.abs(y-m)*A));let S=0,E=t;for(let x=t+2;x<i-2;x+=2){const _=Math.abs(d-c*e[x+1]+h*e[x]);_>S&&(E=x,S=_)}S>(u*w)**2?(this.#o(e,t,E+2,s),this.#o(e,E,i,s)):s.push(n,a)}static#a(e){const t=[],i=e.length;return this.#o(e,0,i,t),t.push(e[i-2],e[i-1]),t.length<=4?null:t}static#h(e,t,i,s,n,a){const o=new Float32Array(a**2),l=-2*s**2,u=a>>1;for(let g=0;g<a;g++){const m=(g-u)**2;for(let y=0;y<a;y++)o[g*a+y]=Math.exp((m+(y-u)**2)/l)}const c=new Float32Array(256),h=-2*n**2;for(let g=0;g<256;g++)c[g]=Math.exp(g**2/h);const d=e.length,f=new Uint8Array(d),p=new Uint32Array(256);for(let g=0;g<i;g++)for(let m=0;m<t;m++){const y=g*t+m,v=e[y];let A=0,w=0;for(let E=0;E<a;E++){const x=g+E-u;if(!(x<0||x>=i))for(let _=0;_<a;_++){const C=m+_-u;if(C<0||C>=t)continue;const T=e[x*t+C],D=o[E*a+_]*c[Math.abs(T-v)];A+=T*D,w+=D}}const S=f[y]=Math.round(A/w);p[S]++}return[f,p]}static#l(e){const t=new Uint32Array(256);for(const i of e)t[i]++;return t}static#d(e){const t=e.length,i=new Uint8ClampedArray(t>>2);let s=-1/0,n=1/0;for(let o=0,l=i.length;o<l;o++){if(e[(o<<2)+3]===0){s=i[o]=255;continue}const c=i[o]=e[o<<2];c>s&&(s=c),c<n&&(n=c)}const a=255/(s-n);for(let o=0;o<t;o++)i[o]=(i[o]-n)*a;return i}static#c(e){let t,i=-1/0,s=-1/0;const n=e.findIndex(l=>l!==0);let a=n,o=n;for(t=n;t<256;t++){const l=e[t];l>i&&(t-a>s&&(s=t-a,o=t-1),i=l,a=t)}for(t=o-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#f(e){const t=e,{width:i,height:s}=e,{maxDim:n}=this.#e;let a=i,o=s;if(i>n||s>n){let d=i,f=s,p=Math.log2(Math.max(i,s)/n);const g=Math.floor(p);p=p===g?g-1:g;for(let y=0;y<p;y++){a=Math.ceil(d/2),o=Math.ceil(f/2);const v=new OffscreenCanvas(a,o);v.getContext("2d").drawImage(e,0,0,d,f,0,0,a,o),d=a,f=o,e!==t&&e.close(),e=v.transferToImageBitmap()}const m=Math.min(n/a,n/o);a=Math.round(a*m),o=Math.round(o*m)}const u=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});u.filter="grayscale(1)",u.drawImage(e,0,0,e.width,e.height,0,0,a,o);const c=u.getImageData(0,0,a,o).data;return[this.#d(c),a,o]}static extractContoursFromText(e,{fontFamily:t,fontStyle:i,fontWeight:s},n,a,o,l){let u=new OffscreenCanvas(1,1),c=u.getContext("2d",{alpha:!1});const h=200,d=c.font=`${i} ${s} ${h}px ${t}`,{actualBoundingBoxLeft:f,actualBoundingBoxRight:p,actualBoundingBoxAscent:g,actualBoundingBoxDescent:m,fontBoundingBoxAscent:y,fontBoundingBoxDescent:v,width:A}=c.measureText(e),w=1.5,S=Math.ceil(Math.max(Math.abs(f)+Math.abs(p)||0,A)*w),E=Math.ceil(Math.max(Math.abs(g)+Math.abs(m)||h,Math.abs(y)+Math.abs(v)||h)*w);u=new OffscreenCanvas(S,E),c=u.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=d,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,S,E),c.fillStyle="black",c.fillText(e,S*(w-1)/2,E*(3-w)/2);const x=this.#d(c.getImageData(0,0,S,E).data),_=this.#l(x),C=this.#c(_),T=this.#n(x,S,E,C);return this.processDrawnLines({lines:{curves:T,width:S,height:E},pageWidth:n,pageHeight:a,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,i,s,n){const[a,o,l]=this.#f(e),[u,c]=this.#h(a,o,l,Math.hypot(o,l)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),h=this.#c(c),d=this.#n(u,o,l,h);return this.processDrawnLines({lines:{curves:d,width:o,height:l},pageWidth:t,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:i,rotation:s,innerMargin:n,mustSmooth:a,areContours:o}){s%180!==0&&([t,i]=[i,t]);const{curves:l,width:u,height:c}=e,h=e.thickness??0,d=[],f=Math.min(t/u,i/c),p=f/t,g=f/i,m=[];for(const{points:v}of l){const A=a?this.#a(v):v;if(!A)continue;m.push(A);const w=A.length,S=new Float32Array(w),E=new Float32Array(3*(w===2?2:w-2));if(d.push({line:E,points:S}),w===2){S[0]=A[0]*p,S[1]=A[1]*g,E.set([NaN,NaN,NaN,NaN,S[0],S[1]],0);continue}let[x,_,C,T]=A;x*=p,_*=g,C*=p,T*=g,S.set([x,_,C,T],0),E.set([NaN,NaN,NaN,NaN,x,_],0);for(let D=4;D<w;D+=2){const B=S[D]=A[D]*p,k=S[D+1]=A[D+1]*g;E.set(F.createBezierPoints(x,_,C,T,B,k),(D-2)*3),[x,_,C,T]=[C,T,B,k]}}if(d.length===0)return null;const y=o?new Ks:new Ii;return y.build(d,t,i,1,s,o?0:h,n),{outline:y,newCurves:m,areContours:o,thickness:h,width:u,height:c}}static async compressSignature({outlines:e,areContours:t,thickness:i,width:s,height:n}){let a=1/0,o=-1/0,l=0;for(const A of e){l+=A.length;for(let w=2,S=A.length;w<S;w++){const E=A[w]-A[w-2];a=Math.min(a,E),o=Math.max(o,E)}}let u;a>=-128&&o<=127?u=Int8Array:a>=-32768&&o<=32767?u=Int16Array:u=Int32Array;const c=e.length,h=Ui+ai*c,d=new Uint32Array(h);let f=0;d[f++]=h*Uint32Array.BYTES_PER_ELEMENT+(l-2*c)*u.BYTES_PER_ELEMENT,d[f++]=0,d[f++]=s,d[f++]=n,d[f++]=t?0:1,d[f++]=Math.max(0,Math.floor(i??0)),d[f++]=c,d[f++]=u.BYTES_PER_ELEMENT;for(const A of e)d[f++]=A.length-2,d[f++]=A[0],d[f++]=A[1];const p=new CompressionStream("deflate-raw"),g=p.writable.getWriter();await g.ready,g.write(d);const m=u.prototype.constructor;for(const A of e){const w=new m(A.length-2);for(let S=2,E=A.length;S<E;S++)w[S-2]=A[S]-A[S-2];g.write(w)}g.close();const y=await new Response(p.readable).arrayBuffer(),v=new Uint8Array(y);return ta(v)}static async decompressSignature(e){try{const t=Du(e),{readable:i,writable:s}=new DecompressionStream("deflate-raw"),n=s.getWriter();await n.ready,n.write(t).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let a=null,o=0;for await(const A of i)a||=new Uint8Array(new Uint32Array(A.buffer,0,4)[0]),a.set(A,o),o+=A.length;const l=new Uint32Array(a.buffer,0,a.length>>2),u=l[1];if(u!==0)throw new Error(`Invalid version: ${u}`);const c=l[2],h=l[3],d=l[4]===0,f=l[5],p=l[6],g=l[7],m=[],y=(Ui+ai*p)*Uint32Array.BYTES_PER_ELEMENT;let v;switch(g){case Int8Array.BYTES_PER_ELEMENT:v=new Int8Array(a.buffer,y);break;case Int16Array.BYTES_PER_ELEMENT:v=new Int16Array(a.buffer,y);break;case Int32Array.BYTES_PER_ELEMENT:v=new Int32Array(a.buffer,y);break}o=0;for(let A=0;A<p;A++){const w=l[ai*A+Ui],S=new Float32Array(w+2);m.push(S);for(let E=0;E<ai-1;E++)S[E]=l[ai*A+Ui+E+1];for(let E=0;E<w;E++)S[E+2]=S[E]+v[o++]}return{areContours:d,thickness:f,outlines:m,width:c,height:h}}catch(t){return z(`decompressSignature: ${t}`),null}}}class xn extends Ia{constructor(){super(),super.updateProperties({fill:V._defaultLineColor,"stroke-width":0})}clone(){const e=new xn;return e.updateAll(this),e}}class Cn extends ls{constructor(e){super(e),super.updateProperties({stroke:V._defaultLineColor,"stroke-width":1})}clone(){const e=new Cn(this._viewParameters);return e.updateAll(this),e}}class Ze extends H{#e=!1;#t=null;#i=null;#s=null;static _type="signature";static _editorType=U.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){V.initialize(e,t),this._defaultDrawingOptions=new xn,this._defaultDrawnSignatureOptions=new Cn(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return q(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:s,mustSmooth:n,areContours:a,description:o,uuid:l,heightInPage:u}=this.#i,{rawDims:{pageWidth:c,pageHeight:h},rotation:d}=this.parent.viewport,f=xt.processDrawnLines({lines:s,pageWidth:c,pageHeight:h,rotation:d,innerMargin:Ze._INNER_MARGIN,mustSmooth:n,areContours:a});this.addSignature(f,u,o,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);return i&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#s=e,this.addEditToolbar()}getUuid(){return this.#s}get description(){return this.#t}set description(e){this.#t=e,super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)})}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:i,width:s,height:n}=this.#i,a=Math.max(s,n),o=xt.processDrawnLines({lines:{curves:e.map(l=>({points:l})),thickness:i,width:s,height:n},pageWidth:a,pageHeight:a,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:o.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,i,s){const{x:n,y:a}=this,{outline:o}=this.#i=e;this.#e=o instanceof Ks,this.description=i,this.div.setAttribute("data-l10n-args",JSON.stringify({description:i}));let l;this.#e?l=Ze.getDefaultDrawingOptions():(l=Ze._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":o.thickness})),this._addOutlines({drawOutlines:o,drawingOptions:l});const[u,c]=this.parentDimensions,[,h]=this.pageDimensions;let d=t/h;d=d>=1?.5:d,this.width*=d/this.height,this.width>=1&&(d*=.9/this.width,this.width=.9),this.height=d,this.setDims(u*this.width,c*this.height),this.x=n,this.y=a,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(s),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!s,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:i},rotation:s}=this.parent.viewport;return xt.process(e,t,i,s,Ze._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:i,pageHeight:s},rotation:n}=this.parent.viewport;return xt.extractContoursFromText(e,t,i,s,n,Ze._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:i},rotation:s}=this.parent.viewport;return xt.processDrawnLines({lines:e,pageWidth:t,pageHeight:i,rotation:s,innerMargin:Ze._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=Ze.getDefaultDrawingOptions():(this._drawingOptions=Ze._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:i,rect:s}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":n}}=this,a={annotationType:U.SIGNATURE,isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:n,pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return e?(a.paths={lines:t,points:i},a.uuid=this.#s,a.isCopy=!0):a.lines=t,this.#t&&(a.accessibilityData={type:"Figure",alt:this.#t}),a}static deserializeDraw(e,t,i,s,n,a){return a.areContours?Ks.deserialize(e,t,i,s,n,a):Ii.deserialize(e,t,i,s,n,a)}static async deserialize(e,t,i){const s=await super.deserialize(e,t,i);return s.#e=e.areContours,s.#t=e.accessibilityData?.alt||"",s.#s=e.uuid,s}}class ih extends V{#e=null;#t=null;#i=null;#s=null;#r=null;#n="";#o=null;#a=!1;#h=null;#l=!1;#d=!1;static _type="stamp";static _editorType=U.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#s=e.bitmapUrl,this.#r=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){V.initialize(e,t)}static isHandlingMimeForPasting(e){return Ji.includes(e)}static paste(e,t){t.pasteEditor({mode:U.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#c(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#l=e.isSvg),e.file&&(this.#n=e.file.name),this.#g()}#f(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#o){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:s,width:n,height:a}=e||this.copyCanvas(null,null,!0).imageData,o=await i.guess({name:"altText",request:{data:s,width:n,height:a,channels:s.length/(n*a)}});if(!o)throw new Error("No response from the AI service.");if(o.error)throw new Error("Error from the AI service.");if(o.cancel)return null;if(!o.output)throw new Error("No valid response from the AI service.");const l=o.output;return await this.setGuessedAltText(l),t&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#p(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(i=>this.#c(i,!0)).finally(()=>this.#f());return}if(this.#s){const i=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(i).then(s=>this.#c(s)).finally(()=>this.#f());return}if(this.#r){const i=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(i).then(s=>this.#c(s)).finally(()=>this.#f());return}const e=document.createElement("input");e.type="file",e.accept=Ji.join(",");const t=this._uiManager._signal;this.#i=new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const s=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#c(s)}i()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:t})}).finally(()=>this.#f()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#o?.remove(),this.#o=null,this.#h&&(clearTimeout(this.#h),this.#h=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#p();return}super.rebuild(),this.div!==null&&(this.#t&&this.#o===null&&this.#p(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#i||this.#e||this.#s||this.#r||this.#t||this.#a)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#a||(this.#e?this.#g():this.#p()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:i,bitmap:s}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(this.#t=i,s&&(this.#e=s),this.#a=!1,this.#g())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#h!==null&&clearTimeout(this.#h);const e=200;this.#h=setTimeout(()=>{this.#h=null,this.#m()},e)}#g(){const{div:e}=this;let{width:t,height:i}=this.#e;const[s,n]=this.pageDimensions,a=.75;if(this.width)t=this.width*s,i=this.height*n;else if(t>a*s||i>a*n){const c=Math.min(a*s/t,a*n/i);t*=c,i*=c}const[o,l]=this.parentDimensions;this.setDims(t*o/s,i*l/n),this._uiManager.enableWaiting(!1);const u=this.#o=document.createElement("canvas");u.setAttribute("role","img"),this.addContainer(u),this.width=t/s,this.height=i/n,this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#m(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#n&&this.div.setAttribute("aria-description",this.#n),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,i=!1){e||(e=224);const{width:s,height:n}=this.#e,a=new ze;let o=this.#e,l=s,u=n,c=null;if(t){if(s>t||n>t){const E=Math.min(t/s,t/n);l=Math.floor(s*E),u=Math.floor(n*E)}c=document.createElement("canvas");const d=c.width=Math.ceil(l*a.sx),f=c.height=Math.ceil(u*a.sy);this.#l||(o=this.#u(d,f));const p=c.getContext("2d");p.filter=this._uiManager.hcmFilter;let g="white",m="#cfcfd8";this._uiManager.hcmFilter!=="none"?m="black":window.matchMedia?.("(prefers-color-scheme: dark)").matches&&(g="#8f8f9d",m="#42414d");const y=15,v=y*a.sx,A=y*a.sy,w=new OffscreenCanvas(v*2,A*2),S=w.getContext("2d");S.fillStyle=g,S.fillRect(0,0,v*2,A*2),S.fillStyle=m,S.fillRect(0,0,v,A),S.fillRect(v,A,v,A),p.fillStyle=p.createPattern(w,"repeat"),p.fillRect(0,0,d,f),p.drawImage(o,0,0,o.width,o.height,0,0,d,f)}let h=null;if(i){let d,f;if(a.symmetric&&o.width<e&&o.height<e)d=o.width,f=o.height;else if(o=this.#e,s>e||n>e){const m=Math.min(e/s,e/n);d=Math.floor(s*m),f=Math.floor(n*m),this.#l||(o=this.#u(d,f))}const g=new OffscreenCanvas(d,f).getContext("2d",{willReadFrequently:!0});g.drawImage(o,0,0,o.width,o.height,0,0,d,f),h={width:d,height:f,data:g.getImageData(0,0,d,f).data}}return{canvas:c,width:l,height:u,imageData:h}}#u(e,t){const{width:i,height:s}=this.#e;let n=i,a=s,o=this.#e;for(;n>2*e||a>2*t;){const l=n,u=a;n>2*e&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),a>2*t&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));const c=new OffscreenCanvas(n,a);c.getContext("2d").drawImage(o,0,0,l,u,0,0,n,a),o=c.transferToImageBitmap()}return o}#m(){const[e,t]=this.parentDimensions,{width:i,height:s}=this,n=new ze,a=Math.ceil(i*e*n.sx),o=Math.ceil(s*t*n.sy),l=this.#o;if(!l||l.width===a&&l.height===o)return;l.width=a,l.height=o;const u=this.#l?this.#e:this.#u(a,o),c=l.getContext("2d");c.filter=this._uiManager.hcmFilter,c.drawImage(u,0,0,u.width,u.height,0,0,a,o)}#y(e){if(e){if(this.#l){const s=this._uiManager.imageManager.getSvgUrl(this.#t);if(s)return s}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#l){const[t,i]=this.pageDimensions,s=Math.round(this.width*t*Dt.PDF_TO_CSS_UNITS),n=Math.round(this.height*i*Dt.PDF_TO_CSS_UNITS),a=new OffscreenCanvas(s,n);return a.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,s,n),a.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,i){let s=null,n=!1;if(e instanceof Pa){const{data:{rect:g,rotation:m,id:y,structParent:v,popupRef:A},container:w,parent:{page:{pageNumber:S}},canvas:E}=e;let x,_;E?(delete e.canvas,{id:x,bitmap:_}=i.imageManager.getFromCanvas(w.id,E),E.remove()):(n=!0,e._hasNoCanvas=!0);const C=(await t._structTree.getAriaAttributes(`${ln}${y}`))?.get("aria-label")||"";s=e={annotationType:U.STAMP,bitmapId:x,bitmap:_,pageIndex:S-1,rect:g.slice(0),rotation:m,annotationElementId:y,id:y,deleted:!1,accessibilityData:{decorative:!1,altText:C},isSvg:!1,structParent:v,popupRef:A}}const a=await super.deserialize(e,t,i),{rect:o,bitmap:l,bitmapUrl:u,bitmapId:c,isSvg:h,accessibilityData:d}=e;n?(i.addMissingCanvas(e.id,a),a.#a=!0):c&&i.imageManager.isValidId(c)?(a.#t=c,l&&(a.#e=l)):a.#s=u,a.#l=h;const[f,p]=a.pageDimensions;return a.width=(o[2]-o[0])/f,a.height=(o[3]-o[1])/p,d&&(a.altTextData=d),a._initialData=s,a.#d=!!s,a}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:U.STAMP,bitmapId:this.#t,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#l,structTreeParentId:this._structTreeParentId};if(e)return i.bitmapUrl=this.#y(!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:s,altText:n}=this.serializeAltText(!1);if(!s&&n&&(i.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){const o=this.#b(i);if(o.isSame)return null;o.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,t===null)return i;t.stamps||=new Map;const a=this.#l?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:a,serialized:i}),i.bitmap=this.#y(!1);else if(this.#l){const o=t.stamps.get(this.#t);a>o.area&&(o.area=a,o.serialized.bitmap.close(),o.serialized.bitmap=this.#y(!1))}return i}#b(e){const{pageIndex:t,accessibilityData:{altText:i}}=this._initialData,s=e.pageIndex===t,n=(e.accessibilityData?.alt||"")===i;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&s&&n,isSameAltText:n}}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}}class Qe{#e;#t=!1;#i=null;#s=null;#r=null;#n=new Map;#o=!1;#a=!1;#h=!1;#l=null;#d=null;#c=null;#f=null;#p=null;#g=-1;#u;static _initialized=!1;static#m=new Map([Se,En,ih,me,Ze].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:i,structTreeLayer:s,accessibilityManager:n,annotationLayer:a,drawLayer:o,textLayer:l,viewport:u,l10n:c}){const h=[...Qe.#m.values()];if(!Qe._initialized){Qe._initialized=!0;for(const d of h)d.initialize(c,e)}e.registerEditorTypes(h),this.#u=e,this.pageIndex=t,this.div=i,this.#e=n,this.#i=a,this.viewport=u,this.#c=l,this.drawLayer=o,this._structTree=s,this.#u.addLayer(this)}get isEmpty(){return this.#n.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===U.NONE}updateToolbar(e){this.#u.updateToolbar(e)}updateMode(e=this.#u.getMode()){switch(this.#S(),e){case U.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case U.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case U.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const i of Qe.#m.values())t.toggle(`${i._type}Editing`,e===i._editorType);this.div.hidden=!1}hasTextLayer(e){return e===this.#c?.div}setEditingState(e){this.#u.setEditingState(e)}addCommands(e){this.#u.addCommands(e)}cleanUndoStack(e){this.#u.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#i?.div.classList.toggle("disabled",!e)}async enable(){this.#h=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.#p?.abort(),this.#p=null;const e=new Set;for(const i of this.#n.values())i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#u.removeChangedExistingAnnotation(i),e.add(i.annotationElementId));if(!this.#i){this.#h=!1;return}const t=this.#i.getEditableAnnotations();for(const i of t){if(i.hide(),this.#u.isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const s=await this.deserialize(i);s&&(this.addOrRebuild(s),s.enableEditing())}this.#h=!1}disable(){if(this.#a=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.#c&&!this.#p){this.#p=new AbortController;const s=this.#u.combinedSignal(this.#p);this.#c.div.addEventListener("pointerdown",n=>{const{clientX:o,clientY:l,timeStamp:u}=n,c=this.#g;if(u-c>500){this.#g=u;return}this.#g=-1;const{classList:h}=this.div;h.toggle("getElements",!0);const d=document.elementsFromPoint(o,l);if(h.toggle("getElements",!1),!this.div.contains(d[0]))return;let f;const p=new RegExp(`^${Yr}[0-9]+$`);for(const m of d)if(p.test(m.id)){f=m.id;break}if(!f)return;const g=this.#n.get(f);g?.annotationElementId===null&&(n.stopPropagation(),n.preventDefault(),g.dblclick())},{signal:s,capture:!0})}const e=new Map,t=new Map;for(const s of this.#n.values())if(s.disableEditing(),!!s.annotationElementId){if(s.serialize()!==null){e.set(s.annotationElementId,s);continue}else t.set(s.annotationElementId,s);this.getEditableAnnotation(s.annotationElementId)?.show(),s.remove()}if(this.#i){const s=this.#i.getEditableAnnotations();for(const n of s){const{id:a}=n.data;if(this.#u.isDeletedAnnotationElement(a))continue;let o=t.get(a);if(o){o.resetAnnotationElement(n),o.show(!1),n.show();continue}o=e.get(a),o&&(this.#u.addChangedExistingAnnotation(o),o.renderAnnotationElement(n)&&o.show(!1)),n.show()}}this.#S(),this.isEmpty&&(this.div.hidden=!0);const{classList:i}=this.div;for(const s of Qe.#m.values())i.remove(`${s._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#a=!1}getEditableAnnotation(e){return this.#i?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#u.getActive()!==e&&this.#u.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#c?.div&&!this.#f){this.#f=new AbortController;const e=this.#u.combinedSignal(this.#f);this.#c.div.addEventListener("pointerdown",this.#y.bind(this),{signal:e}),this.#c.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#c?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#c.div.classList.remove("highlighting"))}#y(e){this.#u.unselectAll();const{target:t}=e;if(t===this.#c.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#c.div.contains(t)){const{isMac:i}=Ce.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#u.showAllEditors("highlight",!0,!0),this.#c.div.classList.add("free"),this.toggleDrawing(),me.startHighlighting(this,this.#u.direction==="ltr",{target:this.#c.div,x:e.x,y:e.y}),this.#c.div.addEventListener("pointerup",()=>{this.#c.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),e.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;const e=this.#u.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#s?.abort(),this.#s=null}attach(e){this.#n.set(e.id,e);const{annotationElementId:t}=e;t&&this.#u.isDeletedAnnotationElement(t)&&this.#u.removeDeletedAnnotationElement(e)}detach(e){this.#n.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#a&&e.annotationElementId&&this.#u.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#u.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#u.addDeletedAnnotationElement(e.annotationElementId),V.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#u.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#h),this.#u.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#r&&(e._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),i=()=>{e.remove()};this.addCommands({cmd:t,undo:i,mustExec:!1})}getNextId(){return this.#u.getId()}get#b(){return Qe.#m.get(this.#u.getMode())}combinedSignal(e){return this.#u.combinedSignal(e)}#w(e){const t=this.#b;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#b?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#u.updateMode(e.mode);const{offsetX:i,offsetY:s}=this.#A(),n=this.getNextId(),a=this.#w({parent:this,id:n,x:i,y:s,uiManager:this.#u,isCentered:!0,...t});a&&this.add(a)}async deserialize(e){return await Qe.#m.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#u)||null}createAndAddNewEditor(e,t,i={}){const s=this.getNextId(),n=this.#w({parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:this.#u,isCentered:t,...i});return n&&this.add(n),n}#A(){const{x:e,y:t,width:i,height:s}=this.div.getBoundingClientRect(),n=Math.max(0,e),a=Math.max(0,t),o=Math.min(window.innerWidth,e+i),l=Math.min(window.innerHeight,t+s),u=(n+o)/2-e,c=(a+l)/2-t,[h,d]=this.viewport.rotation%180===0?[u,c]:[c,u];return{offsetX:h,offsetY:d}}addNewEditor(e={}){this.createAndAddNewEditor(this.#A(),!0,e)}setSelected(e){this.#u.setSelected(e)}toggleSelected(e){this.#u.toggleSelected(e)}unselect(e){this.#u.unselect(e)}pointerup(e){const{isMac:t}=Ce.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#o||(this.#o=!1,this.#b?.isDrawer&&this.#b.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const i=this.#u.getMode();if(i===U.STAMP||i===U.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#u.getMode()===U.HIGHLIGHT&&this.enableTextSelection(),this.#o){this.#o=!1;return}const{isMac:t}=Ce.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#o=!0,this.#b?.isDrawer){this.startDrawingSession(e);return}const i=this.#u.getActive();this.#t=!i||i.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#l){this.#b.startDrawing(this,this.#u,!1,e);return}this.#u.setCurrentDrawingSession(this),this.#l=new AbortController;const t=this.#u.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#d=null,this.commitOrRemove())},{signal:t}),this.#b.startDrawing(this,this.#u,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#d=t);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(e=!1){return this.#l?(this.#u.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#d=null,this.#b.endDrawing(e)):null}findNewParent(e,t,i){const s=this.#u.findParent(t,i);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#b.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const e of this.#n.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#n.clear(),this.#u.removeLayer(this)}#S(){for(const e of this.#n.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,vt(this.div,e);for(const t of this.#u.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#u.commitOrRemove(),this.#S();const t=this.viewport.rotation,i=e.rotation;if(this.viewport=e,vt(this.div,{rotation:i}),t!==i)for(const s of this.#n.values())s.rotate(i)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#u.viewParameters.realScale}}class xe{#e=null;#t=new Map;#i=new Map;static#s=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return q(this,"_svgFactory",new wi)}static#r(e,[t,i,s,n]){const{style:a}=e;a.top=`${100*i}%`,a.left=`${100*t}%`,a.width=`${100*s}%`,a.height=`${100*n}%`}#n(){const e=xe._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#o(e,t){const i=xe._svgFactory.createElement("clipPath");e.append(i);const s=`clip_${t}`;i.setAttribute("id",s),i.setAttribute("clipPathUnits","objectBoundingBox");const n=xe._svgFactory.createElement("use");return i.append(n),n.setAttribute("href",`#${t}`),n.classList.add("clip"),s}#a(e,t){for(const[i,s]of Object.entries(t))s===null?e.removeAttribute(i):e.setAttribute(i,s)}draw(e,t=!1,i=!1){const s=xe.#s++,n=this.#n(),a=xe._svgFactory.createElement("defs");n.append(a);const o=xe._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${s}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#i.set(s,o);const u=i?this.#o(a,l):null,c=xe._svgFactory.createElement("use");return n.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(n,e),this.#t.set(s,n),{id:s,clipPathId:`url(#${u})`}}drawOutline(e,t){const i=xe.#s++,s=this.#n(),n=xe._svgFactory.createElement("defs");s.append(n);const a=xe._svgFactory.createElement("path");n.append(a);const o=`path_p${this.pageIndex}_${i}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const h=xe._svgFactory.createElement("mask");n.append(h),l=`mask_p${this.pageIndex}_${i}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");const d=xe._svgFactory.createElement("rect");h.append(d),d.setAttribute("width","1"),d.setAttribute("height","1"),d.setAttribute("fill","white");const f=xe._svgFactory.createElement("use");h.append(f),f.setAttribute("href",`#${o}`),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}const u=xe._svgFactory.createElement("use");s.append(u),u.setAttribute("href",`#${o}`),l&&u.setAttribute("mask",`url(#${l})`);const c=u.cloneNode();return s.append(c),u.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(s,e),this.#t.set(i,s),i}finalizeDraw(e,t){this.#i.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:i,bbox:s,rootClass:n,path:a}=t,o=typeof e=="number"?this.#t.get(e):e;if(o){if(i&&this.#a(o,i),s&&xe.#r(o,s),n){const{classList:l}=o;for(const[u,c]of Object.entries(n))l.toggle(u,c)}if(a){const u=o.firstChild.firstChild;this.#a(u,a)}}}updateParent(e,t){if(t===this)return;const i=this.#t.get(e);i&&(t.#e.append(i),this.#t.delete(e),t.#t.set(e,i))}remove(e){this.#i.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Vs};globalThis.pdfjsLib={AbortException:ht,AnnotationEditorLayer:Qe,AnnotationEditorParamsType:X,AnnotationEditorType:U,AnnotationEditorUIManager:dt,AnnotationLayer:Sn,AnnotationMode:tt,AnnotationType:ge,build:xa,ColorPicker:Ne,createValidAbsoluteUrl:rn,DOMSVGFactory:wi,DrawLayer:xe,FeatureTest:Ce,fetchData:Qt,getDocument:yn,getFilenameFromUrl:ia,getPdfFilenameFromUrl:sa,getUuid:on,getXfaPageViewport:na,GlobalWorkerOptions:Pt,ImageKind:fi,InvalidPDFException:Zi,isDataScheme:ki,isPdfFile:as,isValidExplicitDest:la,MathClamp:ke,noContextMenu:Ke,normalizeUnicode:ea,OPS:mi,OutputScale:ze,PasswordResponses:Jr,PDFDataRangeTransport:vn,PDFDateString:un,PDFWorker:Xt,PermissionFlag:Zr,PixelsPerInch:Dt,RenderingCancelledException:rs,ResponseException:yi,setLayerDimensions:vt,shadow:q,SignatureExtractor:xt,stopEvent:ye,SupportedImageMimeTypes:Ji,TextLayer:bi,TouchManager:Di,updateUrlHash:an,Util:N,VerbosityLevel:_i,version:Ea,XfaLayer:wn};const sh=Object.freeze(Object.defineProperty({__proto__:null,AbortException:ht,AnnotationEditorLayer:Qe,AnnotationEditorParamsType:X,AnnotationEditorType:U,AnnotationEditorUIManager:dt,AnnotationLayer:Sn,AnnotationMode:tt,AnnotationType:ge,ColorPicker:Ne,DOMSVGFactory:wi,DrawLayer:xe,FeatureTest:Ce,GlobalWorkerOptions:Pt,ImageKind:fi,InvalidPDFException:Zi,MathClamp:ke,OPS:mi,OutputScale:ze,PDFDataRangeTransport:vn,PDFDateString:un,PDFWorker:Xt,PasswordResponses:Jr,PermissionFlag:Zr,PixelsPerInch:Dt,RenderingCancelledException:rs,ResponseException:yi,SignatureExtractor:xt,SupportedImageMimeTypes:Ji,TextLayer:bi,TouchManager:Di,Util:N,VerbosityLevel:_i,XfaLayer:wn,build:xa,createValidAbsoluteUrl:rn,fetchData:Qt,getDocument:yn,getFilenameFromUrl:ia,getPdfFilenameFromUrl:sa,getUuid:on,getXfaPageViewport:na,isDataScheme:ki,isPdfFile:as,isValidExplicitDest:la,noContextMenu:Ke,normalizeUnicode:ea,setLayerDimensions:vt,shadow:q,stopEvent:ye,updateUrlHash:an,version:Ea},Symbol.toStringTag,{value:"Module"}));var rr=Object.prototype.hasOwnProperty;function ar(r,e,t){for(t of r.keys())if(zt(t,e))return t}function zt(r,e){var t,i,s;if(r===e)return!0;if(r&&e&&(t=r.constructor)===e.constructor){if(t===Date)return r.getTime()===e.getTime();if(t===RegExp)return r.toString()===e.toString();if(t===Array){if((i=r.length)===e.length)for(;i--&&zt(r[i],e[i]););return i===-1}if(t===Set){if(r.size!==e.size)return!1;for(i of r)if(s=i,s&&typeof s=="object"&&(s=ar(e,s),!s)||!e.has(s))return!1;return!0}if(t===Map){if(r.size!==e.size)return!1;for(i of r)if(s=i[0],s&&typeof s=="object"&&(s=ar(e,s),!s)||!zt(i[1],e.get(s)))return!1;return!0}if(t===ArrayBuffer)r=new Uint8Array(r),e=new Uint8Array(e);else if(t===DataView){if((i=r.byteLength)===e.byteLength)for(;i--&&r.getInt8(i)===e.getInt8(i););return i===-1}if(ArrayBuffer.isView(r)){if((i=r.byteLength)===e.byteLength)for(;i--&&r[i]===e[i];);return i===-1}if(!t||typeof r=="object"){i=0;for(t in r)if(rr.call(r,t)&&++i&&!rr.call(e,t)||!(t in e)||!zt(r[t],e[t]))return!1;return Object.keys(e).length===i}}return r!==r&&e!==e}function Li(r){let e=!1;return{promise:new Promise((i,s)=>{r.then(n=>!e&&i(n)).catch(n=>!e&&s(n))}),cancel(){e=!0}}}const nh=["onCopy","onCut","onPaste"],rh=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],ah=["onFocus","onBlur"],oh=["onInput","onInvalid","onReset","onSubmit"],lh=["onLoad","onError"],uh=["onKeyDown","onKeyPress","onKeyUp"],ch=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],hh=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],dh=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],fh=["onSelect"],ph=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],gh=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],mh=["onScroll"],yh=["onWheel"],bh=["onAnimationStart","onAnimationEnd","onAnimationIteration"],vh=["onTransitionEnd"],wh=["onToggle"],Ah=["onChange"],Sh=[...nh,...rh,...ah,...oh,...lh,...uh,...ch,...hh,...dh,...fh,...ph,...gh,...mh,...yh,...bh,...vh,...Ah,...wh];function La(r,e){const t={};for(const i of Sh){const s=r[i];s&&(e?t[i]=(n=>s(n,e(i))):t[i]=s)}return t}var Eh="Invariant failed";function re(r,e){if(!r)throw new Error(Eh)}var _s,or;function xh(){if(or)return _s;or=1;var r=function(){};return _s=r,_s}var Ch=xh();const Pe=zo(Ch),Fa=b.createContext(null),_h="noopener noreferrer nofollow";class Th{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return re(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){re(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}goToDestination(e){return new Promise(t=>{re(this.pdfDocument),re(e),typeof e=="string"?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(t=>{re(Array.isArray(t));const i=t[0];new Promise(s=>{re(this.pdfDocument),i instanceof Object?this.pdfDocument.getPageIndex(i).then(n=>{s(n)}).catch(()=>{re(!1)}):typeof i=="number"?s(i):re(!1)}).then(s=>{const n=s+1;re(this.pdfViewer),re(n>=1&&n<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:t,pageIndex:s,pageNumber:n})})})}navigateTo(e){this.goToDestination(e)}goToPage(e){const t=e-1;re(this.pdfViewer),re(e>=1&&e<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}addLinkAttributes(e,t,i){e.href=t,e.rel=this.externalLinkRel||_h,e.target=i?"_blank":this.externalLinkTarget||""}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}setHash(){}executeNamedAction(){}cachePageRef(){}isPageVisible(){return!0}isPageCached(){return!0}executeSetOCGState(){}}function Gt({children:r,type:e}){return fe.jsx("div",{className:`react-pdf__message react-pdf__message--${e}`,children:r})}const lr={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function Rh(r,e){switch(e.type){case"RESOLVE":return{value:e.value,error:void 0};case"REJECT":return{value:!1,error:e.error};case"RESET":return{value:void 0,error:void 0};default:return r}}function Yt(){return b.useReducer(Rh,{value:void 0,error:void 0})}const us=typeof window<"u",$a=us&&window.location.protocol==="file:";function kh(r){return typeof r<"u"}function wt(r){return kh(r)&&r!==null}function Ph(r){return typeof r=="string"}function Dh(r){return r instanceof ArrayBuffer}function Mh(r){return re(us),r instanceof Blob}function Us(r){return Ph(r)&&/^data:/.test(r)}function ur(r){re(Us(r));const[e="",t=""]=r.split(",");return e.split(";").indexOf("base64")!==-1?atob(t):unescape(t)}function Ih(){return us&&window.devicePixelRatio||1}const Oa="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function cr(){Pe(!$a,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${Oa}`)}function Lh(){Pe(!$a,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${Oa}`)}function It(r){r?.cancel&&r.cancel()}function js(r,e){return Object.defineProperty(r,"width",{get(){return this.view[2]*e},configurable:!0}),Object.defineProperty(r,"height",{get(){return this.view[3]*e},configurable:!0}),Object.defineProperty(r,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(r,"originalHeight",{get(){return this.view[3]},configurable:!0}),r}function Fh(r){return r.name==="RenderingCancelledException"}function $h(r){return new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{if(!i.result)return t(new Error("Error while reading a file."));e(i.result)},i.onerror=s=>{if(!s.target)return t(new Error("Error while reading a file."));const{error:n}=s.target;if(!n)return t(new Error("Error while reading a file."));switch(n.code){case n.NOT_FOUND_ERR:return t(new Error("Error while reading a file: File not found."));case n.SECURITY_ERR:return t(new Error("Error while reading a file: Security error."));case n.ABORT_ERR:return t(new Error("Error while reading a file: Aborted."));default:return t(new Error("Error while reading a file."))}},i.readAsArrayBuffer(r)})}const{PDFDataRangeTransport:Oh}=sh,Nh=(r,e)=>{switch(e){case lr.NEED_PASSWORD:{const t=prompt("Enter the password to open this PDF file.");r(t);break}case lr.INCORRECT_PASSWORD:{const t=prompt("Invalid password. Please try again.");r(t);break}}};function hr(r){return typeof r=="object"&&r!==null&&("data"in r||"range"in r||"url"in r)}const Fd=b.forwardRef(function({children:e,className:t,error:i="Failed to load PDF file.",externalLinkRel:s,externalLinkTarget:n,file:a,inputRef:o,imageResourcesPath:l,loading:u="Loading PDF…",noData:c="No PDF file specified.",onItemClick:h,onLoadError:d,onLoadProgress:f,onLoadSuccess:p,onPassword:g=Nh,onSourceError:m,onSourceSuccess:y,options:v,renderMode:A,rotate:w,scale:S,...E},x){const[_,C]=Yt(),{value:T,error:D}=_,[B,k]=Yt(),{value:R,error:$}=B,P=b.useRef(new Th),M=b.useRef([]),O=b.useRef(void 0),J=b.useRef(void 0);a&&a!==O.current&&hr(a)&&(Pe(!zt(a,O.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),O.current=a),v&&v!==J.current&&(Pe(!zt(v,J.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),J.current=v);const ee=b.useRef({scrollPageIntoView:G=>{const{dest:ie,pageNumber:de,pageIndex:ve=de-1}=G;if(h){h({dest:ie,pageIndex:ve,pageNumber:de});return}const pt=M.current[ve];if(pt){pt.scrollIntoView();return}Pe(!1,`An internal link leading to page ${de} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});b.useImperativeHandle(x,()=>({linkService:P,pages:M,viewer:ee}),[]);function L(){y&&y()}function K(){D&&(Pe(!1,D.toString()),m&&m(D))}function j(){C({type:"RESET"})}b.useEffect(j,[a,C]);const ne=b.useCallback(async()=>{if(!a)return null;if(typeof a=="string")return Us(a)?{data:ur(a)}:(cr(),{url:a});if(a instanceof Oh)return{range:a};if(Dh(a))return{data:a};if(us&&Mh(a))return{data:await $h(a)};if(re(typeof a=="object"),re(hr(a)),"url"in a&&typeof a.url=="string"){if(Us(a.url)){const{url:G,...ie}=a;return{data:ur(G),...ie}}cr()}return a},[a]);b.useEffect(()=>{const G=Li(ne());return G.promise.then(ie=>{C({type:"RESOLVE",value:ie})}).catch(ie=>{C({type:"REJECT",error:ie})}),()=>{It(G)}},[ne,C]),b.useEffect(()=>{if(!(typeof T>"u")){if(T===!1){K();return}L()}},[T]);function ue(){R&&(p&&p(R),M.current=new Array(R.numPages),P.current.setDocument(R))}function Q(){$&&(Pe(!1,$.toString()),d&&d($))}b.useEffect(function(){k({type:"RESET"})},[k,T]),b.useEffect(function(){if(!T)return;const ie=v?{...T,...v}:T,de=yn(ie);f&&(de.onProgress=f),g&&(de.onPassword=g);const ve=de,pt=ve.promise.then(nt=>{k({type:"RESOLVE",value:nt})}).catch(nt=>{ve.destroyed||k({type:"REJECT",error:nt})});return()=>{pt.finally(()=>ve.destroy())}},[v,k,T]),b.useEffect(()=>{if(!(typeof R>"u")){if(R===!1){Q();return}ue()}},[R]),b.useEffect(function(){P.current.setViewer(ee.current),P.current.setExternalLinkRel(s),P.current.setExternalLinkTarget(n)},[s,n]);const Z=b.useCallback((G,ie)=>{M.current[G]=ie},[]),_e=b.useCallback(G=>{delete M.current[G]},[]),Ee=b.useMemo(()=>({imageResourcesPath:l,linkService:P.current,onItemClick:h,pdf:R,registerPage:Z,renderMode:A,rotate:w,scale:S,unregisterPage:_e}),[l,h,R,Z,A,w,S,_e]),I=b.useMemo(()=>La(E,()=>R),[E,R]);function Y(){function G(de){return!!de?.pdf}if(!G(Ee))throw new Error("pdf is undefined");const ie=typeof e=="function"?e(Ee):e;return fe.jsx(Fa.Provider,{value:Ee,children:ie})}function te(){return a?R==null?fe.jsx(Gt,{type:"loading",children:typeof u=="function"?u():u}):R===!1?fe.jsx(Gt,{type:"error",children:typeof i=="function"?i():i}):Y():fe.jsx(Gt,{type:"no-data",children:typeof c=="function"?c():c})}return fe.jsx("div",{className:es("react-pdf__Document",t),ref:o,...I,children:te()})});function Na(){return b.useContext(Fa)}function Ba(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var t=r.filter(Boolean);if(t.length<=1){var i=t[0];return i||null}return function(n){for(var a=0,o=t;a<o.length;a++){var l=o[a];typeof l=="function"?l(n):l&&(l.current=n)}}}const Va=b.createContext(null);function cs(){return b.useContext(Va)}function Bh(){const r=Na(),e=cs();re(e);const t={...r,...e},{imageResourcesPath:i,linkService:s,onGetAnnotationsError:n,onGetAnnotationsSuccess:a,onRenderAnnotationLayerError:o,onRenderAnnotationLayerSuccess:l,page:u,pdf:c,renderForms:h,rotate:d,scale:f=1}=t;re(c),re(u),re(s);const[p,g]=Yt(),{value:m,error:y}=p,v=b.useRef(null);Pe(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function A(){m&&a&&a(m)}function w(){y&&(Pe(!1,y.toString()),n&&n(y))}b.useEffect(function(){g({type:"RESET"})},[g,u]),b.useEffect(function(){if(!u)return;const C=Li(u.getAnnotations()),T=C;return C.promise.then(D=>{g({type:"RESOLVE",value:D})}).catch(D=>{g({type:"REJECT",error:D})}),()=>{It(T)}},[g,u]),b.useEffect(()=>{if(m!==void 0){if(m===!1){w();return}A()}},[m]);function S(){l&&l()}function E(_){Pe(!1,`${_}`),o&&o(_)}const x=b.useMemo(()=>u.getViewport({scale:f,rotation:d}),[u,d,f]);return b.useEffect(function(){if(!c||!u||!s||!m)return;const{current:C}=v;if(!C)return;const T=x.clone({dontFlip:!0}),D={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,div:C,l10n:null,page:u,structTreeLayer:null,viewport:T},B={annotations:m,annotationStorage:c.annotationStorage,div:C,imageResourcesPath:i,linkService:s,page:u,renderForms:h,viewport:T};C.innerHTML="";try{new Sn(D).render(B),S()}catch(k){E(k)}return()=>{}},[m,i,s,u,c,h,x]),fe.jsx("div",{className:es("react-pdf__Page__annotations","annotationLayer"),ref:v})}const Ha={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},Vh=/^H(\d+)$/;function Hh(r){return r in Ha}function hs(r){return"children"in r}function Ka(r){return hs(r)?r.children.length===1&&0 in r.children&&"id"in r.children[0]:!1}function Kh(r){const e={};if(hs(r)){const{role:t}=r,i=t.match(Vh);if(i)e.role="heading",e["aria-level"]=Number(i[1]);else if(Hh(t)){const s=Ha[t];s&&(e.role=s)}}return e}function Ua(r){const e={};if(hs(r)){if(r.alt!==void 0&&(e["aria-label"]=r.alt),r.lang!==void 0&&(e.lang=r.lang),Ka(r)){const[t]=r.children;if(t){const i=Ua(t);return{...e,...i}}}}else"id"in r&&(e["aria-owns"]=r.id);return e}function Uh(r){return r?{...Kh(r),...Ua(r)}:null}function ja({className:r,node:e}){const t=b.useMemo(()=>Uh(e),[e]),i=b.useMemo(()=>!hs(e)||Ka(e)?null:e.children.map((s,n)=>fe.jsx(ja,{node:s},n)),[e]);return fe.jsx("span",{className:r,...t,children:i})}function jh(){const r=cs();re(r);const{onGetStructTreeError:e,onGetStructTreeSuccess:t}=r,[i,s]=Yt(),{value:n,error:a}=i,{customTextRenderer:o,page:l}=r;function u(){n&&t&&t(n)}function c(){a&&(Pe(!1,a.toString()),e&&e(a))}return b.useEffect(function(){s({type:"RESET"})},[s,l]),b.useEffect(function(){if(o||!l)return;const d=Li(l.getStructTree()),f=d;return d.promise.then(p=>{s({type:"RESOLVE",value:p})}).catch(p=>{s({type:"REJECT",error:p})}),()=>It(f)},[o,l,s]),b.useEffect(()=>{if(n!==void 0){if(n===!1){c();return}u()}},[n]),n?fe.jsx(ja,{className:"react-pdf__Page__structTree structTree",node:n}):null}const dr=tt;function zh(r){const e=cs();re(e);const t={...e,...r},{_className:i,canvasBackground:s,devicePixelRatio:n=Ih(),onRenderError:a,onRenderSuccess:o,page:l,renderForms:u,renderTextLayer:c,rotate:h,scale:d}=t,{canvasRef:f}=r;re(l);const p=b.useRef(null);function g(){l&&o&&o(js(l,d))}function m(w){Fh(w)||(Pe(!1,w.toString()),a&&a(w))}const y=b.useMemo(()=>l.getViewport({scale:d*n,rotation:h}),[n,l,h,d]),v=b.useMemo(()=>l.getViewport({scale:d,rotation:h}),[l,h,d]);b.useEffect(function(){if(!l)return;l.cleanup();const{current:S}=p;if(!S)return;S.width=y.width,S.height=y.height,S.style.width=`${Math.floor(v.width)}px`,S.style.height=`${Math.floor(v.height)}px`,S.style.visibility="hidden";const E={annotationMode:u?dr.ENABLE_FORMS:dr.ENABLE,canvasContext:S.getContext("2d",{alpha:!1}),viewport:y};s&&(E.background=s);const x=l.render(E),_=x;return x.promise.then(()=>{S.style.visibility="",g()}).catch(m),()=>It(_)},[s,l,u,y,v]);const A=b.useCallback(()=>{const{current:w}=p;w&&(w.width=0,w.height=0)},[]);return b.useEffect(()=>A,[A]),fe.jsx("canvas",{className:`${i}__canvas`,dir:"ltr",ref:Ba(f,p),style:{display:"block",userSelect:"none"},children:c?fe.jsx(jh,{}):null})}function Gh(r){return"str"in r}function Wh(){const r=cs();re(r);const{customTextRenderer:e,onGetTextError:t,onGetTextSuccess:i,onRenderTextLayerError:s,onRenderTextLayerSuccess:n,page:a,pageIndex:o,pageNumber:l,rotate:u,scale:c}=r;re(a);const[h,d]=Yt(),{value:f,error:p}=h,g=b.useRef(null);Pe(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function m(){f&&i&&i(f)}function y(){p&&(Pe(!1,p.toString()),t&&t(p))}b.useEffect(function(){d({type:"RESET"})},[a,d]),b.useEffect(function(){if(!a)return;const _=Li(a.getTextContent()),C=_;return _.promise.then(T=>{d({type:"RESOLVE",value:T})}).catch(T=>{d({type:"REJECT",error:T})}),()=>It(C)},[a,d]),b.useEffect(()=>{if(f!==void 0){if(f===!1){y();return}m()}},[f]);const v=b.useCallback(()=>{n&&n()},[n]),A=b.useCallback(x=>{Pe(!1,x.toString()),s&&s(x)},[s]);function w(){const x=g.current;x&&x.classList.add("selecting")}function S(){const x=g.current;x&&x.classList.remove("selecting")}const E=b.useMemo(()=>a.getViewport({scale:c,rotation:u}),[a,u,c]);return b.useLayoutEffect(function(){if(!a||!f)return;const{current:_}=g;if(!_)return;_.innerHTML="";const C=a.streamTextContent({includeMarkedContent:!0}),T={container:_,textContentSource:C,viewport:E},D=new bi(T),B=D;return D.render().then(()=>{const k=document.createElement("div");k.className="endOfContent",_.append(k);const R=_.querySelectorAll('[role="presentation"]');if(e){let $=0;f.items.forEach((P,M)=>{if(!Gh(P))return;const O=R[$];if(!O)return;const J=e({pageIndex:o,pageNumber:l,itemIndex:M,...P});O.innerHTML=J,$+=P.str&&P.hasEOL?2:1})}v()}).catch(A),()=>It(B)},[e,A,v,a,o,l,f,E]),fe.jsx("div",{className:es("react-pdf__Page__textContent","textLayer"),onMouseUp:S,onMouseDown:w,ref:g})}const fr=1;function $d(r){const t={...Na(),...r},{_className:i="react-pdf__Page",_enableRegisterUnregisterPage:s=!0,canvasBackground:n,canvasRef:a,children:o,className:l,customRenderer:u,customTextRenderer:c,devicePixelRatio:h,error:d="Failed to load the page.",height:f,inputRef:p,loading:g="Loading page…",noData:m="No page specified.",onGetAnnotationsError:y,onGetAnnotationsSuccess:v,onGetStructTreeError:A,onGetStructTreeSuccess:w,onGetTextError:S,onGetTextSuccess:E,onLoadError:x,onLoadSuccess:_,onRenderAnnotationLayerError:C,onRenderAnnotationLayerSuccess:T,onRenderError:D,onRenderSuccess:B,onRenderTextLayerError:k,onRenderTextLayerSuccess:R,pageIndex:$,pageNumber:P,pdf:M,registerPage:O,renderAnnotationLayer:J=!0,renderForms:ee=!1,renderMode:L="canvas",renderTextLayer:K=!0,rotate:j,scale:ne=fr,unregisterPage:ue,width:Q,...Z}=t,[_e,Ee]=Yt(),{value:I,error:Y}=_e,te=b.useRef(null);re(M);const G=wt(P)?P-1:$??null,ie=P??(wt($)?$+1:null),de=j??(I?I.rotate:null),ve=b.useMemo(()=>{if(!I)return null;let gt=1;const Nt=ne??fr;if(Q||f){const mt=I.getViewport({scale:1,rotation:de});Q?gt=Q/mt.width:f&&(gt=f/mt.height)}return Nt*gt},[f,I,de,ne,Q]);b.useEffect(function(){return()=>{wt(G)&&s&&ue&&ue(G)}},[s,M,G,ue]);function pt(){if(_){if(!I||!ve)return;_(js(I,ve))}if(s&&O){if(!wt(G)||!te.current)return;O(G,te.current)}}function nt(){Y&&(Pe(!1,Y.toString()),x&&x(Y))}b.useEffect(function(){Ee({type:"RESET"})},[Ee,M,G]),b.useEffect(function(){if(!M||!ie)return;const Nt=Li(M.getPage(ie)),mt=Nt;return Nt.promise.then(ps=>{Ee({type:"RESOLVE",value:ps})}).catch(ps=>{Ee({type:"REJECT",error:ps})}),()=>It(mt)},[Ee,M,ie]),b.useEffect(()=>{if(I!==void 0){if(I===!1){nt();return}pt()}},[I,ve]);const Ot=b.useMemo(()=>wt(G)&&ie&&wt(de)&&wt(ve)?{_className:i,canvasBackground:n,customTextRenderer:c,devicePixelRatio:h,onGetAnnotationsError:y,onGetAnnotationsSuccess:v,onGetStructTreeError:A,onGetStructTreeSuccess:w,onGetTextError:S,onGetTextSuccess:E,onRenderAnnotationLayerError:C,onRenderAnnotationLayerSuccess:T,onRenderError:D,onRenderSuccess:B,onRenderTextLayerError:k,onRenderTextLayerSuccess:R,page:I,pageIndex:G,pageNumber:ie,renderForms:ee,renderTextLayer:K,rotate:de,scale:ve}:null,[i,n,c,h,y,v,A,w,S,E,C,T,D,B,k,R,I,G,ie,ee,K,de,ve]),ei=b.useMemo(()=>La(Z,()=>I&&(ve?js(I,ve):void 0)),[Z,I,ve]),W=`${G}@${ve}/${de}`;function ae(){switch(L){case"custom":return re(u),fe.jsx(u,{},`${W}_custom`);case"none":return null;case"canvas":default:return fe.jsx(zh,{canvasRef:a},`${W}_canvas`)}}function pe(){return K?fe.jsx(Wh,{},`${W}_text`):null}function fs(){return J?fe.jsx(Bh,{},`${W}_annotations`):null}function Ko(){function gt(mt){return!!mt?.page}if(!gt(Ot))throw new Error("page is undefined");const Nt=typeof o=="function"?o(Ot):o;return fe.jsxs(Va.Provider,{value:Ot,children:[ae(),pe(),fs(),Nt]})}function Uo(){return ie?M===null||I===void 0||I===null?fe.jsx(Gt,{type:"loading",children:typeof g=="function"?g():g}):M===!1||I===!1?fe.jsx(Gt,{type:"error",children:typeof d=="function"?d():d}):Ko():fe.jsx(Gt,{type:"no-data",children:typeof m=="function"?m():m})}return fe.jsx("div",{className:es(i,l),"data-page-number":ie,ref:Ba(p,te),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${ve}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:n||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...ei,children:Uo()})}Lh();Pt.workerSrc="pdf.worker.mjs";let qh=!1,Xh=!1;function Od(){return qh}function Nd(){return Xh}function Ge(r,e,t){let[i,s]=b.useState(r||e),n=b.useRef(r!==void 0),a=r!==void 0;b.useEffect(()=>{n.current,n.current=a},[a]);let o=a?r:i,l=b.useCallback((u,...c)=>{let h=(d,...f)=>{t&&(Object.is(o,d)||t(d,...f)),a||(o=d)};typeof u=="function"?s((f,...p)=>{let g=u(a?o:f,...p);return h(g,...c),a?f:g}):(a||s(u),h(u,...c))},[a,o,t]);return[o,l]}function Bd(r,e=-1/0,t=1/0){return Math.min(Math.max(r,e),t)}const za={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},Ga={...za,customError:!0,valid:!1},oi={isInvalid:!1,validationDetails:za,validationErrors:[]},Yh=b.createContext({}),pr="__formValidationState"+Date.now();function _n(r){if(r[pr]){let{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:s,commitValidation:n}=r[pr];return{realtimeValidation:e,displayValidation:t,updateValidation:i,resetValidation:s,commitValidation:n}}return Zh(r)}function Zh(r){let{isInvalid:e,validationState:t,name:i,value:s,builtinValidation:n,validate:a,validationBehavior:o="aria"}=r;t&&(e||(e=t==="invalid"));let l=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:Ga}:null,u=b.useMemo(()=>{if(!a||s==null)return null;let T=Jh(a,s);return gr(T)},[a,s]);n?.validationDetails.valid&&(n=void 0);let c=b.useContext(Yh),h=b.useMemo(()=>i?Array.isArray(i)?i.flatMap(T=>zs(c[T])):zs(c[i]):[],[c,i]),[d,f]=b.useState(c),[p,g]=b.useState(!1);c!==d&&(f(c),g(!1));let m=b.useMemo(()=>gr(p?[]:h),[p,h]),y=b.useRef(oi),[v,A]=b.useState(oi),w=b.useRef(oi),S=()=>{if(!E)return;x(!1);let T=u||n||y.current;Ts(T,w.current)||(w.current=T,A(T))},[E,x]=b.useState(!1);return b.useEffect(S),{realtimeValidation:l||m||u||n||oi,displayValidation:o==="native"?l||m||v:l||m||u||n||v,updateValidation(T){o==="aria"&&!Ts(v,T)?A(T):y.current=T},resetValidation(){let T=oi;Ts(T,w.current)||(w.current=T,A(T)),o==="native"&&x(!1),g(!0)},commitValidation(){o==="native"&&x(!0),g(!0)}}}function zs(r){return r?Array.isArray(r)?r:[r]:[]}function Jh(r,e){if(typeof r=="function"){let t=r(e);if(t&&typeof t!="boolean")return zs(t)}return[]}function gr(r){return r.length?{isInvalid:!0,validationErrors:r,validationDetails:Ga}:null}function Ts(r,e){return r===e?!0:!!r&&!!e&&r.isInvalid===e.isInvalid&&r.validationErrors.length===e.validationErrors.length&&r.validationErrors.every((t,i)=>t===e.validationErrors[i])&&Object.entries(r.validationDetails).every(([t,i])=>e.validationDetails[t]===i)}function Vd(r={}){let{isReadOnly:e}=r,[t,i]=Ge(r.isSelected,r.defaultSelected||!1,r.onChange),[s]=b.useState(t);function n(l){e||i(l)}function a(){e||i(!t)}var o;return{isSelected:t,defaultSelected:(o=r.defaultSelected)!==null&&o!==void 0?o:s,setSelected:n,toggle:a}}function ds(r){let[e,t]=Ge(r.isOpen,r.defaultOpen||!1,r.onOpenChange);const i=b.useCallback(()=>{t(!0)},[t]),s=b.useCallback(()=>{t(!1)},[t]),n=b.useCallback(()=>{t(!e)},[t,e]);return{isOpen:e,setOpen:t,open:i,close:s,toggle:n}}function Wa(r){return null}Wa.getCollectionNode=function*(e,t){let{childItems:i,title:s,children:n}=e,a=e.title||e.children,o=e.textValue||(typeof a=="string"?a:"")||e["aria-label"]||"";!o&&t?.suppressTextValueWarning,yield{type:"item",props:e,rendered:a,textValue:o,"aria-label":e["aria-label"],hasChildNodes:Qh(e),*childNodes(){if(i)for(let l of i)yield{type:"item",value:l};else if(s){let l=[];$e.Children.forEach(n,u=>{l.push({type:"item",element:u})}),yield*l}}}};function Qh(r){return r.hasChildItems!=null?r.hasChildItems:!!(r.childItems||r.title&&$e.Children.count(r.children)>0)}let Hd=Wa;class ed{build(e,t){return this.context=t,mr(()=>this.iterateCollection(e))}*iterateCollection(e){let{children:t,items:i}=e;if($e.isValidElement(t)&&t.type===$e.Fragment)yield*this.iterateCollection({children:t.props.children,items:i});else if(typeof t=="function"){if(!i)throw new Error("props.children was a function but props.items is missing");let s=0;for(let n of i)yield*this.getFullNode({value:n,index:s},{renderer:t}),s++}else{let s=[];$e.Children.forEach(t,a=>{a&&s.push(a)});let n=0;for(let a of s){let o=this.getFullNode({element:a,index:n},{});for(let l of o)n++,yield l}}}getKey(e,t,i,s){if(e.key!=null)return e.key;if(t.type==="cell"&&t.key!=null)return`${s}${t.key}`;let n=t.value;if(n!=null){var a;let o=(a=n.key)!==null&&a!==void 0?a:n.id;if(o==null)throw new Error("No key found for item");return o}return s?`${s}.${t.index}`:`$.${t.index}`}getChildState(e,t){return{renderer:t.renderer||e.renderer}}*getFullNode(e,t,i,s){if($e.isValidElement(e.element)&&e.element.type===$e.Fragment){let m=[];$e.Children.forEach(e.element.props.children,v=>{m.push(v)});var n;let y=(n=e.index)!==null&&n!==void 0?n:0;for(const v of m)yield*this.getFullNode({element:v,index:y++},t,i,s);return}let a=e.element;if(!a&&e.value&&t&&t.renderer){let m=this.cache.get(e.value);if(m&&(!m.shouldInvalidate||!m.shouldInvalidate(this.context))){m.index=e.index,m.parentKey=s?s.key:null,yield m;return}a=t.renderer(e.value)}if($e.isValidElement(a)){let m=a.type;if(typeof m!="function"&&typeof m.getCollectionNode!="function"){let w=a.type;throw new Error(`Unknown element <${w}> in collection.`)}let y=m.getCollectionNode(a.props,this.context);var o;let v=(o=e.index)!==null&&o!==void 0?o:0,A=y.next();for(;!A.done&&A.value;){let w=A.value;e.index=v;var l;let S=(l=w.key)!==null&&l!==void 0?l:null;S==null&&(S=w.element?null:this.getKey(a,e,t,i));let x=[...this.getFullNode({...w,key:S,index:v,wrapper:td(e.wrapper,w.wrapper)},this.getChildState(t,w),i?`${i}${a.key}`:a.key,s)];for(let _ of x){var u,c;_.value=(c=(u=w.value)!==null&&u!==void 0?u:e.value)!==null&&c!==void 0?c:null,_.value&&this.cache.set(_.value,_);var h;if(e.type&&_.type!==e.type)throw new Error(`Unsupported type <${Rs(_.type)}> in <${Rs((h=s?.type)!==null&&h!==void 0?h:"unknown parent type")}>. Only <${Rs(e.type)}> is supported.`);v++,yield _}A=y.next(x)}return}if(e.key==null||e.type==null)return;let d=this;var f,p;let g={type:e.type,props:e.props,key:e.key,parentKey:s?s.key:null,value:(f=e.value)!==null&&f!==void 0?f:null,level:s?s.level+1:0,index:e.index,rendered:e.rendered,textValue:(p=e.textValue)!==null&&p!==void 0?p:"","aria-label":e["aria-label"],wrapper:e.wrapper,shouldInvalidate:e.shouldInvalidate,hasChildNodes:e.hasChildNodes||!1,childNodes:mr(function*(){if(!e.hasChildNodes||!e.childNodes)return;let m=0;for(let y of e.childNodes()){y.key!=null&&(y.key=`${g.key}${y.key}`);let v=d.getFullNode({...y,index:m},d.getChildState(t,y),g.key,g);for(let A of v)m++,yield A}})};yield g}constructor(){this.cache=new WeakMap}}function mr(r){let e=[],t=null;return{*[Symbol.iterator](){for(let i of e)yield i;t||(t=r());for(let i of t)e.push(i),yield i}}}function td(r,e){if(r&&e)return t=>r(e(t));if(r)return r;if(e)return e}function Rs(r){return r[0].toUpperCase()+r.slice(1)}function Tn(r,e,t){let i=b.useMemo(()=>new ed,[]),{children:s,items:n,collection:a}=r;return b.useMemo(()=>{if(a)return a;let l=i.build({children:s,items:n},t);return e(l)},[i,s,n,a,t,e])}function Ai(r,e){return typeof e.getChildren=="function"?e.getChildren(r.key):r.childNodes}function Rn(r){return id(r,0)}function id(r,e){if(e<0)return;let t=0;for(let i of r){if(t===e)return i;t++}}function qa(r){let e;for(let t of r)e=t;return e}function ks(r,e,t){if(e.parentKey===t.parentKey)return e.index-t.index;let i=[...yr(r,e),e],s=[...yr(r,t),t],n=i.slice(0,s.length).findIndex((a,o)=>a!==s[o]);return n!==-1?(e=i[n],t=s[n],e.index-t.index):i.findIndex(a=>a===t)>=0?1:(s.findIndex(a=>a===e)>=0,-1)}function yr(r,e){let t=[],i=e;for(;i?.parentKey!=null;)i=r.getItem(i.parentKey),i&&t.unshift(i);return t}const br=new WeakMap;function Kd(r){let e=br.get(r);if(e!=null)return e;let t=0,i=s=>{for(let n of s)n.type==="section"?i(Ai(n,r)):n.type==="item"&&t++};return i(r),br.set(r,t),t}class sd{*[Symbol.iterator](){yield*this.iterable}get size(){return this.keyMap.size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){let t=this.keyMap.get(e);var i;return t&&(i=t.prevKey)!==null&&i!==void 0?i:null}getKeyAfter(e){let t=this.keyMap.get(e);var i;return t&&(i=t.nextKey)!==null&&i!==void 0?i:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){var t;return(t=this.keyMap.get(e))!==null&&t!==void 0?t:null}at(e){const t=[...this.getKeys()];return this.getItem(t[e])}constructor(e,{expandedKeys:t}={}){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=e,t=t||new Set;let i=o=>{if(this.keyMap.set(o.key,o),o.childNodes&&(o.type==="section"||t.has(o.key)))for(let l of o.childNodes)i(l)};for(let o of e)i(o);let s=null,n=0;for(let[o,l]of this.keyMap)s?(s.nextKey=o,l.prevKey=s.key):(this.firstKey=o,l.prevKey=void 0),l.type==="item"&&(l.index=n++),s=l,s.nextKey=void 0;var a;this.lastKey=(a=s?.key)!==null&&a!==void 0?a:null}}class je extends Set{constructor(e,t,i){super(e),e instanceof je?(this.anchorKey=t??e.anchorKey,this.currentKey=i??e.currentKey):(this.anchorKey=t??null,this.currentKey=i??null)}}function nd(r,e){if(r.size!==e.size)return!1;for(let t of r)if(!e.has(t))return!1;return!0}function kn(r){let{selectionMode:e="none",disallowEmptySelection:t=!1,allowDuplicateSelectionEvents:i,selectionBehavior:s="toggle",disabledBehavior:n="all"}=r,a=b.useRef(!1),[,o]=b.useState(!1),l=b.useRef(null),u=b.useRef(null),[,c]=b.useState(null),h=b.useMemo(()=>vr(r.selectedKeys),[r.selectedKeys]),d=b.useMemo(()=>vr(r.defaultSelectedKeys,new je),[r.defaultSelectedKeys]),[f,p]=Ge(h,d,r.onSelectionChange),g=b.useMemo(()=>r.disabledKeys?new Set(r.disabledKeys):new Set,[r.disabledKeys]),[m,y]=b.useState(s);s==="replace"&&m==="toggle"&&typeof f=="object"&&f.size===0&&y("replace");let v=b.useRef(s);return b.useEffect(()=>{s!==v.current&&(y(s),v.current=s)},[s]),{selectionMode:e,disallowEmptySelection:t,selectionBehavior:m,setSelectionBehavior:y,get isFocused(){return a.current},setFocused(A){a.current=A,o(A)},get focusedKey(){return l.current},get childFocusStrategy(){return u.current},setFocusedKey(A,w="first"){l.current=A,u.current=w,c(A)},selectedKeys:f,setSelectedKeys(A){(i||!nd(A,f))&&p(A)},disabledKeys:g,disabledBehavior:n}}function vr(r,e){return r?r==="all"?"all":new je(r):e}class Fi{get selectionMode(){return this.state.selectionMode}get disallowEmptySelection(){return this.state.disallowEmptySelection}get selectionBehavior(){return this.state.selectionBehavior}setSelectionBehavior(e){this.state.setSelectionBehavior(e)}get isFocused(){return this.state.isFocused}setFocused(e){this.state.setFocused(e)}get focusedKey(){return this.state.focusedKey}get childFocusStrategy(){return this.state.childFocusStrategy}setFocusedKey(e,t){(e==null||this.collection.getItem(e))&&this.state.setFocusedKey(e,t)}get selectedKeys(){return this.state.selectedKeys==="all"?new Set(this.getSelectAllKeys()):this.state.selectedKeys}get rawSelection(){return this.state.selectedKeys}isSelected(e){if(this.state.selectionMode==="none")return!1;let t=this.getKey(e);return t==null?!1:this.state.selectedKeys==="all"?this.canSelectItem(t):this.state.selectedKeys.has(t)}get isEmpty(){return this.state.selectedKeys!=="all"&&this.state.selectedKeys.size===0}get isSelectAll(){if(this.isEmpty)return!1;if(this.state.selectedKeys==="all")return!0;if(this._isSelectAll!=null)return this._isSelectAll;let e=this.getSelectAllKeys(),t=this.state.selectedKeys;return this._isSelectAll=e.every(i=>t.has(i)),this._isSelectAll}get firstSelectedKey(){let e=null;for(let i of this.state.selectedKeys){let s=this.collection.getItem(i);(!e||s&&ks(this.collection,s,e)<0)&&(e=s)}var t;return(t=e?.key)!==null&&t!==void 0?t:null}get lastSelectedKey(){let e=null;for(let i of this.state.selectedKeys){let s=this.collection.getItem(i);(!e||s&&ks(this.collection,s,e)>0)&&(e=s)}var t;return(t=e?.key)!==null&&t!==void 0?t:null}get disabledKeys(){return this.state.disabledKeys}get disabledBehavior(){return this.state.disabledBehavior}extendSelection(e){if(this.selectionMode==="none")return;if(this.selectionMode==="single"){this.replaceSelection(e);return}let t=this.getKey(e);if(t==null)return;let i;if(this.state.selectedKeys==="all")i=new je([t],t,t);else{let a=this.state.selectedKeys;var s;let o=(s=a.anchorKey)!==null&&s!==void 0?s:t;i=new je(a,o,t);var n;for(let l of this.getKeyRange(o,(n=a.currentKey)!==null&&n!==void 0?n:t))i.delete(l);for(let l of this.getKeyRange(t,o))this.canSelectItem(l)&&i.add(l)}this.state.setSelectedKeys(i)}getKeyRange(e,t){let i=this.collection.getItem(e),s=this.collection.getItem(t);return i&&s?ks(this.collection,i,s)<=0?this.getKeyRangeInternal(e,t):this.getKeyRangeInternal(t,e):[]}getKeyRangeInternal(e,t){var i;if(!((i=this.layoutDelegate)===null||i===void 0)&&i.getKeyRange)return this.layoutDelegate.getKeyRange(e,t);let s=[],n=e;for(;n!=null;){let a=this.collection.getItem(n);if(a&&(a.type==="item"||a.type==="cell"&&this.allowsCellSelection)&&s.push(n),n===t)return s;n=this.collection.getKeyAfter(n)}return[]}getKey(e){let t=this.collection.getItem(e);if(!t||t.type==="cell"&&this.allowsCellSelection)return e;for(;t&&t.type!=="item"&&t.parentKey!=null;)t=this.collection.getItem(t.parentKey);return!t||t.type!=="item"?null:t.key}toggleSelection(e){if(this.selectionMode==="none")return;if(this.selectionMode==="single"&&!this.isSelected(e)){this.replaceSelection(e);return}let t=this.getKey(e);if(t==null)return;let i=new je(this.state.selectedKeys==="all"?this.getSelectAllKeys():this.state.selectedKeys);i.has(t)?i.delete(t):this.canSelectItem(t)&&(i.add(t),i.anchorKey=t,i.currentKey=t),!(this.disallowEmptySelection&&i.size===0)&&this.state.setSelectedKeys(i)}replaceSelection(e){if(this.selectionMode==="none")return;let t=this.getKey(e);if(t==null)return;let i=this.canSelectItem(t)?new je([t],t,t):new je;this.state.setSelectedKeys(i)}setSelectedKeys(e){if(this.selectionMode==="none")return;let t=new je;for(let i of e){let s=this.getKey(i);if(s!=null&&(t.add(s),this.selectionMode==="single"))break}this.state.setSelectedKeys(t)}getSelectAllKeys(){let e=[],t=i=>{for(;i!=null;){if(this.canSelectItem(i)){var s;let a=this.collection.getItem(i);a?.type==="item"&&e.push(i);var n;a?.hasChildNodes&&(this.allowsCellSelection||a.type!=="item")&&t((n=(s=Rn(Ai(a,this.collection)))===null||s===void 0?void 0:s.key)!==null&&n!==void 0?n:null)}i=this.collection.getKeyAfter(i)}};return t(this.collection.getFirstKey()),e}selectAll(){!this.isSelectAll&&this.selectionMode==="multiple"&&this.state.setSelectedKeys("all")}clearSelection(){!this.disallowEmptySelection&&(this.state.selectedKeys==="all"||this.state.selectedKeys.size>0)&&this.state.setSelectedKeys(new je)}toggleSelectAll(){this.isSelectAll?this.clearSelection():this.selectAll()}select(e,t){this.selectionMode!=="none"&&(this.selectionMode==="single"?this.isSelected(e)&&!this.disallowEmptySelection?this.toggleSelection(e):this.replaceSelection(e):this.selectionBehavior==="toggle"||t&&(t.pointerType==="touch"||t.pointerType==="virtual")?this.toggleSelection(e):this.replaceSelection(e))}isSelectionEqual(e){if(e===this.state.selectedKeys)return!0;let t=this.selectedKeys;if(e.size!==t.size)return!1;for(let i of e)if(!t.has(i))return!1;for(let i of t)if(!e.has(i))return!1;return!0}canSelectItem(e){var t;if(this.state.selectionMode==="none"||this.state.disabledKeys.has(e))return!1;let i=this.collection.getItem(e);return!(!i||!(i==null||(t=i.props)===null||t===void 0)&&t.isDisabled||i.type==="cell"&&!this.allowsCellSelection)}isDisabled(e){var t,i;return this.state.disabledBehavior==="all"&&(this.state.disabledKeys.has(e)||!!(!((i=this.collection.getItem(e))===null||i===void 0||(t=i.props)===null||t===void 0)&&t.isDisabled))}isLink(e){var t,i;return!!(!((i=this.collection.getItem(e))===null||i===void 0||(t=i.props)===null||t===void 0)&&t.href)}getItemProps(e){var t;return(t=this.collection.getItem(e))===null||t===void 0?void 0:t.props}withCollection(e){return new Fi(e,this.state,{allowsCellSelection:this.allowsCellSelection,layoutDelegate:this.layoutDelegate||void 0})}constructor(e,t,i){this.collection=e,this.state=t;var s;this.allowsCellSelection=(s=i?.allowsCellSelection)!==null&&s!==void 0?s:!1,this._isSelectAll=null,this.layoutDelegate=i?.layoutDelegate||null}}function Ud(r){let{onExpandedChange:e}=r,[t,i]=Ge(r.expandedKeys?new Set(r.expandedKeys):void 0,r.defaultExpandedKeys?new Set(r.defaultExpandedKeys):new Set,e),s=kn(r),n=b.useMemo(()=>r.disabledKeys?new Set(r.disabledKeys):new Set,[r.disabledKeys]),a=Tn(r,b.useCallback(l=>new sd(l,{expandedKeys:t}),[t]),null);return b.useEffect(()=>{s.focusedKey!=null&&!a.getItem(s.focusedKey)&&s.setFocusedKey(null)},[a,s.focusedKey]),{collection:a,expandedKeys:t,disabledKeys:n,toggleKey:l=>{i(rd(t,l))},setExpandedKeys:i,selectionManager:new Fi(a,s)}}function rd(r,e){let t=new Set(r);return t.has(e)?t.delete(e):t.add(e),t}function jd(r){let e=ds(r),[t,i]=b.useState(null),[s,n]=b.useState([]),a=()=>{n([]),e.close()};return{focusStrategy:t,...e,open(u=null){i(u),e.open()},toggle(u=null){i(u),e.toggle()},close(){a()},expandedKeysStack:s,openSubmenu:(u,c)=>{n(h=>c>h.length?h:[...h.slice(0,c),u])},closeSubmenu:(u,c)=>{n(h=>h[c]===u?h.slice(0,c):h)}}}var Xa={};Xa={rangeOverflow:r=>`يجب أن تكون القيمة ${r.maxValue} أو قبل ذلك.`,rangeReversed:"تاريخ البدء يجب أن يكون قبل تاريخ الانتهاء.",rangeUnderflow:r=>`يجب أن تكون القيمة ${r.minValue} أو بعد ذلك.`,unavailableDate:"البيانات المحددة غير متاحة."};var Ya={};Ya={rangeOverflow:r=>`Стойността трябва да е ${r.maxValue} или по-ранна.`,rangeReversed:"Началната дата трябва да е преди крайната.",rangeUnderflow:r=>`Стойността трябва да е ${r.minValue} или по-късно.`,unavailableDate:"Избраната дата не е налична."};var Za={};Za={rangeOverflow:r=>`Hodnota musí být ${r.maxValue} nebo dřívější.`,rangeReversed:"Datum zahájení musí předcházet datu ukončení.",rangeUnderflow:r=>`Hodnota musí být ${r.minValue} nebo pozdější.`,unavailableDate:"Vybrané datum není k dispozici."};var Ja={};Ja={rangeOverflow:r=>`Værdien skal være ${r.maxValue} eller tidligere.`,rangeReversed:"Startdatoen skal være før slutdatoen.",rangeUnderflow:r=>`Værdien skal være ${r.minValue} eller nyere.`,unavailableDate:"Den valgte dato er ikke tilgængelig."};var Qa={};Qa={rangeOverflow:r=>`Der Wert muss ${r.maxValue} oder früher sein.`,rangeReversed:"Das Startdatum muss vor dem Enddatum liegen.",rangeUnderflow:r=>`Der Wert muss ${r.minValue} oder später sein.`,unavailableDate:"Das ausgewählte Datum ist nicht verfügbar."};var eo={};eo={rangeOverflow:r=>`Η τιμή πρέπει να είναι ${r.maxValue} ή παλαιότερη.`,rangeReversed:"Η ημερομηνία έναρξης πρέπει να είναι πριν από την ημερομηνία λήξης.",rangeUnderflow:r=>`Η τιμή πρέπει να είναι ${r.minValue} ή μεταγενέστερη.`,unavailableDate:"Η επιλεγμένη ημερομηνία δεν είναι διαθέσιμη."};var to={};to={rangeUnderflow:r=>`Value must be ${r.minValue} or later.`,rangeOverflow:r=>`Value must be ${r.maxValue} or earlier.`,rangeReversed:"Start date must be before end date.",unavailableDate:"Selected date unavailable."};var io={};io={rangeOverflow:r=>`El valor debe ser ${r.maxValue} o anterior.`,rangeReversed:"La fecha de inicio debe ser anterior a la fecha de finalización.",rangeUnderflow:r=>`El valor debe ser ${r.minValue} o posterior.`,unavailableDate:"Fecha seleccionada no disponible."};var so={};so={rangeOverflow:r=>`Väärtus peab olema ${r.maxValue} või varasem.`,rangeReversed:"Alguskuupäev peab olema enne lõppkuupäeva.",rangeUnderflow:r=>`Väärtus peab olema ${r.minValue} või hilisem.`,unavailableDate:"Valitud kuupäev pole saadaval."};var no={};no={rangeOverflow:r=>`Arvon on oltava ${r.maxValue} tai sitä aikaisempi.`,rangeReversed:"Aloituspäivän on oltava ennen lopetuspäivää.",rangeUnderflow:r=>`Arvon on oltava ${r.minValue} tai sitä myöhäisempi.`,unavailableDate:"Valittu päivämäärä ei ole käytettävissä."};var ro={};ro={rangeOverflow:r=>`La valeur doit être ${r.maxValue} ou antérieure.`,rangeReversed:"La date de début doit être antérieure à la date de fin.",rangeUnderflow:r=>`La valeur doit être ${r.minValue} ou ultérieure.`,unavailableDate:"La date sélectionnée n’est pas disponible."};var ao={};ao={rangeOverflow:r=>`הערך חייב להיות ${r.maxValue} או מוקדם יותר.`,rangeReversed:"תאריך ההתחלה חייב להיות לפני תאריך הסיום.",rangeUnderflow:r=>`הערך חייב להיות ${r.minValue} או מאוחר יותר.`,unavailableDate:"התאריך הנבחר אינו זמין."};var oo={};oo={rangeOverflow:r=>`Vrijednost mora biti ${r.maxValue} ili ranije.`,rangeReversed:"Datum početka mora biti prije datuma završetka.",rangeUnderflow:r=>`Vrijednost mora biti ${r.minValue} ili kasnije.`,unavailableDate:"Odabrani datum nije dostupan."};var lo={};lo={rangeOverflow:r=>`Az értéknek ${r.maxValue} vagy korábbinak kell lennie.`,rangeReversed:"A kezdő dátumnak a befejező dátumnál korábbinak kell lennie.",rangeUnderflow:r=>`Az értéknek ${r.minValue} vagy későbbinek kell lennie.`,unavailableDate:"A kiválasztott dátum nem érhető el."};var uo={};uo={rangeOverflow:r=>`Il valore deve essere ${r.maxValue} o precedente.`,rangeReversed:"La data di inizio deve essere antecedente alla data di fine.",rangeUnderflow:r=>`Il valore deve essere ${r.minValue} o successivo.`,unavailableDate:"Data selezionata non disponibile."};var co={};co={rangeOverflow:r=>`値は ${r.maxValue} 以下にする必要があります。`,rangeReversed:"開始日は終了日より前にする必要があります。",rangeUnderflow:r=>`値は ${r.minValue} 以上にする必要があります。`,unavailableDate:"選択した日付は使用できません。"};var ho={};ho={rangeOverflow:r=>`값은 ${r.maxValue} 이전이어야 합니다.`,rangeReversed:"시작일은 종료일 이전이어야 합니다.",rangeUnderflow:r=>`값은 ${r.minValue} 이상이어야 합니다.`,unavailableDate:"선택한 날짜를 사용할 수 없습니다."};var fo={};fo={rangeOverflow:r=>`Reikšmė turi būti ${r.maxValue} arba ankstesnė.`,rangeReversed:"Pradžios data turi būti ankstesnė nei pabaigos data.",rangeUnderflow:r=>`Reikšmė turi būti ${r.minValue} arba naujesnė.`,unavailableDate:"Pasirinkta data nepasiekiama."};var po={};po={rangeOverflow:r=>`Vērtībai ir jābūt ${r.maxValue} vai agrākai.`,rangeReversed:"Sākuma datumam ir jābūt pirms beigu datuma.",rangeUnderflow:r=>`Vērtībai ir jābūt ${r.minValue} vai vēlākai.`,unavailableDate:"Atlasītais datums nav pieejams."};var go={};go={rangeOverflow:r=>`Verdien må være ${r.maxValue} eller tidligere.`,rangeReversed:"Startdatoen må være før sluttdatoen.",rangeUnderflow:r=>`Verdien må være ${r.minValue} eller senere.`,unavailableDate:"Valgt dato utilgjengelig."};var mo={};mo={rangeOverflow:r=>`Waarde moet ${r.maxValue} of eerder zijn.`,rangeReversed:"De startdatum moet voor de einddatum liggen.",rangeUnderflow:r=>`Waarde moet ${r.minValue} of later zijn.`,unavailableDate:"Geselecteerde datum niet beschikbaar."};var yo={};yo={rangeOverflow:r=>`Wartość musi mieć wartość ${r.maxValue} lub wcześniejszą.`,rangeReversed:"Data rozpoczęcia musi być wcześniejsza niż data zakończenia.",rangeUnderflow:r=>`Wartość musi mieć wartość ${r.minValue} lub późniejszą.`,unavailableDate:"Wybrana data jest niedostępna."};var bo={};bo={rangeOverflow:r=>`O valor deve ser ${r.maxValue} ou anterior.`,rangeReversed:"A data inicial deve ser anterior à data final.",rangeUnderflow:r=>`O valor deve ser ${r.minValue} ou posterior.`,unavailableDate:"Data selecionada indisponível."};var vo={};vo={rangeOverflow:r=>`O valor tem de ser ${r.maxValue} ou anterior.`,rangeReversed:"A data de início deve ser anterior à data de fim.",rangeUnderflow:r=>`O valor tem de ser ${r.minValue} ou posterior.`,unavailableDate:"Data selecionada indisponível."};var wo={};wo={rangeOverflow:r=>`Valoarea trebuie să fie ${r.maxValue} sau anterioară.`,rangeReversed:"Data de început trebuie să fie anterioară datei de sfârșit.",rangeUnderflow:r=>`Valoarea trebuie să fie ${r.minValue} sau ulterioară.`,unavailableDate:"Data selectată nu este disponibilă."};var Ao={};Ao={rangeOverflow:r=>`Значение должно быть не позже ${r.maxValue}.`,rangeReversed:"Дата начала должна предшествовать дате окончания.",rangeUnderflow:r=>`Значение должно быть не раньше ${r.minValue}.`,unavailableDate:"Выбранная дата недоступна."};var So={};So={rangeOverflow:r=>`Hodnota musí byť ${r.maxValue} alebo skoršia.`,rangeReversed:"Dátum začiatku musí byť skorší ako dátum konca.",rangeUnderflow:r=>`Hodnota musí byť ${r.minValue} alebo neskoršia.`,unavailableDate:"Vybratý dátum je nedostupný."};var Eo={};Eo={rangeOverflow:r=>`Vrednost mora biti ${r.maxValue} ali starejša.`,rangeReversed:"Začetni datum mora biti pred končnim datumom.",rangeUnderflow:r=>`Vrednost mora biti ${r.minValue} ali novejša.`,unavailableDate:"Izbrani datum ni na voljo."};var xo={};xo={rangeOverflow:r=>`Vrednost mora da bude ${r.maxValue} ili starija.`,rangeReversed:"Datum početka mora biti pre datuma završetka.",rangeUnderflow:r=>`Vrednost mora da bude ${r.minValue} ili novija.`,unavailableDate:"Izabrani datum nije dostupan."};var Co={};Co={rangeOverflow:r=>`Värdet måste vara ${r.maxValue} eller tidigare.`,rangeReversed:"Startdatumet måste vara före slutdatumet.",rangeUnderflow:r=>`Värdet måste vara ${r.minValue} eller senare.`,unavailableDate:"Det valda datumet är inte tillgängligt."};var _o={};_o={rangeOverflow:r=>`Değer, ${r.maxValue} veya öncesi olmalıdır.`,rangeReversed:"Başlangıç tarihi bitiş tarihinden önce olmalıdır.",rangeUnderflow:r=>`Değer, ${r.minValue} veya sonrası olmalıdır.`,unavailableDate:"Seçilen tarih kullanılamıyor."};var To={};To={rangeOverflow:r=>`Значення має бути не пізніше ${r.maxValue}.`,rangeReversed:"Дата початку має передувати даті завершення.",rangeUnderflow:r=>`Значення має бути не раніше ${r.minValue}.`,unavailableDate:"Вибрана дата недоступна."};var Ro={};Ro={rangeOverflow:r=>`值必须是 ${r.maxValue} 或更早日期。`,rangeReversed:"开始日期必须早于结束日期。",rangeUnderflow:r=>`值必须是 ${r.minValue} 或更晚日期。`,unavailableDate:"所选日期不可用。"};var ko={};ko={rangeOverflow:r=>`值必須是 ${r.maxValue} 或更早。`,rangeReversed:"開始日期必須在結束日期之前。",rangeUnderflow:r=>`值必須是 ${r.minValue} 或更晚。`,unavailableDate:"所選日期無法使用。"};var Po={};Po={"ar-AE":Xa,"bg-BG":Ya,"cs-CZ":Za,"da-DK":Ja,"de-DE":Qa,"el-GR":eo,"en-US":to,"es-ES":io,"et-EE":so,"fi-FI":no,"fr-FR":ro,"he-IL":ao,"hr-HR":oo,"hu-HU":lo,"it-IT":uo,"ja-JP":co,"ko-KR":ho,"lt-LT":fo,"lv-LV":po,"nb-NO":go,"nl-NL":mo,"pl-PL":yo,"pt-BR":bo,"pt-PT":vo,"ro-RO":wo,"ru-RU":Ao,"sk-SK":So,"sl-SI":Eo,"sr-SP":xo,"sv-SE":Co,"tr-TR":_o,"uk-UA":To,"zh-CN":Ro,"zh-TW":ko};function ad(r){return r&&r.__esModule?r.default:r}const od=new Ys(ad(Po));function ld(){let r=typeof navigator<"u"&&(navigator.language||navigator.userLanguage)||"en-US";try{Intl.DateTimeFormat.supportedLocalesOf([r])}catch{r="en-US"}return r}function Do(r,e,t,i,s){let n=r!=null&&t!=null&&r.compare(t)>0,a=r!=null&&e!=null&&r.compare(e)<0,o=r!=null&&i?.(r)||!1,l=n||a||o,u=[];if(l){let c=ld(),h=Ys.getGlobalDictionaryForPackage("@react-stately/datepicker")||od,d=new jo(c,h),f=new bt(c,Wt({},s)),p=f.resolvedOptions().timeZone;a&&e!=null&&u.push(d.format("rangeUnderflow",{minValue:f.format(e.toDate(p))})),n&&t!=null&&u.push(d.format("rangeOverflow",{maxValue:f.format(t.toDate(p))})),o&&u.push(d.format("unavailableDate"))}return{isInvalid:l,validationErrors:u,validationDetails:{badInput:o,customError:!1,patternMismatch:!1,rangeOverflow:n,rangeUnderflow:a,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!l}}}const ud={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"2-digit",second:"2-digit"},cd={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"};function Wt(r,e){r={...e.shouldForceLeadingZeros?cd:ud,...r};let i=e.granularity||"minute",s=Object.keys(r);var n;let a=s.indexOf((n=e.maxGranularity)!==null&&n!==void 0?n:"year");a<0&&(a=0);let o=s.indexOf(i);if(o<0&&(o=2),a>o)throw new Error("maxGranularity must be greater than granularity");let l=s.slice(a,o+1).reduce((c,h)=>(c[h]=r[h],c),{});return e.hourCycle!=null&&(l.hour12=e.hourCycle===12),l.timeZone=e.timeZone||"UTC",(i==="hour"||i==="minute"||i==="second")&&e.timeZone&&!e.hideTimeZone&&(l.timeZoneName="short"),e.showEra&&a===0&&(l.era="short"),l}function wr(r){return r&&"hour"in r?r:new _r}function Mo(r,e){if(r===null)return null;if(r)return et(r,e)}function li(r,e,t,i){if(r)return Mo(r,t);let s=et(Go(i??Tr()).set({hour:0,minute:0,second:0,millisecond:0}),t);return e==="year"||e==="month"||e==="day"?lt(s):i?s:Zs(s)}function Io(r,e){let t=r&&"timeZone"in r?r.timeZone:void 0,i=r&&"minute"in r?"minute":"day";if(r&&e&&!(e in r))throw new Error("Invalid granularity "+e+" for value "+r.toString());let[s,n]=b.useState([i,t]);r&&(s[0]!==i||s[1]!==t)&&n([i,t]),e||(e=r?i:s[0]);let a=r?t:s[1];return[e,a]}function zd(r){let e=ds(r),[t,i]=Ge(r.value,r.defaultValue||null,r.onChange),[s]=b.useState(t),n=t||r.placeholderValue||null,[a,o]=Io(n,r.granularity),l=t!=null?t.toDate(o??"UTC"):null,u=a==="hour"||a==="minute"||a==="second";var c;let h=(c=r.shouldCloseOnSelect)!==null&&c!==void 0?c:!0,[d,f]=b.useState(null),[p,g]=b.useState(null);if(t&&(d=t,"hour"in t&&(p=t)),n&&!(a in n))throw new Error("Invalid granularity "+a+" for value "+n.toString());let m=t?.calendar.identifier==="gregory"&&t.era==="BC",y=b.useMemo(()=>({granularity:a,timeZone:o,hideTimeZone:r.hideTimeZone,hourCycle:r.hourCycle,shouldForceLeadingZeros:r.shouldForceLeadingZeros,showEra:m}),[a,r.hourCycle,r.shouldForceLeadingZeros,o,r.hideTimeZone,m]),{minValue:v,maxValue:A,isDateUnavailable:w}=r,S=b.useMemo(()=>Do(t,v,A,w,y),[t,v,A,w,y]),E=_n({...r,value:t,builtinValidation:S}),x=E.displayValidation.isInvalid,_=r.validationState||(x?"invalid":null),C=(k,R)=>{i("timeZone"in R?R.set(lt(k)):Zs(k,R)),f(null),g(null),E.commitValidation()},T=k=>{let R=typeof h=="function"?h():h;u?p||R?C(k,p||wr(r.defaultValue||r.placeholderValue)):f(k):(i(k),E.commitValidation()),R&&e.setOpen(!1)},D=k=>{d&&k?C(d,k):g(k)};var B;return{...E,value:t,defaultValue:(B=r.defaultValue)!==null&&B!==void 0?B:s,setValue:i,dateValue:d,timeValue:p,setDateValue:T,setTimeValue:D,granularity:a,hasTime:u,...e,setOpen(k){!k&&!t&&d&&u&&C(d,p||wr(r.defaultValue||r.placeholderValue)),e.setOpen(k)},validationState:_,isInvalid:x,formatValue(k,R){if(!l)return"";let $=Wt(R,y);return new bt(k,$).format(l)},getDateFormatter(k,R){let $={...y,...R},P=Wt({},$);return new bt(k,P)}}}const hd=new Ys({ach:{year:"mwaka",month:"dwe",day:"nino"},af:{year:"jjjj",month:"mm",day:"dd"},am:{year:"ዓዓዓዓ",month:"ሚሜ",day:"ቀቀ"},an:{year:"aaaa",month:"mm",day:"dd"},ar:{year:"سنة",month:"شهر",day:"يوم"},ast:{year:"aaaa",month:"mm",day:"dd"},az:{year:"iiii",month:"aa",day:"gg"},be:{year:"гггг",month:"мм",day:"дд"},bg:{year:"гггг",month:"мм",day:"дд"},bn:{year:"yyyy",month:"মিমি",day:"dd"},br:{year:"bbbb",month:"mm",day:"dd"},bs:{year:"gggg",month:"mm",day:"dd"},ca:{year:"aaaa",month:"mm",day:"dd"},cak:{year:"jjjj",month:"ii",day:"q'q'"},ckb:{year:"ساڵ",month:"مانگ",day:"ڕۆژ"},cs:{year:"rrrr",month:"mm",day:"dd"},cy:{year:"bbbb",month:"mm",day:"dd"},da:{year:"åååå",month:"mm",day:"dd"},de:{year:"jjjj",month:"mm",day:"tt"},dsb:{year:"llll",month:"mm",day:"źź"},el:{year:"εεεε",month:"μμ",day:"ηη"},en:{year:"yyyy",month:"mm",day:"dd"},eo:{year:"jjjj",month:"mm",day:"tt"},es:{year:"aaaa",month:"mm",day:"dd"},et:{year:"aaaa",month:"kk",day:"pp"},eu:{year:"uuuu",month:"hh",day:"ee"},fa:{year:"سال",month:"ماه",day:"روز"},ff:{year:"hhhh",month:"ll",day:"ññ"},fi:{year:"vvvv",month:"kk",day:"pp"},fr:{year:"aaaa",month:"mm",day:"jj"},fy:{year:"jjjj",month:"mm",day:"dd"},ga:{year:"bbbb",month:"mm",day:"ll"},gd:{year:"bbbb",month:"mm",day:"ll"},gl:{year:"aaaa",month:"mm",day:"dd"},he:{year:"שנה",month:"חודש",day:"יום"},hr:{year:"gggg",month:"mm",day:"dd"},hsb:{year:"llll",month:"mm",day:"dd"},hu:{year:"éééé",month:"hh",day:"nn"},ia:{year:"aaaa",month:"mm",day:"dd"},id:{year:"tttt",month:"bb",day:"hh"},it:{year:"aaaa",month:"mm",day:"gg"},ja:{year:"年",month:"月",day:"日"},ka:{year:"წწწწ",month:"თთ",day:"რრ"},kk:{year:"жжжж",month:"аа",day:"кк"},kn:{year:"ವವವವ",month:"ಮಿಮೀ",day:"ದಿದಿ"},ko:{year:"연도",month:"월",day:"일"},lb:{year:"jjjj",month:"mm",day:"dd"},lo:{year:"ປປປປ",month:"ດດ",day:"ວວ"},lt:{year:"mmmm",month:"mm",day:"dd"},lv:{year:"gggg",month:"mm",day:"dd"},meh:{year:"aaaa",month:"mm",day:"dd"},ml:{year:"വർഷം",month:"മാസം",day:"തീയതി"},ms:{year:"tttt",month:"mm",day:"hh"},nb:{year:"åååå",month:"mm",day:"dd"},nl:{year:"jjjj",month:"mm",day:"dd"},nn:{year:"åååå",month:"mm",day:"dd"},no:{year:"åååå",month:"mm",day:"dd"},oc:{year:"aaaa",month:"mm",day:"jj"},pl:{year:"rrrr",month:"mm",day:"dd"},pt:{year:"aaaa",month:"mm",day:"dd"},rm:{year:"oooo",month:"mm",day:"dd"},ro:{year:"aaaa",month:"ll",day:"zz"},ru:{year:"гггг",month:"мм",day:"дд"},sc:{year:"aaaa",month:"mm",day:"dd"},scn:{year:"aaaa",month:"mm",day:"jj"},sk:{year:"rrrr",month:"mm",day:"dd"},sl:{year:"llll",month:"mm",day:"dd"},sr:{year:"гггг",month:"мм",day:"дд"},sv:{year:"åååå",month:"mm",day:"dd"},szl:{year:"rrrr",month:"mm",day:"dd"},tg:{year:"сссс",month:"мм",day:"рр"},th:{year:"ปปปป",month:"ดด",day:"วว"},tr:{year:"yyyy",month:"aa",day:"gg"},uk:{year:"рррр",month:"мм",day:"дд"},"zh-CN":{year:"年",month:"月",day:"日"},"zh-TW":{year:"年",month:"月",day:"日"}},"en");function dd(r,e,t){return r==="era"||r==="dayPeriod"?e:r==="year"||r==="month"||r==="day"?hd.getStringForLocale(r,t):"––"}const Xi={year:!0,month:!0,day:!0,hour:!0,minute:!0,second:!0,dayPeriod:!0,era:!0},Ar={year:5,month:2,day:7,hour:2,minute:15,second:15},Lo={dayperiod:"dayPeriod",relatedYear:"year",yearName:"literal",unknown:"literal"};function fd(r){let{locale:e,createCalendar:t,hideTimeZone:i,isDisabled:s=!1,isReadOnly:n=!1,isRequired:a=!1,minValue:o,maxValue:l,isDateUnavailable:u}=r,c=r.value||r.defaultValue||r.placeholderValue||null,[h,d]=Io(c,r.granularity),f=d||"UTC";if(c&&!(h in c))throw new Error("Invalid granularity "+h+" for value "+c.toString());let p=b.useMemo(()=>new bt(e),[e]),g=b.useMemo(()=>t(p.resolvedOptions().calendar),[t,p]);var m;let[y,v]=Ge(r.value,(m=r.defaultValue)!==null&&m!==void 0?m:null,r.onChange),[A]=b.useState(y),w=b.useMemo(()=>{var I;return(I=Mo(y,g))!==null&&I!==void 0?I:null},[y,g]),[S,E]=b.useState(()=>li(r.placeholderValue,h,g,d)),x=w||S,_=g.identifier==="gregory"&&x.era==="BC",C=b.useMemo(()=>{var I;return{granularity:h,maxGranularity:(I=r.maxGranularity)!==null&&I!==void 0?I:"year",timeZone:d,hideTimeZone:i,hourCycle:r.hourCycle,showEra:_,shouldForceLeadingZeros:r.shouldForceLeadingZeros}},[r.maxGranularity,h,r.hourCycle,r.shouldForceLeadingZeros,d,i,_]),T=b.useMemo(()=>Wt({},C),[C]),D=b.useMemo(()=>new bt(e,T),[e,T]),B=b.useMemo(()=>D.resolvedOptions(),[D]),k=b.useMemo(()=>D.formatToParts(new Date).filter(I=>Xi[I.type]).reduce((I,Y)=>(I[Lo[Y.type]||Y.type]=!0,I),{}),[D]),[R,$]=b.useState(()=>r.value||r.defaultValue?{...k}:{}),P=b.useRef(null),M=b.useRef(g);b.useEffect(()=>{Rr(g,M.current)||(M.current=g,E(I=>Object.keys(R).length>0?et(I,g):li(r.placeholderValue,h,g,d)))},[g,h,R,d,r.placeholderValue]),y&&Object.keys(R).length<Object.keys(k).length&&(R={...k},$(R)),y==null&&Object.keys(R).length===Object.keys(k).length&&(R={},$(R),E(li(r.placeholderValue,h,g,d)));let O=w&&Object.keys(R).length>=Object.keys(k).length?w:S,J=I=>{if(r.isDisabled||r.isReadOnly)return;let Y=Object.keys(R),te=Object.keys(k);I==null?(v(null),E(li(r.placeholderValue,h,g,d)),$({})):Y.length===0&&P.current==null||Y.length>=te.length||Y.length===te.length-1&&k.dayPeriod&&!R.dayPeriod&&P.current!=="dayPeriod"?(Y.length===0&&(R={...k},$(R)),I=et(I,c?.calendar||new Js),v(I)):E(I),P.current=null},ee=b.useMemo(()=>O.toDate(f),[O,f]),L=b.useMemo(()=>pd(ee,R,D,B,O,g,e,h),[ee,R,D,B,O,g,e,h]);k.era&&R.year&&!R.era?(R.era=!0,$({...R})):!k.era&&R.era&&(delete R.era,$({...R}));let K=I=>{R[I]=!0,I==="year"&&k.era&&(R.era=!0),$({...R})},j=(I,Y)=>{if(R[I])J(gd(O,I,Y,B));else{K(I);let te=Object.keys(R),G=Object.keys(k);(te.length>=G.length||te.length===G.length-1&&k.dayPeriod&&!R.dayPeriod)&&J(O)}},ne=b.useMemo(()=>Do(y,o,l,u,C),[y,o,l,u,C]),ue=_n({...r,value:y,builtinValidation:ne}),Q=ue.displayValidation.isInvalid,Z=r.validationState||(Q?"invalid":null);var _e,Ee;return{...ue,value:w,defaultValue:(_e=r.defaultValue)!==null&&_e!==void 0?_e:A,dateValue:ee,calendar:g,setValue:J,segments:L,dateFormatter:D,validationState:Z,isInvalid:Q,granularity:h,maxGranularity:(Ee=r.maxGranularity)!==null&&Ee!==void 0?Ee:"year",isDisabled:s,isReadOnly:n,isRequired:a,increment(I){j(I,1)},decrement(I){j(I,-1)},incrementPage(I){j(I,Ar[I]||1)},decrementPage(I){j(I,-(Ar[I]||1))},setSegment(I,Y){K(I),J(md(O,I,Y,B))},confirmPlaceholder(){if(r.isDisabled||r.isReadOnly)return;let I=Object.keys(R),Y=Object.keys(k);I.length===Y.length-1&&k.dayPeriod&&!R.dayPeriod&&(R={...k},$(R),J(O.copy()))},clearSegment(I){delete R[I],P.current=I,$({...R});let Y=li(r.placeholderValue,h,g,d),te=O;if(I==="dayPeriod"&&"hour"in O&&"hour"in Y){let G=O.hour>=12,ie=Y.hour>=12;G&&!ie?te=O.set({hour:O.hour-12}):!G&&ie&&(te=O.set({hour:O.hour+12}))}else I==="hour"&&"hour"in O&&O.hour>=12&&R.dayPeriod?te=O.set({hour:Y.hour+12}):I in O&&(te=O.set({[I]:Y[I]}));v(null),J(te)},formatValue(I){if(!w)return"";let Y=Wt(I,C);return new bt(e,Y).format(ee)},getDateFormatter(I,Y){let te={...C,...Y},G=Wt({},te);return new bt(I,G)}}}function pd(r,e,t,i,s,n,a,o){let l=["hour","minute","second"],u=t.formatToParts(r),c=[];for(let h of u){let d=Lo[h.type]||h.type,f=Xi[d];d==="era"&&n.getEras().length===1&&(f=!1);let p=Xi[d]&&!e[d],g=Xi[d]?dd(d,h.value,a):null,m={type:d,text:p?g:h.value,...ji(s,d,i),isPlaceholder:p,placeholder:g,isEditable:f};d==="hour"?(c.push({type:"literal",text:"⁦",...ji(s,"literal",i),isPlaceholder:!1,placeholder:"",isEditable:!1}),c.push(m),d===o&&c.push({type:"literal",text:"⁩",...ji(s,"literal",i),isPlaceholder:!1,placeholder:"",isEditable:!1})):l.includes(d)&&d===o?(c.push(m),c.push({type:"literal",text:"⁩",...ji(s,"literal",i),isPlaceholder:!1,placeholder:"",isEditable:!1})):c.push(m)}return c}function ji(r,e,t){switch(e){case"era":{let i=r.calendar.getEras();return{value:i.indexOf(r.era),minValue:0,maxValue:i.length-1}}case"year":return{value:r.year,minValue:1,maxValue:r.calendar.getYearsInEra(r)};case"month":return{value:r.month,minValue:qo(r),maxValue:r.calendar.getMonthsInYear(r)};case"day":return{value:r.day,minValue:Wo(r),maxValue:r.calendar.getDaysInMonth(r)}}if("hour"in r)switch(e){case"dayPeriod":return{value:r.hour>=12?12:0,minValue:0,maxValue:12};case"hour":if(t.hour12){let i=r.hour>=12;return{value:r.hour,minValue:i?12:0,maxValue:i?23:11}}return{value:r.hour,minValue:0,maxValue:23};case"minute":return{value:r.minute,minValue:0,maxValue:59};case"second":return{value:r.second,minValue:0,maxValue:59}}return{}}function gd(r,e,t,i){switch(e){case"era":case"year":case"month":case"day":return r.cycle(e,t,{round:e==="year"})}if("hour"in r)switch(e){case"dayPeriod":{let s=r.hour,n=s>=12;return r.set({hour:n?s-12:s+12})}case"hour":case"minute":case"second":return r.cycle(e,t,{round:e!=="hour",hourCycle:i.hour12?12:24})}throw new Error("Unknown segment: "+e)}function md(r,e,t,i){switch(e){case"day":case"month":case"year":case"era":return r.set({[e]:t})}if("hour"in r&&typeof t=="number")switch(e){case"dayPeriod":{let s=r.hour,n=s>=12;return t>=12===n?r:r.set({hour:n?s-12:s+12})}case"hour":if(i.hour12){let n=r.hour>=12;!n&&t===12&&(t=0),n&&t<12&&(t+=12)}case"minute":case"second":return r.set({[e]:t})}throw new Error("Unknown segment: "+e)}function Gd(r){let{placeholderValue:e=new _r,minValue:t,maxValue:i,defaultValue:s,granularity:n,validate:a}=r,[o,l]=Ge(r.value,s??null,r.onChange),u=o||e,c=u&&"day"in u?u:void 0,h=s&&"timeZone"in s?s.timeZone:void 0,d=b.useMemo(()=>{let w=u&&"timeZone"in u?u.timeZone:void 0;return(w||h)&&e?Xo(Bt(e),w||h):Bt(e)},[e,u,h]),f=b.useMemo(()=>Bt(t,c),[t,c]),p=b.useMemo(()=>Bt(i,c),[i,c]),g=b.useMemo(()=>o&&"day"in o?Mn(o):o,[o]),m=b.useMemo(()=>o==null?null:Bt(o),[o]),y=b.useMemo(()=>s==null?null:Bt(s),[s]);return{...fd({...r,value:m,defaultValue:y,minValue:f,maxValue:p,onChange:w=>{l(c||h?w:w&&Mn(w))},granularity:n||"minute",maxGranularity:"hour",placeholderValue:d??void 0,createCalendar:()=>new Js,validate:b.useCallback(()=>a?.(o),[a,o])}),timeValue:g}}function Bt(r,e=kr(Tr())){return r?"day"in r?r:Zs(e,r):null}function Ps(r,e,t){return e!=null&&r.compare(e)<0||t!=null&&r.compare(t)>0}function Sr(r,e,t,i,s){let n={};for(let o in e)n[o]=Math.floor(e[o]/2),n[o]>0&&e[o]%2===0&&n[o]--;let a=_t(r,e,t).subtract(n);return Si(r,a,e,t,i,s)}function _t(r,e,t,i,s){let n=r;return e.years?n=Yo(r):e.months?n=Mr(r):e.weeks&&(n=Ms(r,t)),Si(r,n,e,t,i,s)}function Gs(r,e,t,i,s){let n={...e};n.days?n.days--:n.weeks?n.weeks--:n.months?n.months--:n.years&&n.years--;let a=_t(r,e,t).subtract(n);return Si(r,a,e,t,i,s)}function Si(r,e,t,i,s,n){if(s&&r.compare(s)>=0){let a=Pr(e,_t(lt(s),t,i));a&&(e=a)}if(n&&r.compare(n)<=0){let a=Dr(e,Gs(lt(n),t,i));a&&(e=a)}return e}function At(r,e,t){if(e){let i=Pr(r,lt(e));i&&(r=i)}if(t){let i=Dr(r,lt(t));i&&(r=i)}return r}function yd(r,e,t){if(!t)return r;for(;r.compare(e)>=0&&t(r);)r=r.subtract({days:1});return r.compare(e)>=0?r:null}function Wd(r){let e=b.useMemo(()=>new bt(r.locale),[r.locale]),t=b.useMemo(()=>e.resolvedOptions(),[e]),{locale:i,createCalendar:s,visibleDuration:n={months:1},minValue:a,maxValue:o,selectionAlignment:l,isDateUnavailable:u,pageBehavior:c="visible",firstDayOfWeek:h}=r,d=b.useMemo(()=>s(t.calendar),[s,t.calendar]);var f;let[p,g]=Ge(r.value,(f=r.defaultValue)!==null&&f!==void 0?f:null,r.onChange),m=b.useMemo(()=>p?et(lt(p),d):null,[p,d]),y=b.useMemo(()=>p&&"timeZone"in p?p.timeZone:t.timeZone,[p,t.timeZone]),v=b.useMemo(()=>r.focusedValue?At(et(lt(r.focusedValue),d),a,o):void 0,[r.focusedValue,d,a,o]),A=b.useMemo(()=>At(r.defaultFocusedValue?et(lt(r.defaultFocusedValue),d):m||et(kr(y),d),a,o),[r.defaultFocusedValue,m,y,d,a,o]),[w,S]=Ge(v,A,r.onFocusChange),[E,x]=b.useState(()=>{switch(l){case"start":return _t(w,n,i,a,o);case"end":return Gs(w,n,i,a,o);case"center":default:return Sr(w,n,i,a,o)}}),[_,C]=b.useState(r.autoFocus||!1),T=b.useMemo(()=>{let L={...n};return L.days?L.days--:L.days=-1,E.add(L)},[E,n]),[D,B]=b.useState(d);if(!Rr(d,D)){let L=et(w,d);x(Sr(L,n,i,a,o)),S(L),B(d)}Ps(w,a,o)?S(At(w,a,o)):w.compare(E)<0?x(Gs(w,n,i,a,o)):w.compare(T)>0&&x(_t(w,n,i,a,o));function k(L){L=At(L,a,o),S(L)}function R(L){if(!r.isDisabled&&!r.isReadOnly){let K=L;if(K===null){g(null);return}if(K=At(K,a,o),K=yd(K,E,u),!K)return;K=et(K,p?.calendar||new Js),p&&"hour"in p?g(p.set(K)):g(K)}}let $=b.useMemo(()=>m?u&&u(m)?!0:Ps(m,a,o):!1,[m,u,a,o]),P=r.isInvalid||r.validationState==="invalid"||$,M=P?"invalid":null,O=b.useMemo(()=>c==="visible"?n:Ds(n),[c,n]);var J,ee;return{isDisabled:(J=r.isDisabled)!==null&&J!==void 0?J:!1,isReadOnly:(ee=r.isReadOnly)!==null&&ee!==void 0?ee:!1,value:m,setValue:R,visibleRange:{start:E,end:T},minValue:a,maxValue:o,focusedDate:w,timeZone:y,validationState:M,isValueInvalid:P,setFocusedDate(L){k(L),C(!0)},focusNextDay(){k(w.add({days:1}))},focusPreviousDay(){k(w.subtract({days:1}))},focusNextRow(){n.days?this.focusNextPage():(n.weeks||n.months||n.years)&&k(w.add({weeks:1}))},focusPreviousRow(){n.days?this.focusPreviousPage():(n.weeks||n.months||n.years)&&k(w.subtract({weeks:1}))},focusNextPage(){let L=E.add(O);S(At(w.add(O),a,o)),x(_t(Si(w,L,O,i,a,o),O,i))},focusPreviousPage(){let L=E.subtract(O);S(At(w.subtract(O),a,o)),x(_t(Si(w,L,O,i,a,o),O,i))},focusSectionStart(){n.days?k(E):n.weeks?k(Ms(w,i)):(n.months||n.years)&&k(Mr(w))},focusSectionEnd(){n.days?k(T):n.weeks?k(Jo(w,i)):(n.months||n.years)&&k(Qo(w))},focusNextSection(L){if(!L&&!n.days){k(w.add(Ds(n)));return}n.days?this.focusNextPage():n.weeks?k(w.add({months:1})):(n.months||n.years)&&k(w.add({years:1}))},focusPreviousSection(L){if(!L&&!n.days){k(w.subtract(Ds(n)));return}n.days?this.focusPreviousPage():n.weeks?k(w.subtract({months:1})):(n.months||n.years)&&k(w.subtract({years:1}))},selectFocusedDate(){u&&u(w)||R(w)},selectDate(L){R(L)},isFocused:_,setFocused:C,isInvalid(L){return Ps(L,a,o)},isSelected(L){return m!=null&&ti(L,m)&&!this.isCellDisabled(L)&&!this.isCellUnavailable(L)},isCellFocused(L){return _&&w&&ti(L,w)},isCellDisabled(L){return r.isDisabled||L.compare(E)<0||L.compare(T)>0||this.isInvalid(L)},isCellUnavailable(L){return r.isDateUnavailable?r.isDateUnavailable(L):!1},isPreviousVisibleRangeInvalid(){let L=E.subtract({days:1});return ti(L,E)||this.isInvalid(L)},isNextVisibleRangeInvalid(){let L=T.add({days:1});return ti(L,T)||this.isInvalid(L)},getDatesInWeek(L,K=E){let j=K.add({weeks:L}),ne=[];j=Ms(j,i,h);let ue=Zo(j,i,h);for(let Q=0;Q<ue;Q++)ne.push(null);for(;ne.length<7;){ne.push(j);let Q=j.add({days:1});if(ti(j,Q))break;j=Q}for(;ne.length<7;)ne.push(null);return ne}}}function Ds(r){let e={...r};for(let t in r)e[t]=1;return e}class Ws{*[Symbol.iterator](){yield*this.iterable}get size(){return this._size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){let t=this.keyMap.get(e);var i;return t&&(i=t.prevKey)!==null&&i!==void 0?i:null}getKeyAfter(e){let t=this.keyMap.get(e);var i;return t&&(i=t.nextKey)!==null&&i!==void 0?i:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){var t;return(t=this.keyMap.get(e))!==null&&t!==void 0?t:null}at(e){const t=[...this.getKeys()];return this.getItem(t[e])}getChildren(e){let t=this.keyMap.get(e);return t?.childNodes||[]}constructor(e){this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=e;let t=o=>{if(this.keyMap.set(o.key,o),o.childNodes&&o.type==="section")for(let l of o.childNodes)t(l)};for(let o of e)t(o);let i=null,s=0,n=0;for(let[o,l]of this.keyMap)i?(i.nextKey=o,l.prevKey=i.key):(this.firstKey=o,l.prevKey=void 0),l.type==="item"&&(l.index=s++),(l.type==="section"||l.type==="item")&&n++,i=l,i.nextKey=void 0;this._size=n;var a;this.lastKey=(a=i?.key)!==null&&a!==void 0?a:null}}function bd(r){let{filter:e,layoutDelegate:t}=r,i=kn(r),s=b.useMemo(()=>r.disabledKeys?new Set(r.disabledKeys):new Set,[r.disabledKeys]),n=b.useCallback(u=>e?new Ws(e(u)):new Ws(u),[e]),a=b.useMemo(()=>({suppressTextValueWarning:r.suppressTextValueWarning}),[r.suppressTextValueWarning]),o=Tn(r,n,a),l=b.useMemo(()=>new Fi(o,i,{layoutDelegate:t}),[o,i,t]);return vd(o,l),{collection:o,disabledKeys:s,selectionManager:l}}function vd(r,e){const t=b.useRef(null);b.useEffect(()=>{if(e.focusedKey!=null&&!r.getItem(e.focusedKey)&&t.current){const c=t.current.getItem(e.focusedKey),h=[...t.current.getKeys()].map(y=>{const v=t.current.getItem(y);return v?.type==="item"?v:null}).filter(y=>y!==null),d=[...r.getKeys()].map(y=>{const v=r.getItem(y);return v?.type==="item"?v:null}).filter(y=>y!==null);var i,s;const f=((i=h?.length)!==null&&i!==void 0?i:0)-((s=d?.length)!==null&&s!==void 0?s:0);var n,a,o;let p=Math.min(f>1?Math.max(((n=c?.index)!==null&&n!==void 0?n:0)-f+1,0):(a=c?.index)!==null&&a!==void 0?a:0,((o=d?.length)!==null&&o!==void 0?o:0)-1),g=null,m=!1;for(;p>=0;){if(!e.isDisabled(d[p].key)){g=d[p];break}if(p<d.length-1&&!m)p++;else{m=!0;var l,u;p>((l=c?.index)!==null&&l!==void 0?l:0)&&(p=(u=c?.index)!==null&&u!==void 0?u:0),p--}}e.setFocusedKey(g?g.key:null)}t.current=r},[r,e])}function Fo(r){var e;let[t,i]=Ge(r.selectedKey,(e=r.defaultSelectedKey)!==null&&e!==void 0?e:null,r.onSelectionChange),s=b.useMemo(()=>t!=null?[t]:[],[t]),{collection:n,disabledKeys:a,selectionManager:o}=bd({...r,selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:s,onSelectionChange:u=>{if(u==="all")return;var c;let h=(c=u.values().next().value)!==null&&c!==void 0?c:null;h===t&&r.onSelectionChange&&r.onSelectionChange(h),i(h)}}),l=t!=null?n.getItem(t):null;return{collection:n,disabledKeys:a,selectionManager:o,selectedKey:t,setSelectedKey:i,selectedItem:l}}function qd(r){var e,t;let i=Fo({...r,onSelectionChange:r.onSelectionChange?l=>{var u;l!=null&&((u=r.onSelectionChange)===null||u===void 0||u.call(r,l))}:void 0,suppressTextValueWarning:!0,defaultSelectedKey:(t=(e=r.defaultSelectedKey)!==null&&e!==void 0?e:Er(r.collection,r.disabledKeys?new Set(r.disabledKeys):new Set))!==null&&t!==void 0?t:void 0}),{selectionManager:s,collection:n,selectedKey:a}=i,o=b.useRef(a);return b.useEffect(()=>{let l=a;r.selectedKey==null&&(s.isEmpty||l==null||!n.getItem(l))&&(l=Er(n,i.disabledKeys),l!=null&&s.setSelectedKeys([l])),(l!=null&&s.focusedKey==null||!s.isFocused&&l!==o.current)&&s.setFocusedKey(l),o.current=l}),{...i,isDisabled:r.isDisabled||!1}}function Er(r,e){let t=null;if(r){var i,s,n,a;for(t=r.getFirstKey();t!=null&&(e.has(t)||!((s=r.getItem(t))===null||s===void 0||(i=s.props)===null||i===void 0)&&i.isDisabled)&&t!==r.getLastKey();)t=r.getKeyAfter(t);t!=null&&(e.has(t)||!((a=r.getItem(t))===null||a===void 0||(n=a.props)===null||n===void 0)&&n.isDisabled)&&t===r.getLastKey()&&(t=r.getFirstKey())}return t}const wd=1500,xr=500;let St={},Ad=0,ui=!1,rt=null,Et=null;function Xd(r={}){let{delay:e=wd,closeDelay:t=xr}=r,{isOpen:i,open:s,close:n}=ds(r),a=b.useMemo(()=>`${++Ad}`,[]),o=b.useRef(null),l=b.useRef(n),u=()=>{St[a]=d},c=()=>{for(let p in St)p!==a&&(St[p](!0),delete St[p])},h=()=>{o.current&&clearTimeout(o.current),o.current=null,c(),u(),ui=!0,s(),rt&&(clearTimeout(rt),rt=null),Et&&(clearTimeout(Et),Et=null)},d=p=>{p||t<=0?(o.current&&clearTimeout(o.current),o.current=null,l.current()):o.current||(o.current=setTimeout(()=>{o.current=null,l.current()},t)),rt&&(clearTimeout(rt),rt=null),ui&&(Et&&clearTimeout(Et),Et=setTimeout(()=>{delete St[a],Et=null,ui=!1},Math.max(xr,t)))},f=()=>{c(),u(),!i&&!rt&&!ui?rt=setTimeout(()=>{rt=null,ui=!0,h()},e):i||h()};return b.useEffect(()=>{l.current=n},[n]),b.useEffect(()=>()=>{o.current&&clearTimeout(o.current),St[a]&&delete St[a]},[a]),{isOpen:i,open:p=>{!p&&e>0&&!o.current?f():h()},close:d}}function Sd(r){let{collection:e,focusMode:t}=r,i=r.UNSAFE_selectionState||kn(r),s=b.useMemo(()=>r.disabledKeys?new Set(r.disabledKeys):new Set,[r.disabledKeys]),n=i.setFocusedKey;i.setFocusedKey=(l,u)=>{if(t==="cell"&&l!=null){let p=e.getItem(l);if(p?.type==="item"){var c,h;let g=Ai(p,e);var d,f;u==="last"?l=(d=(c=qa(g))===null||c===void 0?void 0:c.key)!==null&&d!==void 0?d:null:l=(f=(h=Rn(g))===null||h===void 0?void 0:h.key)!==null&&f!==void 0?f:null}}n(l,u)};let a=b.useMemo(()=>new Fi(e,i),[e,i]);const o=b.useRef(null);return b.useEffect(()=>{if(i.focusedKey!=null&&o.current&&!e.getItem(i.focusedKey)){const l=o.current.getItem(i.focusedKey),u=l?.parentKey!=null&&(l.type==="cell"||l.type==="rowheader"||l.type==="column")?o.current.getItem(l.parentKey):l;if(!u){i.setFocusedKey(null);return}const c=o.current.rows,h=e.rows,d=c.length-h.length;let f=Math.min(d>1?Math.max(u.index-d+1,0):u.index,h.length-1),p=null;for(;f>=0;){if(!a.isDisabled(h[f].key)&&h[f].type!=="headerrow"){p=h[f];break}f<h.length-1?f++:(f>u.index&&(f=u.index),f--)}if(p){const g=p.hasChildNodes?[...Ai(p,e)]:[],m=p.hasChildNodes&&u!==l&&l&&l.index<g.length?g[l.index].key:p.key;i.setFocusedKey(m)}else i.setFocusedKey(null)}o.current=e},[e,a,i,i.focusedKey]),{collection:e,disabledKeys:s,isKeyboardNavigationDisabled:!1,selectionManager:a}}class Ed{*[Symbol.iterator](){yield*[...this.rows]}get size(){return[...this.rows].length}getKeys(){return this.keyMap.keys()}getKeyBefore(e){let t=this.keyMap.get(e);var i;return t&&(i=t.prevKey)!==null&&i!==void 0?i:null}getKeyAfter(e){let t=this.keyMap.get(e);var i;return t&&(i=t.nextKey)!==null&&i!==void 0?i:null}getFirstKey(){var e;return(e=[...this.rows][0])===null||e===void 0?void 0:e.key}getLastKey(){var e;let t=[...this.rows];return(e=t[t.length-1])===null||e===void 0?void 0:e.key}getItem(e){var t;return(t=this.keyMap.get(e))!==null&&t!==void 0?t:null}at(e){const t=[...this.getKeys()];return this.getItem(t[e])}getChildren(e){let t=this.keyMap.get(e);return t?.childNodes||[]}constructor(e){this.keyMap=new Map,this.keyMap=new Map,this.columnCount=e?.columnCount,this.rows=[];let t=h=>{let d=this.keyMap.get(h.key);e.visitNode&&(h=e.visitNode(h)),this.keyMap.set(h.key,h);let f=new Set,p=null,g=!1;if(h.type==="item"){var m;for(let S of h.childNodes)if(((m=S.props)===null||m===void 0?void 0:m.colSpan)!==void 0){g=!0;break}}for(let S of h.childNodes){if(S.type==="cell"&&g){var y,v;S.colspan=(y=S.props)===null||y===void 0?void 0:y.colSpan,S.colSpan=(v=S.props)===null||v===void 0?void 0:v.colSpan;var A,w;S.colIndex=p?((A=p.colIndex)!==null&&A!==void 0?A:p.index)+((w=p.colSpan)!==null&&w!==void 0?w:1):S.index}S.type==="cell"&&S.parentKey==null&&(S.parentKey=h.key),f.add(S.key),p?(p.nextKey=S.key,S.prevKey=p.key):S.prevKey=null,t(S),p=S}if(p&&(p.nextKey=null),d)for(let S of d.childNodes)f.has(S.key)||i(S)},i=h=>{this.keyMap.delete(h.key);for(let d of h.childNodes)this.keyMap.get(d.key)===d&&i(d)},s=null;for(let[h,d]of e.items.entries()){var n,a,o,l,u,c;let f={...d,level:(n=d.level)!==null&&n!==void 0?n:0,key:(a=d.key)!==null&&a!==void 0?a:"row-"+h,type:(o=d.type)!==null&&o!==void 0?o:"row",value:(l=d.value)!==null&&l!==void 0?l:null,hasChildNodes:!0,childNodes:[...d.childNodes],rendered:d.rendered,textValue:(u=d.textValue)!==null&&u!==void 0?u:"",index:(c=d.index)!==null&&c!==void 0?c:h};s?(s.nextKey=f.key,f.prevKey=s.key):f.prevKey=null,this.rows.push(f),t(f),s=f}s&&(s.nextKey=null)}}const $o="row-header-column-"+Math.random().toString(36).slice(2);let qs="row-header-column-"+Math.random().toString(36).slice(2);for(;$o===qs;)qs="row-header-column-"+Math.random().toString(36).slice(2);function xd(r,e){if(e.length===0)return[];let t=[],i=new Map;for(let c of e){let h=c.parentKey,d=[c];for(;h;){let f=r.get(h);if(!f)break;if(i.has(f)){var s,n;(n=(s=f).colSpan)!==null&&n!==void 0||(s.colSpan=0),f.colSpan++,f.colspan=f.colSpan;let{column:p,index:g}=i.get(f);if(g>d.length)break;for(let m=g;m<d.length;m++)p.splice(m,0,null);for(let m=d.length;m<p.length;m++)p[m]&&i.has(p[m])&&(i.get(p[m]).index=m)}else f.colSpan=1,f.colspan=1,d.push(f),i.set(f,{column:d,index:d.length-1});h=f.parentKey}t.push(d),c.index=t.length-1}let a=Math.max(...t.map(c=>c.length)),o=Array(a).fill(0).map(()=>[]),l=0;for(let c of t){let h=a-1;for(let d of c){if(d){let f=o[h],p=f.reduce((g,m)=>{var y;return g+((y=m.colSpan)!==null&&y!==void 0?y:1)},0);if(p<l){let g={type:"placeholder",key:"placeholder-"+d.key,colspan:l-p,colSpan:l-p,index:p,value:null,rendered:null,level:h,hasChildNodes:!1,childNodes:[],textValue:""};f.length>0&&(f[f.length-1].nextKey=g.key,g.prevKey=f[f.length-1].key),f.push(g)}f.length>0&&(f[f.length-1].nextKey=d.key,d.prevKey=f[f.length-1].key),d.level=h,d.colIndex=l,f.push(d)}h--}l++}let u=0;for(let c of o){let h=c.reduce((d,f)=>{var p;return d+((p=f.colSpan)!==null&&p!==void 0?p:1)},0);if(h<e.length){let d={type:"placeholder",key:"placeholder-"+c[c.length-1].key,colSpan:e.length-h,colspan:e.length-h,index:h,value:null,rendered:null,level:u,hasChildNodes:!1,childNodes:[],textValue:"",prevKey:c[c.length-1].key};c.push(d)}u++}return o.map((c,h)=>({type:"headerrow",key:"headerrow-"+h,index:h,value:null,rendered:null,level:0,hasChildNodes:!0,childNodes:c,textValue:""}))}class Cd extends Ed{*[Symbol.iterator](){yield*this.body.childNodes}get size(){return this._size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){let t=this.keyMap.get(e);var i;return(i=t?.prevKey)!==null&&i!==void 0?i:null}getKeyAfter(e){let t=this.keyMap.get(e);var i;return(i=t?.nextKey)!==null&&i!==void 0?i:null}getFirstKey(){var e,t;return(t=(e=Rn(this.body.childNodes))===null||e===void 0?void 0:e.key)!==null&&t!==void 0?t:null}getLastKey(){var e,t;return(t=(e=qa(this.body.childNodes))===null||e===void 0?void 0:e.key)!==null&&t!==void 0?t:null}getItem(e){var t;return(t=this.keyMap.get(e))!==null&&t!==void 0?t:null}at(e){const t=[...this.getKeys()];return this.getItem(t[e])}getChildren(e){return e===this.body.key?this.body.childNodes:super.getChildren(e)}getTextValue(e){let t=this.getItem(e);if(!t)return"";if(t.textValue)return t.textValue;let i=this.rowHeaderColumnKeys;if(i){let s=[];for(let n of t.childNodes){let a=this.columns[n.index];if(i.has(a.key)&&n.textValue&&s.push(n.textValue),s.length===i.size)break}return s.join(" ")}return""}constructor(e,t,i){let s=new Set,n=null,a=[];if(i?.showSelectionCheckboxes){let h={type:"column",key:$o,value:null,textValue:"",level:0,index:i?.showDragButtons?1:0,hasChildNodes:!1,rendered:null,childNodes:[],props:{isSelectionCell:!0}};a.unshift(h)}if(i?.showDragButtons){let h={type:"column",key:qs,value:null,textValue:"",level:0,index:0,hasChildNodes:!1,rendered:null,childNodes:[],props:{isDragButtonCell:!0}};a.unshift(h)}let o=[],l=new Map,u=h=>{switch(h.type){case"body":n=h;break;case"column":l.set(h.key,h),h.hasChildNodes||(a.push(h),h.props.isRowHeader&&s.add(h.key));break;case"item":o.push(h);return}for(let d of h.childNodes)u(d)};for(let h of e)u(h);let c=xd(l,a);if(c.forEach((h,d)=>o.splice(d,0,h)),super({columnCount:a.length,items:o,visitNode:h=>(h.column=a[h.index],h)}),this._size=0,this.columns=a,this.rowHeaderColumnKeys=s,this.body=n,this.headerRows=c,this._size=[...n.childNodes].length,this.rowHeaderColumnKeys.size===0){let h=this.columns.find(d=>{var f,p;return!(!((f=d.props)===null||f===void 0)&&f.isDragButtonCell)&&!(!((p=d.props)===null||p===void 0)&&p.isSelectionCell)});h&&this.rowHeaderColumnKeys.add(h.key)}}}const _d={ascending:"descending",descending:"ascending"};function Yd(r){let[e,t]=b.useState(!1),{selectionMode:i="none",showSelectionCheckboxes:s,showDragButtons:n}=r,a=b.useMemo(()=>({showSelectionCheckboxes:s&&i!=="none",showDragButtons:n,selectionMode:i,columns:[]}),[r.children,s,i,n]),o=Tn(r,b.useCallback(h=>new Cd(h,null,a),[a]),a),{disabledKeys:l,selectionManager:u}=Sd({...r,collection:o,disabledBehavior:r.disabledBehavior||"selection"});var c;return{collection:o,disabledKeys:l,selectionManager:u,showSelectionCheckboxes:r.showSelectionCheckboxes||!1,sortDescriptor:(c=r.sortDescriptor)!==null&&c!==void 0?c:null,isKeyboardNavigationDisabled:o.size===0||e,setKeyboardNavigationDisabled:t,sort(h,d){var f,p;(p=r.onSortChange)===null||p===void 0||p.call(r,{column:h,direction:d??(((f=r.sortDescriptor)===null||f===void 0?void 0:f.column)===h?_d[r.sortDescriptor.direction]:"ascending")})}}}function Oo(r){return null}Oo.getCollectionNode=function*(e,t){let{children:i,columns:s}=e;if(t.columns=[],typeof i=="function"){if(!s)throw new Error("props.children was a function but props.columns is missing");for(let n of s)yield{type:"column",value:n,renderer:i}}else{let n=[];$e.Children.forEach(i,a=>{n.push({type:"column",element:a})}),yield*n}};let Zd=Oo;function No(r){return null}No.getCollectionNode=function*(e){let{children:t,items:i}=e;yield{type:"body",hasChildNodes:!0,props:e,*childNodes(){if(typeof t=="function"){if(!i)throw new Error("props.children was a function but props.items is missing");for(let s of i)yield{type:"item",value:s,renderer:t}}else{let s=[];$e.Children.forEach(t,n=>{s.push({type:"item",element:n})}),yield*s}}}};let Jd=No;function Bo(r){return null}Bo.getCollectionNode=function*(e,t){let{title:i,children:s,childColumns:n}=e,a=i||s,o=e.textValue||(typeof a=="string"?a:"")||e["aria-label"],l=yield{type:"column",hasChildNodes:!!n||!!i&&$e.Children.count(s)>0,rendered:a,textValue:o,props:e,*childNodes(){if(n)for(let c of n)yield{type:"column",value:c};else if(i){let c=[];$e.Children.forEach(s,h=>{c.push({type:"column",element:h})}),yield*c}},shouldInvalidate(c){return u(c),!1}},u=c=>{for(let h of l)h.hasChildNodes||c.columns.push(h)};u(t)};let Qd=Bo;function Xs(r){return null}Xs.getCollectionNode=function*(e,t){let{children:i,textValue:s,UNSTABLE_childItems:n}=e;yield{type:"item",props:e,textValue:s,"aria-label":e["aria-label"],hasChildNodes:!0,*childNodes(){if(t.showDragButtons&&(yield{type:"cell",key:"header-drag",props:{isDragButtonCell:!0}}),t.showSelectionCheckboxes&&t.selectionMode!=="none"&&(yield{type:"cell",key:"header",props:{isSelectionCell:!0}}),typeof i=="function"){for(let a of t.columns)yield{type:"cell",element:i(a.key),key:a.key};if(n)for(let a of n)yield{type:"item",value:a}}else{let a=[],o=[],l=0;if($e.Children.forEach(i,u=>{if(u.type===Xs){if(a.length<t.columns.length)throw new Error("All of a Row's child Cells must be positioned before any child Rows.");o.push({type:"item",element:u})}else{a.push({type:"cell",element:u});var c;l+=(c=u.props.colSpan)!==null&&c!==void 0?c:1}}),l!==t.columns.length)throw new Error(`Cell count must match column count. Found ${l} cells and ${t.columns.length} columns.`);yield*a,yield*o}},shouldInvalidate(a){return a.columns.length!==t.columns.length||a.columns.some((o,l)=>o.key!==t.columns[l].key)||a.showSelectionCheckboxes!==t.showSelectionCheckboxes||a.showDragButtons!==t.showDragButtons||a.selectionMode!==t.selectionMode}}};let ef=Xs;function Vo(r){return null}Vo.getCollectionNode=function*(e){let{children:t}=e,i=e.textValue||(typeof t=="string"?t:"")||e["aria-label"]||"";yield{type:"cell",props:e,rendered:t,textValue:i,"aria-label":e["aria-label"],hasChildNodes:!1}};let tf=Vo;function sf(r){var e;let{defaultFilter:t,menuTrigger:i="input",allowsEmptyCollection:s=!1,allowsCustomValue:n,shouldCloseOnBlur:a=!0}=r,[o,l]=b.useState(!1),[u,c]=b.useState(!1),[h,d]=b.useState(null),f=W=>{r.onSelectionChange&&r.onSelectionChange(W),W===y&&(j(),ee())};var p;let{collection:g,selectionManager:m,selectedKey:y,setSelectedKey:v,selectedItem:A,disabledKeys:w}=Fo({...r,onSelectionChange:f,items:(p=r.items)!==null&&p!==void 0?p:r.defaultItems}),[S,E]=Ge(r.inputValue,Cr(r.defaultInputValue,y,g)||"",r.onInputChange),[x]=b.useState(y),[_]=b.useState(S),C=g,T=b.useMemo(()=>r.items!=null||!t?g:Td(g,S,t),[g,S,t,r.items]),[D,B]=b.useState(T),k=b.useRef("focus"),$=ds({...r,onOpenChange:W=>{r.onOpenChange&&r.onOpenChange(W,W?k.current:void 0),m.setFocused(W),W||m.setFocusedKey(null)},isOpen:void 0,defaultOpen:void 0}),P=(W=null,ae)=>{let pe=ae==="manual"||ae==="focus"&&i==="focus";(s||T.size>0||pe&&C.size>0||r.items)&&(pe&&!$.isOpen&&r.items===void 0&&l(!0),k.current=ae,d(W),$.open())},M=(W=null,ae)=>{let pe=ae==="manual"||ae==="focus"&&i==="focus";!(s||T.size>0||pe&&C.size>0||r.items)&&!$.isOpen||(pe&&!$.isOpen&&r.items===void 0&&l(!0),$.isOpen||(k.current=ae),J(W))},O=b.useCallback(()=>{B(o?C:T)},[o,C,T]),J=b.useCallback((W=null)=>{$.isOpen&&O(),d(W),$.toggle()},[$,O]),ee=b.useCallback(()=>{$.isOpen&&(O(),$.close())},[$,O]),[L,K]=b.useState(S),j=()=>{var W,ae;let pe=y!=null&&(ae=(W=g.getItem(y))===null||W===void 0?void 0:W.textValue)!==null&&ae!==void 0?ae:"";K(pe),E(pe)};var ne,ue;let Q=b.useRef((ue=(ne=r.selectedKey)!==null&&ne!==void 0?ne:r.defaultSelectedKey)!==null&&ue!==void 0?ue:null);var Z;let _e=b.useRef(y!=null&&(Z=(e=g.getItem(y))===null||e===void 0?void 0:e.textValue)!==null&&Z!==void 0?Z:"");b.useEffect(()=>{var W;u&&(T.size>0||s)&&!$.isOpen&&S!==L&&i!=="manual"&&P(null,"input"),!o&&!s&&$.isOpen&&T.size===0&&ee(),y!=null&&y!==Q.current&&ee(),S!==L&&(m.setFocusedKey(null),l(!1),S===""&&(r.inputValue===void 0||r.selectedKey===void 0)&&v(null)),y!==Q.current&&(r.inputValue===void 0||r.selectedKey===void 0)?j():L!==S&&K(S);var ae;let pe=y!=null&&(ae=(W=g.getItem(y))===null||W===void 0?void 0:W.textValue)!==null&&ae!==void 0?ae:"";!u&&y!=null&&r.inputValue===void 0&&y===Q.current&&_e.current!==pe&&(K(pe),E(pe)),Q.current=y,_e.current=pe});let Ee=_n({...r,value:b.useMemo(()=>({inputValue:S,selectedKey:y}),[S,y])}),I=()=>{n&&y==null?Y():te()},Y=()=>{Q.current=null,v(null),ee()},te=()=>{if(r.selectedKey!==void 0&&r.inputValue!==void 0){var W,ae;(W=r.onSelectionChange)===null||W===void 0||W.call(r,y);var pe;let fs=y!=null&&(pe=(ae=g.getItem(y))===null||ae===void 0?void 0:ae.textValue)!==null&&pe!==void 0?pe:"";K(fs),ee()}else j(),ee()};const G=()=>{if(n){var W,ae;const pe=y!=null&&(ae=(W=g.getItem(y))===null||W===void 0?void 0:W.textValue)!==null&&ae!==void 0?ae:"";S===pe?te():Y()}else te()};let ie=()=>{$.isOpen&&m.focusedKey!=null?y===m.focusedKey?te():v(m.focusedKey):G()},de=b.useRef(S),ve=W=>{W?(de.current=S,i==="focus"&&!r.isReadOnly&&P(null,"focus")):(a&&G(),S!==de.current&&Ee.commitValidation()),c(W)},pt=b.useMemo(()=>$.isOpen?o?C:T:D,[$.isOpen,C,T,o,D]);var nt;let Ot=(nt=r.defaultSelectedKey)!==null&&nt!==void 0?nt:x;var ei;return{...Ee,...$,focusStrategy:h,toggle:M,open:P,close:G,selectionManager:m,selectedKey:y,defaultSelectedKey:Ot,setSelectedKey:v,disabledKeys:w,isFocused:u,setFocused:ve,selectedItem:A,collection:pt,inputValue:S,defaultInputValue:(ei=Cr(r.defaultInputValue,Ot,g))!==null&&ei!==void 0?ei:_,setInputValue:E,commit:ie,revert:I}}function Td(r,e,t){return new Ws(Ho(r,r,e,t))}function Ho(r,e,t,i){let s=[];for(let n of e)if(n.type==="section"&&n.hasChildNodes){let a=Ho(r,Ai(n,r),t,i);[...a].some(o=>o.type==="item")&&s.push({...n,childNodes:a})}else n.type==="item"&&i(n.textValue,t)?s.push({...n}):n.type!=="item"&&s.push({...n});return s}function Cr(r,e,t){if(r==null){var i,s;if(e!=null)return(s=(i=t.getItem(e))===null||i===void 0?void 0:i.textValue)!==null&&s!==void 0?s:""}return r}export{Yh as $,Ai as A,qa as B,Rn as C,id as D,Od as E,Fd as F,Rl as G,Ul as H,Tl as I,Ea as J,Pt as K,Id as L,$d as P,Md as R,Ge as a,Vd as b,ds as c,Ud as d,Hd as e,jd as f,zd as g,fd as h,Gd as i,Wd as j,qd as k,Xd as l,Yd as m,Qd as n,Zd as o,ef as p,Jd as q,tf as r,bd as s,sf as t,Nd as u,Bd as v,_n as w,Kd as x,pr as y,oi as z};
